(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{550:function(s,t,a){s.exports=a.p+"assets/img/image-20231230174226818.98e1a0de.png"},551:function(s,t,a){s.exports=a.p+"assets/img/image-20231230174335619.e403efa6.png"},676:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#安装"}},[s._v("安装")])]),t("li",[t("a",{attrs:{href:"#常用命令"}},[s._v("常用命令")])]),t("li",[t("a",{attrs:{href:"#文件目录"}},[s._v("文件目录")])]),t("li",[t("a",{attrs:{href:"#默认配置"}},[s._v("默认配置")])]),t("li",[t("a",{attrs:{href:"#location"}},[s._v("location")]),t("ul",[t("li",[t("a",{attrs:{href:"#root-与-alias"}},[s._v("root 与 alias")]),t("ul",[t("li",[t("a",{attrs:{href:"#root"}},[s._v("root")])]),t("li",[t("a",{attrs:{href:"#alias"}},[s._v("alias")]),t("ul",[t("li",[t("a",{attrs:{href:"#alias指定文件"}},[s._v("alias指定文件")])])])])])]),t("li",[t("a",{attrs:{href:"#location的最左匹配原则"}},[s._v("location的最左匹配原则")])]),t("li",[t("a",{attrs:{href:"#末尾-用法"}},[s._v("末尾/用法")]),t("ul",[t("li",[t("a",{attrs:{href:"#location-url-末尾"}},[s._v("location url 末尾/")])]),t("li",[t("a",{attrs:{href:"#root-指定目录末尾"}},[s._v("root 指定目录末尾/")])]),t("li",[t("a",{attrs:{href:"#总结"}},[s._v("总结")])])])])])]),t("li",[t("a",{attrs:{href:"#压缩"}},[s._v("压缩")])]),t("li",[t("a",{attrs:{href:"#nginx变量"}},[s._v("nginx变量")])]),t("li",[t("a",{attrs:{href:"#文件服务器"}},[s._v("文件服务器")]),t("ul",[t("li",[t("a",{attrs:{href:"#通过参数是否下载文件"}},[s._v("通过参数是否下载文件")])])])]),t("li",[t("a",{attrs:{href:"#动静分离"}},[s._v("动静分离")])]),t("li",[t("a",{attrs:{href:"#黑白名单"}},[s._v("黑白名单")])]),t("li",[t("a",{attrs:{href:"#日志"}},[s._v("日志")])]),t("li",[t("a",{attrs:{href:"#跨域"}},[s._v("跨域")])]),t("li",[t("a",{attrs:{href:"#防盗链设计"}},[s._v("防盗链设计")])]),t("li",[t("a",{attrs:{href:"#重定向"}},[s._v("重定向")])])])]),t("p"),s._v(" "),t("h1",{attrs:{id:"nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[s._v("#")]),s._v(" Nginx")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://nginx.org/en/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("code",[s._v("nginx")]),s._v("是一款轻量级的Web服务器/反向代理服务器, 其特点是占有内存少, 并发能力强")]),s._v(" "),t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("p",[s._v("以"),t("code",[s._v("Windows")]),s._v("为例从官网上下载"),t("a",{attrs:{href:"https://nginx.org/download/nginx-1.24.0.zip",target:"_blank",rel:"noopener noreferrer"}},[s._v("windows压缩包"),t("OutboundLink")],1),s._v(", 解压缩, 然后双击运行"),t("code",[s._v("nginx.exe")]),s._v("或者使用"),t("code",[s._v("start nginx")]),s._v("命令启动")]),s._v(" "),t("blockquote",[t("p",[s._v("将"),t("code",[s._v("nginx")]),s._v("的安装目录设置到环境变量中则可以在任何地方启动")])]),s._v(" "),t("p",[t("img",{attrs:{src:a(550),alt:"image-20231230174400622"}})]),s._v(" "),t("p",[s._v("然后打开浏览器访问"),t("code",[s._v("localhost:80")]),s._v("会看到默认的"),t("code",[s._v("nginx")]),s._v("欢迎页面, 如下则表示"),t("code",[s._v("nginx")]),s._v("已经安装成功了")]),s._v(" "),t("p",[t("img",{attrs:{src:a(551),alt:"image-20231230174335619"}})]),s._v(" "),t("h2",{attrs:{id:"常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[s._v("#")]),s._v(" 常用命令")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示帮助")]),s._v("\nnginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示版本")]),s._v("\nnginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-V")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示更多的信息")]),s._v("\nstart nginx "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 nginx")]),s._v("\nnginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试配置")]),s._v("\nnginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-T")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试配置并将验证后的配置打印到屏幕上")]),s._v("\n\n\n\nnginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("信号"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -s 标记向 nginx master 进程发送信号, 可以发送 stop, quit, reload 和 reopen 等信号")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# stop 信号可立即停止 nginx 进程")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# quit 信号会在完成当前正在处理的请求后停止 nginx 进程")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# reload 信号可重新加载配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# reopen 信号指示 nginx 重新打开日志文件")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h2",{attrs:{id:"文件目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文件目录"}},[s._v("#")]),s._v(" 文件目录")]),s._v(" "),t("p",[s._v("以"),t("code",[s._v("window")]),s._v("为例")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("├─conf "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所有配置文件的目录")]),s._v("\n├─contrib\n├─docs "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文档")]),s._v("\n├─html "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认欢迎页面")]),s._v("\n├─logs "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx 每次的访问这里会保存相关的日志")]),s._v("\n└─temp "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时文件")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h2",{attrs:{id:"默认配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#默认配置"}},[s._v("#")]),s._v(" 默认配置")]),s._v(" "),t("p",[t("code",[s._v("nginx")]),s._v("的默认配置在"),t("code",[s._v("conf/nginx.conf")]),s._v("下面, 具体功能如下:")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_processes")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义工作进程数量为1, 即单进程模式")]),s._v("\n  \n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("events")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义事件循环的配置")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_connections")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每个工作进程允许的最大连接数为1024")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n  \n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开始定义HTTP服务器的配置")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v("       mime.types")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 引入mime.types文件, 该配置就是用于定义文件类型和相应的MIME类型")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default_type")]),s._v("  application/octet-stream")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 默认的MIME类型, 如果未定义则为"application/octet-stream"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sendfile")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启sendfile功能, 用于快速传输文件")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keepalive_timeout")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保持连接的超时时间为65秒")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开始定义一个服务器块")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务器监听的端口号为8080")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务器的名字或域名, 此处为localhost")]),s._v("\n  \n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 定义一个位置块, 匹配根路径"/"')]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 设置根目录为"html"')]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  index.html index.htm")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 设置默认的索引文件为"index.html"和"index.htm"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n  \n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_page")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v("  /50x.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 定义错误页面, 当出现500、502、503、504错误时, 返回"/50x.html"页面')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" = /50x.html")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 定义一个位置块, 匹配路径"/50x.html"')]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 设置该位置的根目录为"html"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("h2",{attrs:{id:"location"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#location"}},[s._v("#")]),s._v(" location")]),s._v(" "),t("h3",{attrs:{id:"root-与-alias"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#root-与-alias"}},[s._v("#")]),s._v(" root 与 alias")]),s._v(" "),t("p",[t("code",[s._v("root")]),s._v("和"),t("code",[s._v("alias")]),s._v("在替换url时是有点不同的, 当"),t("code",[s._v("location")]),s._v("命中后")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("如果是"),t("code",[s._v("root")]),s._v(", 会把请求"),t("code",[s._v("url")]),s._v("的 "),t("code",[s._v("[IP|域名]+端口")]),s._v("替换为"),t("code",[s._v("root")]),s._v("指定的目录, 然后拼接"),t("code",[s._v("index")]),s._v("访问资源")])]),s._v(" "),t("li",[t("p",[s._v("如果是"),t("code",[s._v("alias")]),s._v(", 会把请求"),t("code",[s._v("url")]),s._v("的"),t("code",[s._v("[IP|域名]+端口+匹配到的路径")]),s._v("替换为"),t("code",[s._v("alias")]),s._v("指定的目录, 然后拼接"),t("code",[s._v("index")]),s._v("访问资源")])])]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_processes")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("events")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_connections")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n  \n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v("       mime.types")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default_type")]),s._v("  application/octet-stream")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sendfile")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keepalive_timeout")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开始定义一个服务器块")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务器监听的端口号为8080")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务器的名字或域名, 此处为localhost")]),s._v("\n  \n    \t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问 localhost:8080/ 就等于访问 ./html/index.html")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示当前的 html 目录")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  index.html index.htm")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n  \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问 localhost:8080/test 就等于访问 C:/Users/33153/Desktop/test-html/index.html")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /test")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alias")]),s._v("   C:/Users/33153/Desktop/test-html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意: 这里用的是 alias")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_page")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v("  /50x.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" = /50x.html")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("h4",{attrs:{id:"root"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#root"}},[s._v("#")]),s._v(" root")]),s._v(" "),t("p",[s._v("以请求"),t("code",[s._v("http://localhost:8080/test-html")]),s._v("为例, "),t("code",[s._v("location")]),s._v("配置如下:")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /test-html")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   C:/Users/33153/Desktop")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("匹配到"),t("code",[s._v("/test-html")]),s._v(", "),t("code",[s._v("[IP|域名]+端口")]),s._v("替换为"),t("code",[s._v("root")]),s._v("指定的目录, 即"),t("code",[s._v("url")]),s._v("中的"),t("code",[s._v("http://localhost:8080")]),s._v("被替换为了"),t("code",[s._v("C:/Users/33153/Desktop")]),s._v(", 然后拼接上"),t("code",[s._v("index")]),s._v("指定的文件地址, 所以实际访问的路径为"),t("code",[s._v("C:/Users/33153/Desktop/test-html/index.html")])]),s._v(" "),t("p",[s._v("如果是以下的配置")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /test-html/foo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   C:/Users/33153/Desktop")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("访问"),t("code",[s._v("http://localhost:8080/test-html")]),s._v("则相当于访问"),t("code",[s._v("C:/Users/33153/Desktop/test-html/foo/index.html")])]),s._v(" "),t("h4",{attrs:{id:"alias"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#alias"}},[s._v("#")]),s._v(" alias")]),s._v(" "),t("p",[s._v("以请求"),t("code",[s._v("http://localhost:8080/test-html")]),s._v("为例, "),t("code",[s._v("location")]),s._v("配置如下:")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /test-html")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alias")]),s._v("   C:/Users/33153/Desktop/test-html/nginx-test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("匹配到"),t("code",[s._v("/test-html")]),s._v(", "),t("code",[s._v("[IP|域名]+端口+匹配到的路径")]),s._v("替换为"),t("code",[s._v("alias")]),s._v("指定的目录, 即"),t("code",[s._v("url")]),s._v("中的"),t("code",[s._v("http://localhost:8080/test-html")]),s._v("被替换为了"),t("code",[s._v("C:/Users/33153/Desktop/test-html/nginx-test")]),s._v(", 然后拼接上"),t("code",[s._v("index")]),s._v("指定的文件地址, 所以实际访问的路径为"),t("code",[s._v("C:/Users/33153/Desktop/test-html/nginx-test/index.html")])]),s._v(" "),t("h5",{attrs:{id:"alias指定文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#alias指定文件"}},[s._v("#")]),s._v(" alias指定文件")]),s._v(" "),t("p",[s._v("如下配置")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /test-html/index.html")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alias")]),s._v("   C:/Users/33153/Desktop/test-html/nginx-test/index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("访问"),t("code",[s._v("http://localhost:8080/test-html/index.html")]),s._v("则相当于访问"),t("code",[s._v("C:/Users/33153/Desktop/test-html/nginx-test/index.html")])]),s._v(" "),t("h3",{attrs:{id:"location的最左匹配原则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#location的最左匹配原则"}},[s._v("#")]),s._v(" location的最左匹配原则")]),s._v(" "),t("p",[t("code",[s._v("location")]),s._v("会从"),t("code",[s._v("url")]),s._v("最左边的路径匹配, 如果一致则命中该"),t("code",[s._v("location")]),s._v(", 只有"),t("strong",[s._v("中间匹配到不会命中")])]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /foo/bar")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("上面的规则只会匹配 "),t("code",[s._v("/foo")]),s._v(" 或者 "),t("code",[s._v("/foo/bar")]),s._v(", 如果输入"),t("code",[s._v("/bar")]),s._v("也不算匹配")]),s._v(" "),t("h3",{attrs:{id:"末尾-用法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#末尾-用法"}},[s._v("#")]),s._v(" 末尾/用法")]),s._v(" "),t("h4",{attrs:{id:"location-url-末尾"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#location-url-末尾"}},[s._v("#")]),s._v(" location url 末尾/")]),s._v(" "),t("p",[t("code",[s._v("localhost/foo/bar")]),s._v(" 表示把"),t("code",[s._v("bar")]),s._v("当成一个"),t("strong",[s._v("文件")]),s._v(",想要访问"),t("code",[s._v("bar")]),s._v("文件")]),s._v(" "),t("p",[t("code",[s._v("localhost/foo/bar")]),s._v("表示把"),t("code",[s._v("bar")]),s._v("当成一个"),t("strong",[s._v("目录")]),s._v(", 想要访问"),t("code",[s._v("bar")]),s._v("目录下"),t("code",[s._v("index")]),s._v("指定的文件")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 能 /foo 也能匹配 /foo/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /foo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只能匹配 /foo/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /foo/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h4",{attrs:{id:"root-指定目录末尾"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#root-指定目录末尾"}},[s._v("#")]),s._v(" root 指定目录末尾/")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /foo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /home/bar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示把 bar 当成目录或者文件")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /foo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /home/bar/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示只把 bar 当成目录")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("blockquote",[t("p",[t("code",[s._v("root")]),s._v("后面指定的都应该是目录 ("),t("code",[s._v("alias")]),s._v("有种特殊情况除外)")])]),s._v(" "),t("h4",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("url")]),s._v("末尾不加"),t("code",[s._v("/")]),s._v(", 如果需要带"),t("code",[s._v("/")]),s._v("时依靠"),t("code",[s._v("nginx")]),s._v("自动重定向加"),t("code",[s._v("/")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("location")]),s._v(" 路径不加"),t("code",[s._v("/")]),s._v(", 这样末尾有无"),t("code",[s._v("/")]),s._v("的"),t("code",[s._v("url")]),s._v("都能匹配到")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("root")]),s._v("或者"),t("code",[s._v("alias")]),s._v("指定的目录后面加"),t("code",[s._v("/")]),s._v(", 明确表示"),t("code",[s._v("root")]),s._v("指定的是目录, 增强配置的可读性")])])]),s._v(" "),t("h2",{attrs:{id:"压缩"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#压缩"}},[s._v("#")]),s._v(" 压缩")]),s._v(" "),t("p",[s._v("在"),t("code",[s._v("Nginx")]),s._v("也提供了三个支持资源压缩的模块"),t("code",[s._v("ngx_http_gzip_module")]),s._v(","),t("code",[s._v("ngx_http_gzip_static_module")]),s._v(","),t("code",[s._v("ngx_http_gunzip_module")]),s._v(", 其中"),t("code",[s._v("ngx_http_gzip_module")]),s._v("属于内置模块:")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启压缩机制")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定会被压缩的文件类型(也可自己配置其他类型)")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_types")]),s._v(" text/plain application/javascript text/css application/xml text/javascript image/jpeg image/gif image/png")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置压缩级别, 越高资源消耗越大, 但压缩效果越好")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_comp_level")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在头部中添加Vary: Accept-Encoding（建议开启）")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_vary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 处理压缩请求的缓冲区数量和大小")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_buffers")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对于不支持压缩功能的客户端请求不开启压缩机制")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_disable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MSIE [1-6]\\."')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 低版本的IE浏览器不支持压缩")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置压缩响应所支持的HTTP最低版本")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_http_version")]),s._v(" 1.1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置触发压缩的最小阈值")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_min_length")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭对后端服务器的响应结果进行压缩")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_proxied")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[s._v("最后的"),t("code",[s._v("gzip_proxied")]),s._v("选项包括如下的配置:")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("off")]),s._v(": 关闭"),t("code",[s._v("Nginx")]),s._v("对后台服务器的响应结果进行压缩")]),s._v(" "),t("li",[t("code",[s._v("expired")]),s._v(": 如果响应头中包含"),t("code",[s._v("Expires")]),s._v("信息, 则开启压缩")]),s._v(" "),t("li",[t("code",[s._v("no-cache")]),s._v(": 如果响应头中包含"),t("code",[s._v("Cache-Control:no-cache")]),s._v("信息, 则开启压缩")]),s._v(" "),t("li",[t("code",[s._v("no-store")]),s._v(": 如果响应头中包含"),t("code",[s._v("Cache-Control:no-store")]),s._v("信息, 则开启压缩")]),s._v(" "),t("li",[t("code",[s._v("private")]),s._v(": 如果响应头中包含"),t("code",[s._v("Cache-Control:private")]),s._v("信息, 则开启压缩")]),s._v(" "),t("li",[t("code",[s._v("no_last_modified")]),s._v(": 如果响应头中不包含"),t("code",[s._v("Last-Modified")]),s._v("信息, 则开启压缩")]),s._v(" "),t("li",[t("code",[s._v("no_etag")]),s._v(": 如果响应头中不包含"),t("code",[s._v("ETag")]),s._v("信息, 则开启压缩")]),s._v(" "),t("li",[t("code",[s._v("auth")]),s._v(": 如果响应头中包含"),t("code",[s._v("Authorization")]),s._v("信息, 则开启压缩")]),s._v(" "),t("li",[t("code",[s._v("any")]),s._v(": 无条件对后端的响应结果开启压缩机制")])]),s._v(" "),t("h2",{attrs:{id:"nginx变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx变量"}},[s._v("#")]),s._v(" nginx变量")]),s._v(" "),t("p",[t("code",[s._v("nginx")]),s._v("中的变量大全如下:")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[s._v("$args                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求中的参数值")]),s._v("\n$query_string            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同 $args")]),s._v("\n$arg_NAME                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# GET请求中NAME的值")]),s._v("\n$is_args                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 如果请求中有参数, 值为"?", 否则为空字符串')]),s._v("\n$uri                     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 请求中的当前URI(不带请求参数, 参数位于$args), 可以不同于浏览器传递的$request_uri的值, 它可以通过内部重定向, 或者使用index指令进行修改, $uri不包含主机名, 如"/foo/bar.html"')]),s._v("\n$document_uri            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同 $uri")]),s._v("\n$document_root           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当前请求的文档根目录或别名")]),s._v("\n$host                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 优先级: HTTP请求行的主机名>"HOST"请求头字段>符合请求的服务器名.请求中的主机头字段, 如果请求中的主机头不可用, 则为服务器处理请求的服务器名称')]),s._v("\n$hostname                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机名")]),s._v("\n$https                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 如果开启了SSL安全模式, 值为"on", 否则为空字符串')]),s._v("\n$binary_remote_addr      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 客户端地址的二进制形式, 固定长度为4个字节")]),s._v("\n$body_bytes_sent         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 传输给客户端的字节数, 响应头不计算在内；这个变量和Apache的mod_log_config模块中的"%B"参数保持兼容')]),s._v("\n$bytes_sent              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 传输给客户端的字节数")]),s._v("\n$connection              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TCP连接的序列号")]),s._v("\n$connection_requests     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TCP连接当前的请求数量")]),s._v("\n$content_length          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# "Content-Length" 请求头字段')]),s._v("\n$content_type            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# "Content-Type" 请求头字段')]),s._v("\n$cookie_name             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cookie名称")]),s._v("\n$limit_rate              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于设置响应的速度限制")]),s._v("\n$msec                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当前的Unix时间戳")]),s._v("\n$nginx_version           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx版本")]),s._v("\n$pid                     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 工作进程的PID")]),s._v("\n$pipe                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 如果请求来自管道通信, 值为"p", 否则为"."')]),s._v("\n$proxy_protocol_addr     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取代理访问服务器的客户端地址, 如果是直接访问, 该值为空字符串")]),s._v("\n$realpath_root           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当前请求的文档根目录或别名的真实路径, 会将所有符号连接转换为真实路径")]),s._v("\n$remote_addr             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 客户端地址")]),s._v("\n$remote_port             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 客户端端口")]),s._v("\n$remote_user             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于HTTP基础认证服务的用户名")]),s._v("\n$request                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 代表客户端的请求地址")]),s._v("\n$request_body            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 客户端的请求主体: 此变量可在location中使用, 将请求主体通过proxy_pass, fastcgi_pass, uwsgi_pass和scgi_pass传递给下一级的代理服务器")]),s._v("\n$request_body_file       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将客户端请求主体保存在临时文件中文件处理结束后, 此文件需删除如果需要之一开启此功能, 需要设置client_body_in_file_only如果将次文件传 递给后端的代理服务器, 需要禁用request body, 即设置proxy_pass_request_body off, fastcgi_pass_request_body off, uwsgi_pass_request_body off, or scgi_pass_request_body off")]),s._v("\n$request_completion      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 如果请求成功, 值为"OK", 如果请求未完成或者请求不是一个范围请求的最后一部分, 则为空')]),s._v("\n$request_filename        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当前连接请求的文件路径, 由root或alias指令与URI请求生成")]),s._v("\n$request_length          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求的长度 (包括请求的地址, http请求头和请求主体)")]),s._v("\n$request_method          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# HTTP请求方法, 通常为"GET"或"POST"')]),s._v("\n$request_time            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 处理客户端请求使用的时间,单位为秒, 精度毫秒； 从读入客户端的第一个字节开始, 直到把最后一个字符发送给客户端后进行日志写入为止")]),s._v("\n$request_uri             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 这个变量等于包含一些客户端请求参数的原始URI, 它无法修改, 请查看$uri更改或重写URI, 不包含主机名, 例如: "/cnphp/test.php?arg=freemouse"')]),s._v("\n$scheme                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 请求使用的Web协议, "http" 或 "https"')]),s._v("\n$server_addr             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务器端地址, 需要注意的是: 为了避免访问linux系统内核, 应将ip地址提前设置在配置文件中")]),s._v("\n$server_name             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务器名")]),s._v("\n$server_port             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务器端口")]),s._v("\n$server_protocol         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 服务器的HTTP版本, 通常为 "HTTP/1.0" 或 "HTTP/1.1"')]),s._v("\n$status                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HTTP响应代码")]),s._v("\n$time_iso8601            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务器时间的ISO 8610格式")]),s._v("\n$time_local              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务器时间（LOG Format 格式）")]),s._v("\n$cookie_NAME             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 客户端请求Header头中的cookie变量, 前缀"$cookie_"加上cookie名称的变量, 该变量的值即为cookie名称的值')]),s._v("\n$http_NAME               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 匹配任意请求头字段；变量名中的后半部分NAME可以替换成任意请求头字段, 如在配置文件中需要获取http请求头: "Accept-Language", $http_accept_language即可')]),s._v("\n$http_cookie\n$http_host               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求地址, 即浏览器中你输入的地址（IP或域名）")]),s._v("\n$http_referer            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# url跳转来源,用来记录从那个页面链接访问过来的")]),s._v("\n$http_user_agent         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用户终端浏览器等信息")]),s._v("\n$http_x_forwarded_for\n$sent_http_NAME          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以设置任意http响应头字段；变量名中的后半部分NAME可以替换成任意响应头字段, 如需要设置响应头Content-length, $sent_http_content_length即可")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $sent_http_cache_control")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $sent_http_connection")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $sent_http_content_type")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $sent_http_keep_alive")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $sent_http_last_modified")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $sent_http_location")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $sent_http_transfer_encoding")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br")])]),t("h2",{attrs:{id:"文件服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文件服务器"}},[s._v("#")]),s._v(" 文件服务器")]),s._v(" "),t("p",[s._v("在浏览器实现查看图片或者下载文件的功能")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用SSL加密进行通信  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# listen 8888 ssl;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" localhost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定SSL证书的路径, 用于SSL/TLS加密通信  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# ssl_certificate "/ssl/test.pem";  ')]),s._v("\n      \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定SSL证书的私钥的路径, 用于解密SSL/TLS通信  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# ssl_certificate_key "/ssl/test.pem.key";  ')]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /images")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" C:/Users/33153/Desktop")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n  \n  \t"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /images-alias")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alias")]),s._v(" C:/Users/33153/Desktop/images")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("h3",{attrs:{id:"通过参数是否下载文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通过参数是否下载文件"}},[s._v("#")]),s._v(" 通过参数是否下载文件")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~* \\.(png|jpg|jpeg|gif)$")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" Access-Control-Allow-Origin "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解决跨域调用问题")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$args")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"down"')]),s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx的if语句")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" Access-Control-Allow-Origin "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不加这一行前面的 add_header 莫名奇妙会消失")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" content-disposition "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"attachment"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("正常访问图片会正常显示, 当加上"),t("code",[s._v("?down")]),s._v("会弹出下载框")]),s._v(" "),t("h2",{attrs:{id:"动静分离"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#动静分离"}},[s._v("#")]),s._v(" 动静分离")]),s._v(" "),t("p",[s._v("以淘宝为例, 打开一个控制台"),t("code",[s._v("Netword")]),s._v(", 选择"),t("code",[s._v("All")]),s._v(", 会发现每次打开或者刷新页面都会发送很多的请求, 其中大部分都是一些静态资源("),t("code",[s._v("html")]),s._v(","),t("code",[s._v("css")]),s._v(","),t("code",[s._v("js")]),s._v("或者图片), 其中很多都是一些静态资源, 长时间都不和会变的, 可以指定")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~ .*\\.(html|htm|gif|jpg|jpeg|bmp|png|ico|txt|js|css)")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   /homg/static_resources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("expires")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7d")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("匹配规则如下:")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("~")]),s._v("代表匹配时区分大小写")]),s._v(" "),t("li",[t("code",[s._v(".*")]),s._v("代表任意字符都可以出现零次或多次, 即资源名不限制")]),s._v(" "),t("li",[t("code",[s._v("\\.")]),s._v("代表匹配后缀分隔符"),t("code",[s._v(".")])]),s._v(" "),t("li",[t("code",[s._v("(html|htm|...)")]),s._v("代表匹配括号里所有静态资源类型")])]),s._v(" "),t("h2",{attrs:{id:"黑白名单"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#黑白名单"}},[s._v("#")]),s._v(" 黑白名单")]),s._v(" "),t("p",[t("code",[s._v("nginx")]),s._v("的黑白名单机制， 主要是通过"),t("code",[s._v("allow")]),s._v(","),t("code",[s._v("deny")]),s._v("配置项来实现:")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("allow")]),s._v(" xxx.xxx.xxx.xxx")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许指定的IP访问(白名单)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" xxx.xxx.xxx.xxx")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁止指定的IP访问(黑名单)")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("一般是将黑名单和白名单都单独写成一个文件, 然后通过"),t("code",[s._v("include")]),s._v("引入")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# blocks_ip.conf")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" 192.177.12.222")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 屏蔽192.177.12.222访问  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" 192.177.44.201")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 屏蔽192.177.44.201访问  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" 127.0.0.0/8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 屏蔽127.0.0.1 到 127.255.255.254网段中的所有IP访问  ")]),s._v("\n  \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# white_ip.conf")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("allow")]),s._v(" 192.177.12.222")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许192.177.12.222访问  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("allow")]),s._v(" 192.177.44.201")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许192.177.44.201访问  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("allow")]),s._v(" 127.45.0.0/16")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许127.45.0.1 到 127.45.255.254网段中的所有IP访问  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" all")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 除开上述IP外, 其他IP全部禁止访问  ")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("再将这两个文件在"),t("code",[s._v("nginx.conf")]),s._v("中导入")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 屏蔽该文件中的所有ip")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v(" /home/blocks_ip.conf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /myApi")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 某一系列接口只开放给白名单中的ip")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v(" /home/white_ip.conf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h2",{attrs:{id:"日志"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#日志"}},[s._v("#")]),s._v(" 日志")]),s._v(" "),t("p",[t("code",[s._v("nginx")]),s._v("的每次代理访问都会产生日志, 默认的日志位置在"),t("code",[s._v("/var/log/nginx/")]),s._v("目录下面, "),t("code",[s._v("access.log")]),s._v("为访问日志, "),t("code",[s._v("error.log")]),s._v("为错误日志, 日志配置如下:")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义日志格式")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("log_format")]),s._v(" main "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),s._v(" - "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_user")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$time_local]")]),s._v(' "'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request")]),s._v("\" '")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$status")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$body_bytes_sent")]),s._v(' "'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_referer")]),s._v("\" '")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\""),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_user_agent")]),s._v("\"'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置访问日志")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v(" G:/nginx-1.22.0/access.log main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置错误日志")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_log")]),s._v(" G:/nginx-1.22.0/error.log  error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("日志可以使用的变量可以参考"),t("a",{attrs:{href:"#nginx%E5%8F%98%E9%87%8F"}},[s._v("nginx变量")])]),s._v(" "),t("h2",{attrs:{id:"跨域"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#跨域"}},[s._v("#")]),s._v(" 跨域")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许跨域的请求，可以自定义变量$http_origin，*表示所有  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Origin'")]),s._v(" *")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许携带cookie请求  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Credentials'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'true'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许跨域请求的方法：GET,POST,OPTIONS,PUT  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Methods'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GET,POST,OPTIONS,PUT'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许请求时携带的头部信息，*表示所有  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Headers'")]),s._v(" *")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许发送按段获取资源的请求  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Expose-Headers'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Length,Content-Range'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一定要有！！！否则Post请求无法进行跨域！  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在发送Post跨域请求前，会以Options方式发送预检请求，服务器接受时才会正式请求  ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_method")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'OPTIONS'")]),s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Max-Age'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1728000")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'text/plain; charset=utf-8'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Length'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对于Options方式的请求返回204，表示接受跨域请求  ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("204")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("h2",{attrs:{id:"防盗链设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#防盗链设计"}},[s._v("#")]),s._v(" 防盗链设计")]),s._v(" "),t("p",[s._v("盗链即是指外部网站引入当前网站的资源对外展示, "),t("code",[s._v("Nginx")]),s._v("的防盗链机制实现，跟一个头部字段："),t("code",[s._v("Referer")]),s._v("有关，该字段主要描述了当前请求是从哪儿发出的，那么在"),t("code",[s._v("Nginx")]),s._v("中就可获取该值，然后判断是否为本站的资源引用请求，如果不是则不允许访问。"),t("code",[s._v("Nginx")]),s._v("中存在一个配置项为"),t("code",[s._v("valid_referers")]),s._v(", 语法如下:")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("valid_referers")]),s._v(" none | blocked | server_names | string ...")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[t("code",[s._v("none")]),s._v("：表示接受没有"),t("code",[s._v("Referer")]),s._v("字段的"),t("code",[s._v("HTTP")]),s._v("请求访问")]),s._v(" "),t("li",[t("code",[s._v("blocked")]),s._v("：表示允许"),t("code",[s._v("http://")]),s._v("或"),t("code",[s._v("https//")]),s._v("以外的请求访问")]),s._v(" "),t("li",[t("code",[s._v("server_names")]),s._v("：资源的白名单，这里可以指定允许访问的域名")]),s._v(" "),t("li",[t("code",[s._v("string")]),s._v("：可自定义字符串，支配通配符、正则表达式写法")])]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~ .*\\.(html|htm|gif|jpg|jpeg|bmp|png|ico|txt|js|css)")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置可允许的域名地址")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("valid_referers")]),s._v(" blocked 192.168.12.129")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$invalid_referer")]),s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以配置成返回一张禁止盗取的图片")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rewrite   ^/ http://xxx.com/NO.jpg;")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 也可直接返回403")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("403")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n      \n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   /homg/static_resources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("expires")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7d")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("h2",{attrs:{id:"重定向"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重定向"}},[s._v("#")]),s._v(" 重定向")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("把"),t("code",[s._v("HTTP")]),s._v("请求重定向到"),t("code",[s._v("HTTPS")])]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" www.example.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" https://"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("根据不同的路径或条件进行重定向")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /old-path")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^/old-path(.*)$ http://www.xxx.com/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" permanent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("根据查询参数进行重定向")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /old-path")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当查询参数为 name=test 时重定向")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$arg_name")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" http://www.example.com/?other=parameter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /home/old-path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])])])])])}),[],!1,null,null,null);t.default=e.exports}}]);