<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Three | An的个人笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/note-sites/favicon.ico">
    <script type="module" src="/note-sites/js/index.js"></script>
    <meta name="description" content="记录学习笔记">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/note-sites/assets/css/0.styles.a5e0cdd4.css" as="style"><link rel="preload" href="/note-sites/assets/js/app.68ee92f0.js" as="script"><link rel="preload" href="/note-sites/assets/js/5.2f78da70.js" as="script"><link rel="preload" href="/note-sites/assets/js/1.9e97c91a.js" as="script"><link rel="preload" href="/note-sites/assets/js/3.ef78bef5.js" as="script"><link rel="prefetch" href="/note-sites/assets/js/10.85cb6931.js"><link rel="prefetch" href="/note-sites/assets/js/11.4bc5f074.js"><link rel="prefetch" href="/note-sites/assets/js/12.c7e5e802.js"><link rel="prefetch" href="/note-sites/assets/js/13.2630cc8f.js"><link rel="prefetch" href="/note-sites/assets/js/14.ae426a02.js"><link rel="prefetch" href="/note-sites/assets/js/15.767b651d.js"><link rel="prefetch" href="/note-sites/assets/js/16.66a76d0d.js"><link rel="prefetch" href="/note-sites/assets/js/17.1a0b29d6.js"><link rel="prefetch" href="/note-sites/assets/js/18.06b41def.js"><link rel="prefetch" href="/note-sites/assets/js/19.61f852e8.js"><link rel="prefetch" href="/note-sites/assets/js/20.5d618384.js"><link rel="prefetch" href="/note-sites/assets/js/21.71d2e6b4.js"><link rel="prefetch" href="/note-sites/assets/js/22.f1329070.js"><link rel="prefetch" href="/note-sites/assets/js/23.fe0e18f1.js"><link rel="prefetch" href="/note-sites/assets/js/24.095ee215.js"><link rel="prefetch" href="/note-sites/assets/js/25.4bd25a1a.js"><link rel="prefetch" href="/note-sites/assets/js/26.74c89f2b.js"><link rel="prefetch" href="/note-sites/assets/js/27.ef2047b7.js"><link rel="prefetch" href="/note-sites/assets/js/28.5449feb5.js"><link rel="prefetch" href="/note-sites/assets/js/29.400d2929.js"><link rel="prefetch" href="/note-sites/assets/js/30.1ed7be0a.js"><link rel="prefetch" href="/note-sites/assets/js/31.a814529e.js"><link rel="prefetch" href="/note-sites/assets/js/32.0a163ba4.js"><link rel="prefetch" href="/note-sites/assets/js/33.c1600c51.js"><link rel="prefetch" href="/note-sites/assets/js/34.4a5b7210.js"><link rel="prefetch" href="/note-sites/assets/js/35.73e2b22d.js"><link rel="prefetch" href="/note-sites/assets/js/36.9bb6764f.js"><link rel="prefetch" href="/note-sites/assets/js/37.ab8de429.js"><link rel="prefetch" href="/note-sites/assets/js/38.269637f1.js"><link rel="prefetch" href="/note-sites/assets/js/39.0abd20e9.js"><link rel="prefetch" href="/note-sites/assets/js/4.cfcf969d.js"><link rel="prefetch" href="/note-sites/assets/js/40.6bed602e.js"><link rel="prefetch" href="/note-sites/assets/js/41.01ebe269.js"><link rel="prefetch" href="/note-sites/assets/js/42.6a797844.js"><link rel="prefetch" href="/note-sites/assets/js/43.aa021ac5.js"><link rel="prefetch" href="/note-sites/assets/js/44.db30e153.js"><link rel="prefetch" href="/note-sites/assets/js/6.689d7b7c.js"><link rel="prefetch" href="/note-sites/assets/js/7.61d7f975.js"><link rel="prefetch" href="/note-sites/assets/js/8.fe1371a3.js"><link rel="prefetch" href="/note-sites/assets/js/9.a9dfe185.js">
    <link rel="stylesheet" href="/note-sites/assets/css/0.styles.a5e0cdd4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-c0d124fa><div data-v-c0d124fa><div class="password-shadow password-wrapper-out" style="display:none;" data-v-30dff670 data-v-c0d124fa data-v-c0d124fa><h3 class="title" data-v-30dff670>An的个人笔记</h3> <p class="description" data-v-30dff670>记录学习笔记</p> <label id="box" class="inputBox" data-v-30dff670><input type="password" value="" data-v-30dff670> <span data-v-30dff670>Konck! Knock!</span> <button data-v-30dff670>OK</button></label> <div class="footer" data-v-30dff670><span data-v-30dff670><i class="iconfont reco-theme" data-v-30dff670></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-30dff670>vuePress-theme-reco</a></span> <span data-v-30dff670><i class="iconfont reco-copyright" data-v-30dff670></i> <a data-v-30dff670><span data-v-30dff670>An</span>
          
        <!---->
        2023
      </a></span></div></div> <div class="hide" data-v-c0d124fa><header class="navbar" data-v-c0d124fa><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note-sites/" class="home-link router-link-active"><!----> <span class="site-name">An的个人笔记</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note-sites/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><a href="/note-sites/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  全部
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-sites/categories/第三方库/" class="nav-link"><i class="undefined"></i>
  第三方库
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/编程语言/" class="nav-link"><i class="undefined"></i>
  编程语言
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/前端基础/" class="nav-link"><i class="undefined"></i>
  前端基础
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/版本管理/" class="nav-link"><i class="undefined"></i>
  版本管理
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/数据库/" class="nav-link"><i class="undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/Shell/" class="nav-link"><i class="undefined"></i>
  Shell
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/包管理工具/" class="nav-link"><i class="undefined"></i>
  包管理工具
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/Linux/" class="nav-link"><i class="undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/web开发框架/" class="nav-link"><i class="undefined"></i>
  web开发框架
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/混合开发/" class="nav-link"><i class="undefined"></i>
  混合开发
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/小程序/" class="nav-link"><i class="undefined"></i>
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/打包工具/" class="nav-link"><i class="undefined"></i>
  打包工具
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/编程干货/" class="nav-link"><i class="undefined"></i>
  编程干货
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/系统语言/" class="nav-link"><i class="undefined"></i>
  系统语言
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-document"></i>
      前端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-sites/guide/HTML/HTML.html" class="nav-link"><i class="undefined"></i>
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/CSS/CSS.html" class="nav-link"><i class="undefined"></i>
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/JavaScript/JavaScript.html" class="nav-link"><i class="undefined"></i>
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/TypeScript/TypeScript.html" class="nav-link"><i class="undefined"></i>
  TypeScript
</a></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-sites/guide/JQuery/JQuery.html" class="nav-link"><i class="undefined"></i>
  JQuery
</a></li><li class="dropdown-subitem"><a href="/note-sites/guide/JavaScript/AJAX.html" class="nav-link"><i class="undefined"></i>
  AJAX
</a></li><li class="dropdown-subitem"><a href="/note-sites/guide/Axios/Axios.html" class="nav-link"><i class="undefined"></i>
  Axios
</a></li><li class="dropdown-subitem"><a href="/note-sites/guide/webpack/webpack.html" class="nav-link"><i class="undefined"></i>
  webpack
</a></li><li class="dropdown-subitem"><a href="/note-sites/guide/Three/Three.html" aria-current="page" class="nav-link router-link-exact-active router-link-active"><i class="undefined"></i>
  Three
</a></li><li class="dropdown-subitem"><a href="/note-sites/guide/Electron/Electron.html" class="nav-link"><i class="undefined"></i>
  electron
</a></li><li class="dropdown-subitem"><a href="/note-sites/guide/Electron/VS Code.html" class="nav-link"><i class="undefined"></i>
  VS Code
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/设计模式.html" class="nav-link"><i class="undefined"></i>
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/Node/Node.html" class="nav-link"><i class="undefined"></i>
  Node
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/Node/Npm.html" class="nav-link"><i class="undefined"></i>
  npm
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      框架
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-sites/guide/Vue/Vue2.html" class="nav-link"><i class="undefined"></i>
  Vue2
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/Vue/Vue3.html" class="nav-link"><i class="undefined"></i>
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/React/React-16.html" class="nav-link"><i class="undefined"></i>
  React-16
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/React/React-18.html" class="nav-link"><i class="undefined"></i>
  React-18
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/微信小程序/微信小程序.html" class="nav-link"><i class="undefined"></i>
  微信小程序
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-other"></i>
      其他
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-sites/guide/Git/Git.html" class="nav-link"><i class="undefined"></i>
  Git
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/C语言/C语言.html" class="nav-link"><i class="undefined"></i>
  C语言
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/Java/Java.html" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/ArcGIS/ArcGIS.html" class="nav-link"><i class="undefined"></i>
  ArcGIS
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/Linux/Linux.html" class="nav-link"><i class="undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/Linux/Shell.html" class="nav-link"><i class="undefined"></i>
  Shell
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/Rust/Rust.html" class="nav-link"><i class="undefined"></i>
  Rust
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      博客生成工具
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://vuepress.vuejs.org/zh" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  vuepress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://vuepress-theme-reco.recoluan.com" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  vuepress-theme-reco
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-c0d124fa></div> <aside class="sidebar" data-v-c0d124fa><div class="personal-info-wrapper" data-v-5c49c935 data-v-c0d124fa><img src="/note-sites/assets/img/logo.png" alt="author-avatar" class="personal-img" data-v-5c49c935> <h3 class="name" data-v-5c49c935>
    An
  </h3> <div class="num" data-v-5c49c935><div data-v-5c49c935><h3 data-v-5c49c935>33</h3> <h6 data-v-5c49c935>文章</h6></div> <div data-v-5c49c935><h3 data-v-5c49c935>26</h3> <h6 data-v-5c49c935>标签</h6></div></div> <ul class="social-links" data-v-5c49c935><li class="social-item" data-v-5c49c935><i class="iconfont reco-github" style="color:#849b87;" data-v-5c49c935></i></li><li class="social-item" data-v-5c49c935><i class="iconfont reco-mayun" style="color:#abbd81;" data-v-5c49c935></i></li><li class="social-item" data-v-5c49c935><i class="iconfont reco-juejin" style="color:#67cc86;" data-v-5c49c935></i></li><li class="social-item" data-v-5c49c935><i class="iconfont reco-npm" style="color:#f8b26a;" data-v-5c49c935></i></li><li class="social-item" data-v-5c49c935><i class="iconfont reco-bilibili" style="color:#849b87;" data-v-5c49c935></i></li></ul> <hr data-v-5c49c935></div> <nav class="nav-links"><div class="nav-item"><a href="/note-sites/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><a href="/note-sites/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  全部
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-sites/categories/第三方库/" class="nav-link"><i class="undefined"></i>
  第三方库
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/编程语言/" class="nav-link"><i class="undefined"></i>
  编程语言
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/前端基础/" class="nav-link"><i class="undefined"></i>
  前端基础
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/版本管理/" class="nav-link"><i class="undefined"></i>
  版本管理
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/数据库/" class="nav-link"><i class="undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/Shell/" class="nav-link"><i class="undefined"></i>
  Shell
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/包管理工具/" class="nav-link"><i class="undefined"></i>
  包管理工具
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/Linux/" class="nav-link"><i class="undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/web开发框架/" class="nav-link"><i class="undefined"></i>
  web开发框架
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/混合开发/" class="nav-link"><i class="undefined"></i>
  混合开发
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/小程序/" class="nav-link"><i class="undefined"></i>
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/打包工具/" class="nav-link"><i class="undefined"></i>
  打包工具
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/编程干货/" class="nav-link"><i class="undefined"></i>
  编程干货
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/categories/系统语言/" class="nav-link"><i class="undefined"></i>
  系统语言
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-document"></i>
      前端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-sites/guide/HTML/HTML.html" class="nav-link"><i class="undefined"></i>
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/CSS/CSS.html" class="nav-link"><i class="undefined"></i>
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/JavaScript/JavaScript.html" class="nav-link"><i class="undefined"></i>
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/TypeScript/TypeScript.html" class="nav-link"><i class="undefined"></i>
  TypeScript
</a></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-sites/guide/JQuery/JQuery.html" class="nav-link"><i class="undefined"></i>
  JQuery
</a></li><li class="dropdown-subitem"><a href="/note-sites/guide/JavaScript/AJAX.html" class="nav-link"><i class="undefined"></i>
  AJAX
</a></li><li class="dropdown-subitem"><a href="/note-sites/guide/Axios/Axios.html" class="nav-link"><i class="undefined"></i>
  Axios
</a></li><li class="dropdown-subitem"><a href="/note-sites/guide/webpack/webpack.html" class="nav-link"><i class="undefined"></i>
  webpack
</a></li><li class="dropdown-subitem"><a href="/note-sites/guide/Three/Three.html" aria-current="page" class="nav-link router-link-exact-active router-link-active"><i class="undefined"></i>
  Three
</a></li><li class="dropdown-subitem"><a href="/note-sites/guide/Electron/Electron.html" class="nav-link"><i class="undefined"></i>
  electron
</a></li><li class="dropdown-subitem"><a href="/note-sites/guide/Electron/VS Code.html" class="nav-link"><i class="undefined"></i>
  VS Code
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/设计模式.html" class="nav-link"><i class="undefined"></i>
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/Node/Node.html" class="nav-link"><i class="undefined"></i>
  Node
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/Node/Npm.html" class="nav-link"><i class="undefined"></i>
  npm
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      框架
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-sites/guide/Vue/Vue2.html" class="nav-link"><i class="undefined"></i>
  Vue2
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/Vue/Vue3.html" class="nav-link"><i class="undefined"></i>
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/React/React-16.html" class="nav-link"><i class="undefined"></i>
  React-16
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/React/React-18.html" class="nav-link"><i class="undefined"></i>
  React-18
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/微信小程序/微信小程序.html" class="nav-link"><i class="undefined"></i>
  微信小程序
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-other"></i>
      其他
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-sites/guide/Git/Git.html" class="nav-link"><i class="undefined"></i>
  Git
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/C语言/C语言.html" class="nav-link"><i class="undefined"></i>
  C语言
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/Java/Java.html" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/ArcGIS/ArcGIS.html" class="nav-link"><i class="undefined"></i>
  ArcGIS
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/Linux/Linux.html" class="nav-link"><i class="undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/Linux/Shell.html" class="nav-link"><i class="undefined"></i>
  Shell
</a></li><li class="dropdown-item"><!----> <a href="/note-sites/guide/Rust/Rust.html" class="nav-link"><i class="undefined"></i>
  Rust
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      博客生成工具
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://vuepress.vuejs.org/zh" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  vuepress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://vuepress-theme-reco.recoluan.com" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  vuepress-theme-reco
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-30dff670 data-v-c0d124fa><h3 class="title" data-v-30dff670>Three</h3> <!----> <label id="box" class="inputBox" data-v-30dff670><input type="password" value="" data-v-30dff670> <span data-v-30dff670>Konck! Knock!</span> <button data-v-30dff670>OK</button></label> <div class="footer" data-v-30dff670><span data-v-30dff670><i class="iconfont reco-theme" data-v-30dff670></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-30dff670>vuePress-theme-reco</a></span> <span data-v-30dff670><i class="iconfont reco-copyright" data-v-30dff670></i> <a data-v-30dff670><span data-v-30dff670>An</span>
          
        <!---->
        2023
      </a></span></div></div> <div data-v-c0d124fa><div data-v-c0d124fa><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">Three</h1> <div data-v-7b22c628><i class="iconfont reco-account" data-v-7b22c628><span data-v-7b22c628>An</span></i> <i class="iconfont reco-date" data-v-7b22c628><span data-v-7b22c628>2022/3/5</span></i> <!----> <i class="tags iconfont reco-tag" data-v-7b22c628><span class="tag-item" data-v-7b22c628>Three</span></i></div></div> <div class="theme-reco-content content__default"><div><h1 id="three"><a class="header-anchor" href="#three">#</a> Three</h1> <p>Three.js是使用面向对象的方式来构建程序,包含3个基本对象： <code>场景（scene）</code>, <code>相机</code></p> <p><code>（camera）</code>, 以及一个<code>渲染器（renderer）</code></p> <p>拿电影来类比的话,场景对应于整个布景空间,相机是拍摄镜头,渲染器用来把拍摄好的场景</p> <p>转换成胶卷（对于网页来讲,是电脑屏幕）。 场景和相机代表了3D观察空间和数据模型,渲染</p> <p>器则包含了WebGL绘图上下文和着色器</p> <blockquote><p><a href="https://threejs.org/manual/#zh/fundamentals" target="_blank" rel="noopener noreferrer">官网基础教程<OutboundLink></OutboundLink></a>, <a href="http://www.yanhuangxueyuan.com/Three.js/" target="_blank" rel="noopener noreferrer">郭隆邦教程<OutboundLink></OutboundLink></a></p></blockquote> <p></p><div class="table-of-contents"><ul><li><a href="#程序结构">程序结构</a></li><li><a href="#前置工作">前置工作</a></li><li><a href="#场景-scene">场景（scene）</a></li><li><a href="#相机-camera">相机（camera）</a><ul><li><a href="#透视相机">透视相机</a></li><li><a href="#正交相机">正交相机</a></li><li><a href="#窗口变化自适应渲染">窗口变化自适应渲染</a></li></ul></li><li><a href="#渲染器-renderer">渲染器（renderer）</a><ul><li><a href="#threejs全屏-局部渲染">Threejs全屏/局部渲染</a></li><li><a href="#css2drenderer">CSS2DRenderer</a></li></ul></li><li><a href="#几何体-geometry">几何体（geometry）</a><ul><li><a href="#圆弧线">圆弧线</a></li><li><a href="#样条曲线和贝塞尔曲线">样条曲线和贝塞尔曲线</a></li></ul></li><li><a href="#buffergeometry">BufferGeometry</a></li><li><a href="#向量-vector">向量（Vector）</a></li><li><a href="#矩阵">矩阵</a><ul><li><a href="#矩阵对象的平移-缩放-旋转">矩阵对象的平移, 缩放, 旋转</a><ul><li><a href="#视图矩阵">视图矩阵</a></li></ul></li></ul></li><li><a href="#三维对象-object3d">三维对象（Object3D）</a><ul><li><a href="#对象克隆和复制">对象克隆和复制</a></li></ul></li><li><a href="#组-group">组（Group）</a><ul><li><a href="#对象节点命名-查找-遍历">对象节点命名, 查找, 遍历</a></li><li><a href="#本地坐标系和世界坐标系">本地坐标系和世界坐标系</a></li></ul></li><li><a href="#材质-material">材质（material）</a></li><li><a href="#网格-mesh">网格（Mesh）</a></li><li><a href="#渲染场景">渲染场景</a></li><li><a href="#灯光-light">灯光（Light）</a></li><li><a href="#纹理-texture">纹理（texture）</a><ul><li><a href="#纹理对象-texture">纹理对象 Texture</a></li><li><a href="#数组材质、材质索引">数组材质、材质索引</a></li><li><a href="#纹理对象-texture-阵列、偏移、旋转">纹理对象Texture阵列、偏移、旋转</a></li><li><a href="#canvas画布、视频作为纹理贴图">canvas画布、视频作为纹理贴图</a></li><li><a href="#凹凸贴图和法线贴图">凹凸贴图和法线贴图</a></li><li><a href="#光照贴图添加阴影">光照贴图添加阴影</a></li><li><a href="#高光贴图">高光贴图</a></li><li><a href="#环境贴图">环境贴图</a></li><li><a href="#数据纹理对象">数据纹理对象</a></li></ul></li><li><a href="#雾">雾</a></li><li><a href="#加载器">加载器</a><ul><li><a href="#加载管理器">加载管理器</a></li></ul><ul><li><a href="#fileloader">FileLoader</a></li></ul></li><li><a href="#精灵模型和粒子系统">精灵模型和粒子系统</a><ul><li><a href="#精灵模型-sprite">精灵模型Sprite</a><ul><li><a href="#spritematerial">SpriteMaterial</a></li><li><a href="#sprite-用途">Sprite用途</a></li></ul></li></ul></li><li><a href="#帧动画模块">帧动画模块</a><ul><li><a href="#解析外部模型的帧动画">解析外部模型的帧动画</a></li><li><a href="#播放设置">播放设置</a></li></ul></li><li><a href="#骨骼动画和变形动画">骨骼动画和变形动画</a><ul><li><a href="#骨骼动画">骨骼动画</a></li><li><a href="#变形动画">变形动画</a></li></ul></li><li><a href="#语音模块">语音模块</a><ul><li><a href="#非位置音频">非位置音频</a></li><li><a href="#位置音频">位置音频</a></li><li><a href="#音乐可视化">音乐可视化</a></li></ul></li><li><a href="#加载外部模型文件">加载外部模型文件</a><ul><li><a href="#数据结构、导入导出">数据结构、导入导出</a></li><li><a href="#stl格式模型加载">.stl格式模型加载</a></li><li><a href="#加载-obj模型文件">加载.obj模型文件</a></li><li><a href="#加载fbx并解析骨骼动画">加载FBX并解析骨骼动画</a></li></ul></li><li><a href="#辅助对象">辅助对象</a><ul><li><a href="#三维坐标系-axeshelper">三维坐标系（AxesHelper）</a></li><li><a href="#光的辅助对象">光的辅助对象</a></li><li><a href="#相机视锥-camerahelper">相机视锥（CameraHelper）</a></li><li><a href="#轨道控制器-orbitcontrols">轨道控制器（OrbitControls）</a></li><li><a href="#数学函数">数学函数</a></li><li><a href="#用户界面工具-lil-gui">用户界面工具（lil-gui）</a></li></ul></li></ul></div><p></p> <h2 id="程序结构"><a class="header-anchor" href="#程序结构">#</a> 程序结构</h2> <p><img src="/note-sites/assets/img/three.f7ab9747.png" alt="image-20220104174911093"></p> <h2 id="前置工作"><a class="header-anchor" href="#前置工作">#</a> 前置工作</h2> <p>准备容器和初始化样式</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// css</span>
body <span class="token punctuation">{</span>
    <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token literal-property property">overflow</span><span class="token operator">:</span> hidden<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
canvas <span class="token punctuation">{</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span>
<span class="token punctuation">}</span>

<span class="token comment">// html</span>
<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;container&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token comment">// 引入 three</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;../../libs/three.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="场景-scene"><a class="header-anchor" href="#场景-scene">#</a> 场景（scene）</h2> <p><a href="https://threejs.org/docs/index.html?q=scene#api/zh/scenes/Scene" target="_blank" rel="noopener noreferrer"><code>THREE.Scene()</code><OutboundLink></OutboundLink></a></p> <p>一个容器,容纳着除渲染器以外的三维世界里的一切。场景的元素采用<strong>右手笛卡尔坐标系</strong>,<strong>x轴</strong></p> <p><strong>正方向向右,y轴正方向向上,z轴由屏幕从里向外</strong></p> <p><img src="/note-sites/assets/img/sceneModule.6a1f4329.png" alt=""></p> <p>场景能够让你在什么地方、摆放什么东西来交给 Threejs 来渲染,这是你放置物体、灯光和摄像机的地方</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 创建场景</span>
<span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置场景的背景颜色</span>
scene<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span><span class="token string">'#ff0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 将指定物体添加到场景中</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>xxx<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>需要<code>Threejs</code>绘制的东西都需要加入到<code>scene</code>中</p> <table><thead><tr><th>属性(方法)</th> <th>描述</th></tr></thead> <tbody><tr><td><strong>background</strong></td> <td>可以设置场景的背景颜色, 其实为<strong>Color</strong>实例</td></tr> <tr><td><strong>add(object)</strong></td> <td>向场景中添加对象, 该方法还可以创建对象组</td></tr> <tr><td><strong>children</strong></td> <td>用于返回一个场景中所有对象的列表, 包括摄像机和光源</td></tr> <tr><td><strong>getObjectByName(name, recursive)</strong></td> <td>在创建对象时可以指定唯一的标识 name, <br>使用该方法可以获取到指定名字的对象, <br>参数 recursive 为 false,只在调用者子对象上查找, <br>                    为true时在调用者所有后代对象上查找</td></tr> <tr><td><strong>remove(object)</strong></td> <td>object 为对象的引用, 在场景中删除给定的对象</td></tr> <tr><td><strong>traverse(callback)</strong></td> <td>迭代方法, 可以遍历调用者和调用者的所有后代(<strong>children</strong>)</td></tr></tbody></table> <p>场景图在 3D 引擎是一个树形节点的层次结构,其中每个节点代表了一个局部空间（local space）</p> <p>子节点的<code>position</code>或<code>rotation</code>设置的位置都是依据父节点的位置进行调整的</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 父mesh</span>
<span class="token keyword">const</span> parentMesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 子mesh</span>
<span class="token keyword">const</span> chilrenMesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 将 chilrenMesh 添加到 parentMesh</span>
parentMesh<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>chilrenMesh<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 位置调整就是参考 parentMesh 的位置去调整的</span>
chilrenMesh<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>还可以通过<code>Object3D</code>或者<code>Group</code>对象来作为父对象</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Object3D</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>parentMesh<span class="token punctuation">,</span> chilrenMesh<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>更详细介绍见官方, <a href="https://threejs.org/manual/#zh/scenegraph" target="_blank" rel="noopener noreferrer">场景图<OutboundLink></OutboundLink></a></p></blockquote> <h2 id="相机-camera"><a class="header-anchor" href="#相机-camera">#</a> 相机（camera）</h2> <p>针对不同应用的三维场景需要使用不同的投影方式，比如机械、工业设计领域常常采用正投影(平行投影), 大型游戏场景往往采用透视投影(中心投影), three.js封装WebGL API和相关算法如下:</p> <p><img src="/note-sites/assets/img/image-20220112223941923.3fbdf583.png" alt="image-20220112223941923"></p> <p>符合物理世界近大远小真实情况的透视相机<a href="https://threejs.org/docs/index.html#api/zh/cameras/PerspectiveCamera" target="_blank" rel="noopener noreferrer"><code>PerspectiveCamera</code><OutboundLink></OutboundLink></a></p> <p>远近大小是一样的,就要用正交相机<a href="https://threejs.org/docs/index.html#api/zh/cameras/OrthographicCamera" target="_blank" rel="noopener noreferrer"><code>OrthographicCamera</code><OutboundLink></OutboundLink></a></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 创建透视相机</span>
<span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PerspectiveCamera</span><span class="token punctuation">(</span> <span class="token number">45</span><span class="token punctuation">,</span> winW <span class="token operator">/</span> winH<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 添加到场景中</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> camera <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="透视相机"><a class="header-anchor" href="#透视相机">#</a> 透视相机</h3> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token constant">THREE</span><span class="token punctuation">.</span><span class="token function">PerspectiveCamera</span><span class="token punctuation">(</span>fovy<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 构造函数参数</span>
<span class="token comment">// fovy：视场角</span>
<span class="token comment">// aspect：视场宽高比（一般用 画布宽/画布高）</span>
<span class="token comment">// near：能看多近</span>
<span class="token comment">// far：能看多远</span>
<span class="token comment">// 这几个参数决定了哪些scene里的三维顶点会被渲染/绘制出来</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="/note-sites/assets/img/image-20220109175725331.bd1f2012.png" alt="image-20220109175725331"></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 获取窗口的宽高</span>
<span class="token keyword">const</span> winW <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
<span class="token keyword">const</span> winH <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
k <span class="token operator">=</span> winW <span class="token operator">/</span> winH<span class="token punctuation">;</span><span class="token comment">//窗口宽高比</span>
<span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>OrthographicCamera</span><span class="token punctuation">(</span> winW <span class="token operator">/</span> <span class="token operator">-</span> k<span class="token punctuation">,</span> winW <span class="token operator">/</span> k<span class="token punctuation">,</span> winH <span class="token operator">/</span> k<span class="token punctuation">,</span> 
                                            winH <span class="token operator">/</span> <span class="token operator">-</span> k<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> camera <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="正交相机"><a class="header-anchor" href="#正交相机">#</a> 正交相机</h3> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token function">OrthographicCamera</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 构造函数参数</span>
<span class="token comment">// left — 摄像机视锥体左侧面</span>
<span class="token comment">// right — 摄像机视锥体右侧面</span>
<span class="token comment">// top — 摄像机视锥体上侧面</span>
<span class="token comment">// bottom — 摄像机视锥体下侧面</span>
<span class="token comment">// near — 摄像机视锥体近端面</span>
<span class="token comment">// far — 摄像机视锥体远端面</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>每次变换方向位置之后, 需要调用 <a href="https://threejs.org/docs/index.html?q=camera#api/zh/core/Object3D.updateMatrix" target="_blank" rel="noopener noreferrer"><code>updateMatrix</code><OutboundLink></OutboundLink></a>方法来变换矩阵</p></blockquote> <p><img src="/note-sites/assets/img/image-20220109175653564.759f698b.png" alt="image-20220109175653564"></p> <p><strong>常用属性(方法)</strong></p> <table><thead><tr><th>属性(方法)</th> <th>描述</th></tr></thead> <tbody><tr><td>aspect</td> <td>设置摄像机视锥体的长宽比,通常是使用画布的宽/画布的高。默认值是<strong>1</strong>（正方形画布）</td></tr> <tr><td>zoom</td> <td>获取或者设置摄像机的缩放倍数,其默认值为<strong>1</strong></td></tr> <tr><td>position.set(x, y, z)</td> <td>设置相机的xyz</td></tr> <tr><td>updateProjectionMatrix()</td> <td>更新摄像机投影矩阵, 在任何参数被改变以后必须被调用,不然相机不会更新</td></tr></tbody></table> <p><strong>lookAth函数</strong></p> <p><code>.lookAt()</code>方法用来指定相机拍摄对象的坐标位置，<code>.lookAt()</code>方法的参数是表示位置坐标的三维向量对象<a href="https://threejs.org/docs/index.html?q=vector#api/zh/math/Vector3" target="_blank" rel="noopener noreferrer">Vector3<OutboundLink></OutboundLink></a>，所以<code>.lookAt()</code>方法的参数可以通过代码<code>new THREE.Vector3(x,y,z)</code>设置, 如果需要让相机对准某个对象，就返回那个对象的位置属性<code>.posiiotn</code>, 本质上就是计算出相机对象的视图矩阵<code>.matrixWorldInverse</code></p> <p>对于透视投影而言，相机位置与<code>lookAt</code>指向的观察目标位置间隔距离越小，场景中的三维模型放大倍数越大，准确地说是透视投影相机可以拍摄的范围更小，同时场景<code>Scene</code>中超出的相机参数约束范围的部分会被剪裁掉</p> <p><img src="/note-sites/assets/img/image-20220109175811479.f0a7a392.png" alt="image-20220109180246531"></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 设置相机上方向位置</span>
<span class="token comment">// camera.up属性默认值是 new THREE.Vector3(0,0,1),沿着z轴朝上</span>
camera<span class="token punctuation">.</span>up<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 让相机&quot;看向&quot;指定的 0,0,0 位置</span>
camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 看向指定位置</span>
camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><code>lookAt</code>函数可以实现摄像机跟随某个物体的效果</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    <span class="token comment">// 摄像机跟随mesh对象移动</span>
    camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>mesh<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>相机位置放置</strong></p> <p>如果是观察一个产品外观效果, 相机就位于几何体的外面, 如果是室内漫游预览, 就把相机放在房间三维模型的内部</p> <blockquote><p>如设置了<code>OrbitControls</code>则会失效, 需要的话可以设置<code>OrbitControls.target.set()</code>的属性</p></blockquote> <h3 id="窗口变化自适应渲染"><a class="header-anchor" href="#窗口变化自适应渲染">#</a> 窗口变化自适应渲染</h3> <p>鼠标拖动使浏览器的窗口变大，Threejs渲染器的渲染尺寸范围没有跟着变化，出现局部空白区域。对于这种情况要做的就是重新获</p> <p>取浏览器窗口新的宽高尺寸，然后通过新的宽高尺寸更新相机<a href="https://threejs.org/docs/index.html?q=cam#api/zh/cameras/Camera" target="_blank" rel="noopener noreferrer">Camera<OutboundLink></OutboundLink></a>和渲染器<a href="https://threejs.org/docs/index.html?q=renderer#api/zh/renderers/WebGLRenderer" target="_blank" rel="noopener noreferrer">WebGLRenderer<OutboundLink></OutboundLink></a>的参数即可</p> <p><strong>视图矩阵<code>.matrixWorldInverse</code>和投影矩阵<code>.projectionMatrix</code></strong></p> <p>所谓相机对象<a href="https://threejs.org/docs/index.html?q=camera#api/zh/cameras/Camera" target="_blank" rel="noopener noreferrer">Camera<OutboundLink></OutboundLink></a>本质上就是视图矩阵<code>.matrixWorldInverse</code>和投影矩阵<code>.projectionMatrix</code>，Threejs渲染场景的时候调用相机对象的视图矩阵和投影矩阵值对顶点进行矩阵变换, Threejs渲染的时候会通过设置的相机参数按照一定的算法计算出投影和视图矩阵值</p> <p><strong>正交相机自适应渲染</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// onresize 事件会在窗口被调整大小时发生</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> handleResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">handleResize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取窗口的宽高</span>
    <span class="token keyword">const</span> winW <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
    <span class="token keyword">const</span> winH <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
    <span class="token comment">// 重置渲染器输出画布canvas尺寸</span>
    renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>winW<span class="token punctuation">,</span> winH<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 重置相机投影的相关参数</span>
    k <span class="token operator">=</span> winW <span class="token operator">/</span> winH<span class="token punctuation">;</span><span class="token comment">//窗口宽高比</span>
    camera<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> k<span class="token punctuation">;</span>
    camera<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">*</span> k<span class="token punctuation">;</span>
    camera<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    camera<span class="token punctuation">.</span>bottom <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">// 渲染器执行render方法的时候会读取相机对象的投影矩阵属性projectionMatrix</span>
    <span class="token comment">// 但是不会每渲染一帧，就通过相机的属性计算投影矩阵(节约计算资源)</span>
    <span class="token comment">// 如果相机的一些属性发生了变化，需要执行updateProjectionMatrix()方法更新相机的投影矩阵</span>
    camera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>透视投影相机自适应渲染</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// onresize 事件会在窗口被调整大小时发生</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> handleResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">handleResize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取窗口的宽高</span>
    <span class="token keyword">const</span> winW <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
    <span class="token keyword">const</span> winH <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
	<span class="token comment">// 重置渲染器输出画布canvas尺寸</span>
    renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>winW<span class="token punctuation">,</span> winH<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 全屏情况下：设置观察范围长宽比aspect为窗口宽高比</span>
    camera<span class="token punctuation">.</span>aspect <span class="token operator">=</span> winW <span class="token operator">/</span> winH<span class="token punctuation">;</span>
    <span class="token comment">// 渲染器执行render方法的时候会读取相机对象的投影矩阵属性projectionMatrix</span>
    <span class="token comment">// 但是不会每渲染一帧，就通过相机的属性计算投影矩阵(节约计算资源)</span>
    <span class="token comment">// 如果相机的一些属性发生了变化，需要执行updateProjectionMatrix()方法更新相机的投影矩阵</span>
    camera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><blockquote><p>Threejs自适应渲染不一定就是窗口变化，本质上还是需要渲染的区域宽高尺寸变化了</p></blockquote> <h2 id="渲染器-renderer"><a class="header-anchor" href="#渲染器-renderer">#</a> 渲染器（renderer）</h2> <p><a href="https://threejs.org/docs/index.html?q=renderer#api/zh/renderers/WebGLRenderer" target="_blank" rel="noopener noreferrer"><code>THREE.WebGLRenderer()</code><OutboundLink></OutboundLink></a></p> <p><a href="https://threejs.org/docs/#api/zh/constants/Renderer" target="_blank" rel="noopener noreferrer"><strong>渲染器常量</strong><OutboundLink></OutboundLink></a></p> <p><a href="https://github.com/mrdoob/three.js/blob/master/src/constants.js" target="_blank" rel="noopener noreferrer"><strong>内置所有常量源码</strong><OutboundLink></OutboundLink></a></p> <p>将<code>camera</code>在<code>scene</code>里看到的内容渲染/绘制到画布上</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 创建渲染器</span>
<span class="token keyword">const</span> renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>WebGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 指定画布对象</span>
    <span class="token comment">// canvas: document.getElementById('canvas'),</span>
    <span class="token comment">// 开启抗锯齿</span>
    <span class="token literal-property property">animation</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// 开启透明度</span>
    <span class="token literal-property property">alpha</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设置渲染器的像素比 </span>
renderer<span class="token punctuation">.</span><span class="token function">setPixelRatio</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>devicePixelRatio<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设置输出canvas画面的大小</span>
renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>windW<span class="token punctuation">,</span> windH<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设置画布背景颜色</span>
renderer<span class="token punctuation">.</span><span class="token function">setClearColor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span><span class="token number">0x00eeee</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// or</span>
scene<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span><span class="token number">0x00eeee</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">// 添加到DOM容器(构造时指定了canvas就不用)</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 渲染场景和相机</span>
renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 顺序不能反</span>

<span class="token comment">// 设置渲染物体阴影</span>
renderer<span class="token punctuation">.</span>shadowMapEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>常用属性(方法):</p> <table><thead><tr><th>属性(方法)</th> <th>描述</th></tr></thead> <tbody><tr><td><strong>domElement</strong></td> <td>渲染器的构造函数会自动创建<code>renderer.domElement</code><br>就是渲染器绘制输出的<code>canvas</code>对象</td></tr> <tr><td><strong>render(scene, camera)</strong></td> <td>渲染场景和相机, 顺序不能反</td></tr> <tr><td><strong>setSize(width,height)</strong></td> <td>将输出<strong>canvas</strong>的大小调整为(width, height)<br>将<strong>updateStyle</strong>设置为<strong>false</strong>可以阻止对<strong>canvas</strong>的样式做任何改变</td></tr> <tr><td><strong>shadowMapEnabled</strong></td> <td>设置渲染物体的阴影</td></tr> <tr><td><strong>setClearColor()</strong></td> <td>设置颜色及其透明度</td></tr> <tr><td><strong>setScissor(x,y)</strong></td> <td>将剪裁区域设为(x, y)到(x + width, y + height)</td></tr> <tr><td><strong>setViewport(x,y)</strong></td> <td>将视口大小设置为(x, y)到 (x + width, y + height)</td></tr> <tr><td><strong>logarithmicDepthBuffer</strong></td> <td>否使用对数深度缓存。<br>如果要在单个场景中处理巨大的比例差异,就有必要使用, 默认false</td></tr> <tr><td><strong>alpha</strong></td> <td>canvas是否包含alpha (透明度)。默认为 <strong>false</strong></td></tr> <tr><td><strong>info</strong></td> <td>一个对象,包含有关图形在内存中和渲染过程的一系列统计信息</td></tr></tbody></table> <h3 id="threejs全屏-局部渲染"><a class="header-anchor" href="#threejs全屏-局部渲染">#</a> Threejs全屏/局部渲染</h3> <p>通过Threejs发开Web3D应用的时候，渲染窗口可能是全屏效果占满web页面整个body区域，也可能是web页面上一个特定位置特定区域，比如渲染区域是一个特定位置、特定宽高的div元素所在区域</p> <p><strong>全屏渲染</strong></p> <p>直接通过Threejs的WebGL渲染器<a href="https://threejs.org/docs/index.html?q=webglrenderer#api/zh/renderers/WebGLRenderer" target="_blank" rel="noopener noreferrer">WebGLRenderer<OutboundLink></OutboundLink></a>的<code>.setSize()</code>方法设置渲染尺寸为浏览器body区域宽高度</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">//设置渲染区域尺寸</span>
renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// body元素中插入Threejs渲染结果：canvas对象</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>局部渲染</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 设置渲染区域尺寸，本质就是设置输出canvas的尺寸</span>
renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 把渲染器的渲染结果canvas对象插入到'container'对应的div元素中</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>可以通过渲染结果<code>.domElement</code>(Canvas元素)的父元素div来控制渲染区域在浏览器上的位置</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 控制div位置 绝对定位  距离上方100px  距离左侧30px <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;container&quot;</span> style<span class="token operator">=</span><span class="token string">&quot;position: absolute;left: 30px;top: 100px;&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="css2drenderer"><a class="header-anchor" href="#css2drenderer">#</a> CSS2DRenderer</h3> <p><a href="https://threejs.org/docs/index.html?q=CSS2DRenderer#examples/zh/renderers/CSS2DRenderer" target="_blank" rel="noopener noreferrer">CSS2DRenderer<OutboundLink></OutboundLink></a></p> <p>需要将三维物体和基于HTML的标签相结合,这个号渲染器将十分有用</p> <p>在这里,各个DOM元素也被包含到一个<strong>CSS2DObject</strong>实例中,并被添加到场景图中</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 引入 CSS2DRenderer 和 CSS2DObject</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CSS2DRenderer<span class="token punctuation">,</span> CSS2DObject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'examples/jsm/renderers/CSS2DRenderer.js'</span><span class="token punctuation">;</span>\

<span class="token comment">// 标签渲染器</span>
<span class="token keyword">const</span> labelRenderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CSS2DRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置宽高</span>
labelRenderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置绝对定位不然会遮挡canvas里的内容</span>
labelRenderer<span class="token punctuation">.</span>domElement<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">'absolute'</span><span class="token punctuation">;</span>
<span class="token comment">// 添加到容器中</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>labelRenderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建DOM</span>
<span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'hello world'</span><span class="token punctuation">;</span>
<span class="token comment">// CSS2DObject 加工DOM元素</span>
<span class="token keyword">const</span> divLabel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CSS2DObject</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 可以设置这个 CSS2DObject 对象的位置</span>
divLabel<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 添加到需要结合的三维对象里</span>
mesh<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>divLabel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 调用 CSS2DRenderer 的渲染渲染方法 </span>
labelRenderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="几何体-geometry"><a class="header-anchor" href="#几何体-geometry">#</a> 几何体（geometry）</h2> <p>3D世界里的所有物体都是<code>点组成面</code>,<code>面组成几何体</code></p> <p><code>面</code>是由点构成的,<code>面</code>又可以组成各式各样的几何体</p> <p>Threejs 提供了很多的几何体, 如:</p> <ul><li><p><a href="https://threejs.org/docs/index.html?q=geometry#api/zh/geometries/BoxGeometry" target="_blank" rel="noopener noreferrer">THREE.BoxGeometry<OutboundLink></OutboundLink></a>: 立方体</p></li> <li><p><a href="https://threejs.org/docs/index.html?q=geometry#api/zh/geometries/CircleGeometry" target="_blank" rel="noopener noreferrer">THREE.CircleGeometry<OutboundLink></OutboundLink></a>: 圆形</p></li> <li><p><a href="https://threejs.org/docs/index.html?q=geometry#api/zh/geometries/ConeGeometry" target="_blank" rel="noopener noreferrer">THREE.ConeGeometry<OutboundLink></OutboundLink></a>: 圆锥</p></li> <li><p><strong>THREE.xxxGeometry</strong>: 指的是框架自带的几何体</p></li></ul> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 创建一个立方体</span>
<span class="token keyword">const</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 开启阴影</span>
geometry<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">// 接受阴影, 一般只有地板(PlaneGeometry)设置接受阴影</span>
geometry<span class="token punctuation">.</span>receiveShadow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">// 删除 geometry 对象</span>
geometry<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>几乎所有希望在<code>three</code>中显示的几何体都需要设置一些信息, 如: windth, height, radio等等</p> <blockquote><p>关于几何体的具体介绍见官方文档, <a href="https://threejs.org/manual/#zh/primitives" target="_blank" rel="noopener noreferrer">图元<OutboundLink></OutboundLink></a></p></blockquote> <h3 id="圆弧线"><a class="header-anchor" href="#圆弧线">#</a> 圆弧线</h3> <p><a href="https://threejs.org/docs/index.html?q=ArcCurve#api/zh/extras/curves/ArcCurve" target="_blank" rel="noopener noreferrer">ArcCurve<OutboundLink></OutboundLink></a></p> <p>圆弧线<a href="https://threejs.org/docs/index.html?q=ArcCurve#api/zh/extras/curves/ArcCurve" target="_blank" rel="noopener noreferrer">ArcCurve<OutboundLink></OutboundLink></a>的基类是椭圆弧线<a href="https://threejs.org/docs/index.html?q=ArcCurve#api/zh/extras/curves/EllipseCurve" target="_blank" rel="noopener noreferrer">EllipseCurve<OutboundLink></OutboundLink></a>, 关于圆弧线的使用方法可以查看文档中的椭圆弧线</p> <p>曲线<strong>Curd</strong>的<strong>getPoints</strong>方法</p> <p><strong>getPoints</strong>方法是<a href="https://threejs.org/docs/index.html?q=cur#api/zh/extras/core/Curve" target="_blank" rel="noopener noreferrer">Curve<OutboundLink></OutboundLink></a>方法, 圆弧线ArcCurve和椭圆弧线EllipseCurve都具有继承这个方法</p> <p>通过方法<code>.getPoints()</code>可以从圆弧线按照一定的细分精度返回沿着圆弧线分布的顶点坐标</p> <p>细分数越高返回的顶点数量越多,自然轮廓越接近于圆形, <code>.getPoints()</code>的返回值是一个由二维向量<a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/math/Vector2" target="_blank" rel="noopener noreferrer">Vector2<OutboundLink></OutboundLink></a>或</p> <p>三维向量<a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/math/Vector3" target="_blank" rel="noopener noreferrer">Vector3<OutboundLink></OutboundLink></a>构成的数组,<code>Vector2</code>表示位于同一平面内的点,<code>Vector3</code>表示三维空间中一点</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> arc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>ArcCurve</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//getPoints是基类Curve的方法,返回一个vector2对象作为元素组成的数组</span>
<span class="token keyword">const</span> points <span class="token operator">=</span> arc<span class="token punctuation">.</span><span class="token function">getPoints</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//分段数50,返回(50+1)个顶点</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>几何体方法<strong>setFromPoints</strong></p> <p><code>.setFromPoints()</code>是几何体<a href="https://threejs.org/docs/#api/zh/core/BufferGeometry" target="_blank" rel="noopener noreferrer">BufferGeometry<OutboundLink></OutboundLink></a>的方法,通过该方法可以把数组<code>points</code>中顶点数据提取出来赋值给几何体的顶点位置属性<code>geometry.vertices</code>,数组<code>points</code>的元素是二维向量<a href="https://threejs.org/docs/#api/zh/math/Vector2" target="_blank" rel="noopener noreferrer">Vector2<OutboundLink></OutboundLink></a>或三维向量<a href="https://threejs.org/docs/#api/zh/math/Vector3" target="_blank" rel="noopener noreferrer">Vector3<OutboundLink></OutboundLink></a></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// setFromPoints方法从points中提取数据改变几何体的顶点属性vertices</span>
geometry<span class="token punctuation">.</span><span class="token function">setFromPoints</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>geometry<span class="token punctuation">.</span>vertices<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 如果几何体是BufferGeometry改变的就是.attributes.position属性</span>
<span class="token comment">// console.log(geometry.attributes.position);</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="样条曲线和贝塞尔曲线"><a class="header-anchor" href="#样条曲线和贝塞尔曲线">#</a> 样条曲线和贝塞尔曲线</h3> <p>规则的曲线比如圆、椭圆、抛物线都可以用一个函数去描述,对于不规则的曲线无法使用一个特定的函数去描述,</p> <p>这也就是样条曲线和贝塞尔曲线出现的原因, three 提供了这两种曲线的API</p> <p><img src="/note-sites/assets/img/image-20220106110952912.a8c3a32e.png" alt="image-20220106110952912"></p> <p><strong>样条曲线</strong></p> <p>在三维空间中设置5个顶点,输入三维样条曲线<a href="https://threejs.org/docs/?q=CatmullRomCurve3#api/zh/extras/curves/CatmullRomCurve3" target="_blank" rel="noopener noreferrer">CatmullRomCurve3<OutboundLink></OutboundLink></a>作为参数,然后返回更多个顶点,</p> <p>通过返回的顶点数据,构建一个几何体,通过<code>Line</code>可以绘制出来一条沿着5个顶点的光滑样条曲线</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 声明一个几何体对象Geometry</span>
<span class="token keyword">const</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Geometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 三维样条曲线  Catmull-Rom算法</span>
<span class="token keyword">const</span> curve <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>CatmullRomCurve3</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// getPoints是基类Curve的方法,返回一个vector3对象作为元素组成的数组</span>
<span class="token keyword">const</span> points <span class="token operator">=</span> curve<span class="token punctuation">.</span><span class="token function">getPoints</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//分段数100,返回101个顶点</span>
<span class="token comment">// setFromPoints方法从points中提取数据改变几何体的顶点属性 vertices</span>
geometry<span class="token punctuation">.</span><span class="token function">setFromPoints</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 材质对象</span>
<span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>LineBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0x000000</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 线条模型对象</span>
<span class="token keyword">const</span> line <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Line</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//线条对象添加到场景中</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><blockquote><p>通过调用three样条曲线或贝塞尔曲线的API, 可以输入有限个顶点返回更多顶点, 绘制出一条光滑的轮廓曲线</p></blockquote> <p><strong>贝塞尔曲线</strong></p> <p>贝塞尔曲线和样条曲线不同,多了一个控制点概念</p> <p><img src="/note-sites/assets/img/bseqx.1cb43f97.gif" alt="bseqx"></p> <p>三维二次贝赛尔曲线的参数p0、p2是起始点,p1是控制点,控制点不在贝塞尔曲线上</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 三维二次贝赛尔曲线</span>
<span class="token keyword">const</span> curve <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>QuadraticBezierCurve3</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>三维三次贝赛尔曲线的参数p1、p4是起始点,p2、p3是控制点,控制点不在贝塞尔曲线上</p> <p><img src="/note-sites/assets/img/image-20220106175244438.7932024d.png" alt="image-20220106175244438"></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> p4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 三维三次贝赛尔曲线</span>
<span class="token keyword">const</span> curve <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>CubicBezierCurve3</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">,</span> p4<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="buffergeometry"><a class="header-anchor" href="#buffergeometry">#</a> BufferGeometry</h2> <p><a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/core/BufferGeometry" target="_blank" rel="noopener noreferrer"><code>THREE.BufferGeometry</code><OutboundLink></OutboundLink></a></p> <p>可以通过自定义一些 向量来自定义面, 线, 法向量, 颜色值等等</p> <p><a href="http://www.yanhuangxueyuan.com/Javascript/typeArray.html" target="_blank" rel="noopener noreferrer">Float32Array<OutboundLink></OutboundLink></a>: 类型化数组</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BufferGeometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建一个Buffer类型几何体对象</span>
<span class="token comment">//类型数组创建顶点数据</span>
<span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//顶点1坐标</span>
  <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//顶点2坐标</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//顶点3坐标</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">//顶点4坐标</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token comment">//顶点5坐标</span>
  <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">//顶点6坐标</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建属性缓冲区对象</span>
<span class="token keyword">const</span> attribue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BufferAttribute</span><span class="token punctuation">(</span>vertices<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//3个为一组,表示一个顶点的xyz坐标</span>
<span class="token comment">// 设置几何体attributes属性的位置属性</span>
geometry<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>position <span class="token operator">=</span> attribue<span class="token punctuation">;</span>
<span class="token comment">// 或者</span>
geometry<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">'position'</span><span class="token punctuation">,</span> attribue<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>使用 BufferGeometry 设置顶点颜色数据</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 类型数组创建顶点颜色color数据</span>
<span class="token keyword">const</span> colors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//顶点1颜色</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//顶点2颜色</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//顶点3颜色</span>

  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//顶点4颜色</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//顶点5颜色</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//顶点6颜色</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 3个为一组,表示一个顶点的颜色数据RGB</span>
geometry<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BufferAttribute</span><span class="token punctuation">(</span>colors<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 材质对象</span>
<span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PointsMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 使用顶点颜色数据渲染模型,不需要再定义color属性</span>
  <span class="token comment">// color: 0xff0000,</span>
  <span class="token literal-property property">vertexColors</span><span class="token operator">:</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>VertexColors<span class="token punctuation">,</span> <span class="token comment">//以顶点颜色为准</span>
  <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">10.0</span> <span class="token comment">//点对象像素尺寸</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 点渲染模式  点模型对象Points</span>
<span class="token keyword">const</span> points <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Points</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 点模型对象</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 点对象添加到场景</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>还有法向量也是类似的</p> <p>常用API总结:</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 访问几何体顶点位置数据</span>
BufferGeometry<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>position<span class="token punctuation">;</span>
<span class="token comment">// 访问几何体顶点颜色数据</span>
BufferGeometry<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>color<span class="token punctuation">;</span>
<span class="token comment">// 访问几何体顶点法向量数据</span>
BufferGeometry<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>normal<span class="token punctuation">;</span>

<span class="token comment">// 或者</span>
BufferGeometry<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>顶点索引复用顶点数据</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// Uint16Array类型数组创建顶点索引数据</span>
<span class="token keyword">const</span> indexes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>  
    <span class="token comment">// 0对应第1个顶点位置数据、第1个顶点法向量数据  </span>
    <span class="token comment">// 1对应第2个顶点位置数据、第2个顶点法向量数据  </span>
    <span class="token comment">// 索引值3个为一组,表示一个三角形的3个顶点  </span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> 
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 索引数据赋值给几何体的index属性</span>
geometry<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BufferAttribute</span><span class="token punctuation">(</span>indexes<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1个为一组</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><table><thead><tr><th>类型数组</th> <th>位数</th> <th>字节</th> <th>类型描述</th> <th>C语言等价类型</th></tr></thead> <tbody><tr><td>Int8Array</td> <td>8</td> <td>1</td> <td>有符号8位整型</td> <td>int8_t</td></tr> <tr><td>Uint8Array</td> <td>8</td> <td>1</td> <td>无符号8位整型</td> <td>uint8_t</td></tr> <tr><td>Int16Array</td> <td>16</td> <td>2</td> <td>有符号16位整型</td> <td>int16_t</td></tr> <tr><td>Uint16Array</td> <td>16</td> <td>2</td> <td>无符号16位整型</td> <td>int16_t</td></tr> <tr><td>Int32Array</td> <td>32</td> <td>4</td> <td>有符号32位整型</td> <td>int32_t</td></tr> <tr><td>Uint32Array</td> <td>32</td> <td>4</td> <td>无符号32位整型</td> <td>uint32_t</td></tr> <tr><td>Float32Array</td> <td>32</td> <td>4</td> <td>单精度(32位)浮点数</td> <td>float</td></tr> <tr><td>Float64Array</td> <td>64</td> <td>8</td> <td>双精度(64位)浮点数</td> <td>double</td></tr></tbody></table> <p><code>BufferGeometry</code>总结</p> <p><img src="/note-sites/assets/img/image-20220104212947275.8787a36d.png" alt="image-20220104212947275"></p> <h2 id="向量-vector"><a class="header-anchor" href="#向量-vector">#</a> 向量（Vector）</h2> <p>向量有<a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/math/Vector2" target="_blank" rel="noopener noreferrer">Vector2<OutboundLink></OutboundLink></a> <a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/math/Vector3" target="_blank" rel="noopener noreferrer">Vector3<OutboundLink></OutboundLink></a> <a href="http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/zh/math/Vector4" target="_blank" rel="noopener noreferrer">Vector4<OutboundLink></OutboundLink></a>, 常用的就是三维向量,</p> <p>一个三维向量表示的是一个有顺序的、三个为一组的数字组合（标记为x、y和z）, 可被用来表示很多事物, 例如：</p> <ul><li>一个位于三维空间中的点</li> <li>一个在三维空间中的方向与长度的定义</li> <li>任意的、有顺序的、三个为一组的数字组合</li></ul> <p>几何体的顶点位置属性<code>.vertices</code>和缓冲类型几何体<code>BufferGeometry</code>顶点位置属性<code>BufferGeometry.attributes.position</code>是对应的</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Geometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//声明一个几何体对象Geometry</span>
<span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//顶点1坐标</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//顶点2坐标</span>
<span class="token keyword">const</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//顶点3坐标</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Vector3 {x: 50, y: 0, z: 0}</span>

<span class="token comment">// 可以单独设置某个值</span>
p1<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
p1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">222</span><span class="token punctuation">,</span><span class="token number">333</span><span class="token punctuation">,</span><span class="token number">444</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 还可以一起设置</span>
<span class="token comment">//顶点坐标添加到geometry对象</span>
geometry<span class="token punctuation">.</span>vertices<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><a href="https://threejs.org/docs/index.html?q=color#api/zh/math/Color" target="_blank" rel="noopener noreferrer">Color<OutboundLink></OutboundLink></a>定义顶点颜色数据</p> <p>几何体的顶点颜色属性<code>.colors</code>对应<code>BufferGeometry.attributes.color</code></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// Color对象表示顶点颜色数据</span>
<span class="token keyword">const</span> color1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span><span class="token number">0x00ff00</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//顶点1颜色——绿色</span>
<span class="token keyword">const</span> color2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span><span class="token number">0xff0000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//顶点2颜色——红色</span>
<span class="token keyword">const</span> color3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span><span class="token number">0x0000ff</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//顶点3颜色——蓝色</span>
<span class="token comment">//顶点颜色数据添加到geometry对象</span>
geometry<span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>color1<span class="token punctuation">,</span> color2<span class="token punctuation">,</span> color3<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>注意设置几何体<code>Geometry</code>顶点颜色属性<code>geometry.colors</code>,对网格模型<code>Mesh</code>是无效的,对于点模型<code>Points</code>、线模型<code>Line</code>是有效果</p></blockquote> <p>材质属性<code>.vertexColors</code></p> <p>注意使用顶点颜色数据定义模型颜色的时候,要把材质的属性<code>vertexColors</code>设置为<code>THREE.VertexColors</code>,这</p> <p>样顶点的颜色数据才能取代材质颜色属性<code>.color</code>起作用</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">//材质对象</span>
<span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshLambertMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// color: 0xffff00,</span>
    <span class="token literal-property property">vertexColors</span><span class="token operator">:</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>VertexColors<span class="token punctuation">,</span> <span class="token comment">//以顶点颜色为准</span>
    <span class="token literal-property property">side</span><span class="token operator">:</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>DoubleSide<span class="token punctuation">,</span> <span class="token comment">//两面可见</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>使用向量来对网格对象控制位置</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">//向量Vector3对象表示方向</span>
<span class="token keyword">const</span> axis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
axis<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//向量归一化</span>
<span class="token comment">//沿着axis轴表示方向平移100</span>
mesh<span class="token punctuation">.</span><span class="token function">translateOnAxis</span><span class="token punctuation">(</span>axis<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> axis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//向量axis</span>
mesh<span class="token punctuation">.</span><span class="token function">rotateOnAxis</span><span class="token punctuation">(</span>axis<span class="token punctuation">,</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token operator">/</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//绕axis轴旋转π/8</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="矩阵"><a class="header-anchor" href="#矩阵">#</a> 矩阵</h2> <p>在 Threejs 中矩阵分<code>3X3</code>和<code>4X4</code>矩阵分别对应<a href="https://threejs.org/docs/index.html?q=matrix#api/zh/math/Matrix3" target="_blank" rel="noopener noreferrer">Matrix3<OutboundLink></OutboundLink></a>, <a href="https://threejs.org/docs/index.html?q=matrix#api/zh/math/Matrix4" target="_blank" rel="noopener noreferrer">Matrix4<OutboundLink></OutboundLink></a></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> m4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>位置信息存储在 <code>.elements</code>属性中, 默认值如下</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>.elements</strong> 属性排列顺序问题:</p> <p><code>.elements</code> 属性直接赋值数组属性正常按<strong>行(索引)排列</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code>m4<span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span>
    <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// m4.elements =&gt; [12, 0, 0, 12,...]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>使用 <code>set</code> 方法赋值是<strong>按列排列</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code>m4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>
    <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span>
    <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// m4.elements =&gt; [12, 0, 33, 0,...]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>transpose</code> 转置方法可以将排列方式相互转换</p> <p>本身是<strong>行排列</strong>就转换为<strong>列排列</strong>, <strong>列排列</strong>就转换为<strong>行排列</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code>m4<span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span>
    <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m4<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [12, 0, 0, 12,...]</span>

m4<span class="token punctuation">.</span><span class="token function">transpose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 本身是 行排列 将转换为 列排列</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m4<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [12, 0, 33, 0,...]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>clone</code>方法同向量的一样</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> m4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> m4c <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m4c<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>multiplyScalar</code>方法可以将将矩阵中的每个元素放大多少倍</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> m4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m4<span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
<span class="token comment">// 将矩阵中的每个元素放大10倍</span>
m4<span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m4<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [10,20,30,40,...]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>矩阵的乘法运算:</strong></p> <p><code>c.multiplyMatrices(a,b)</code>: 参数矩阵<code>a*b</code>结果保存到<code>c</code>中</p> <p><code>a.multiply(b)</code>:  矩阵<code>a*b</code>结果保存到<code>a</code>中</p> <p><code>a.premultiply(b)</code>: 矩阵<code>b*a</code>结果保存到<code>a</code>中</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
b<span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 2 =&gt; 1*2, 2*2, 3*2, 4*2 =&gt; a[2,4,6,8]</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 4 =&gt; 1*4, 2*4, 3*4, 4*4 =&gt; a[4,8,12,16]</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 5</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 6</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// multiplyMatrices 和 multiply 都是拿被乘数4位相加的和 乘于乘数的每一项</span>
a<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// a.multiply(b);</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [2, 4, 6, 8,...]</span>

a<span class="token punctuation">.</span><span class="token function">premultiply</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [10, 21, 9, 9,...]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><blockquote><p><code>multiplyMatrices</code> 和 <code>multiply</code> 都是右乘, <code>premultiply</code> 不同是左乘</p></blockquote> <h3 id="矩阵对象的平移-缩放-旋转"><a class="header-anchor" href="#矩阵对象的平移-缩放-旋转">#</a> 矩阵对象的平移, 缩放, 旋转</h3> <p>矩阵对象通过<code>.elements</code>属性和<code>set</code>方法来设置矩阵的一些变化时, 比较麻烦, Threejs 有已经封装好的API:</p> <p>绕X轴旋转: <code>makeRotationX(theta)</code></p> <p>绕Y轴旋转: <code>makeRotationY(theta)</code></p> <p>绕Z轴旋转:<code>makeRotationZ(theta)</code></p> <p>当前矩阵为围绕轴 axis 旋转量为 theta弧度: <code>makeRotationAxis (axis, theta)</code></p> <p>缩放: <code>makeScale(x,y,z)</code></p> <p>平移: <code>maketranslation(x,y,z)</code></p> <p>剪切: <code>makeShear(x,y,z)</code></p> <p>模型对象的<code>rotateX/Y/Z</code> <code>translateX/Y/Z</code> <code>scale</code>等其实都是对矩阵进行的一定影响</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mesh<span class="token punctuation">.</span>matrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 查看矩阵对象</span>

mesh<span class="token punctuation">.</span><span class="token function">rotateX</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 修改网格对象的属性其实就是修改矩阵对象的属性</span>
<span class="token comment">// mesh.position.set(2, 6, 8);</span>

mesh<span class="token punctuation">.</span><span class="token function">updateMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 更新矩阵对象</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mesh<span class="token punctuation">.</span>matrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 查看修改后的矩阵对象属性</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="视图矩阵"><a class="header-anchor" href="#视图矩阵">#</a> 视图矩阵</h4> <h2 id="三维对象-object3d"><a class="header-anchor" href="#三维对象-object3d">#</a> 三维对象（Object3D）</h2> <p><a href="https://threejs.org/docs/index.html?q=camera#api/zh/core/Object3D" target="_blank" rel="noopener noreferrer"><code>THREE.Object3D()</code><OutboundLink></OutboundLink></a></p> <p>这是 Threejs 中大部分对象的<code>基类</code>, 提供了一系列的属性和方法来对三维空间中的物体进行操纵,</p> <p>如果需要通过<a href="https://threejs.org/docs/#api/zh/core/Object3D.add" target="_blank" rel="noopener noreferrer"><code>.add(object)</code><OutboundLink></OutboundLink></a>方法来将对象进行组合, 推荐使用<code>Group</code></p> <h3 id="对象克隆和复制"><a class="header-anchor" href="#对象克隆和复制">#</a> 对象克隆和复制</h3> <p>Threejs 大多数对象都有克隆<code>.clone()</code>和复制<code>.copy()</code>两个方法,点模型<code>Points</code>、线模型<code>Line</code>、网格网格</p> <p>模型<code>Mesh</code>一样具有这两个方法</p> <p><img src="/note-sites/assets/img/image-20220105221756628.58a68bf7.png" alt="image-20220105221756628"></p> <p>复制方法 <code>copy</code></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">1.2</span><span class="token punctuation">,</span><span class="token number">2.6</span><span class="token punctuation">,</span><span class="token number">3.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 复制p1的值给p2</span>
p2<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span>
<span class="token comment">// p2向量的xyz变为p1的xyz值</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>克隆方法 <code>clone</code></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">1.2</span><span class="token punctuation">,</span><span class="token number">2.6</span><span class="token punctuation">,</span><span class="token number">3.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 克隆p1对象赋值给p2</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// p1对象和p2对象xyz属性相同</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>向量相减方法 <code>sub</code></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> v1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> v2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
v2<span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// sub 方法会影响调用者本身, 推荐克隆后再使用 v2.clone().sub(v1);</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Vector3 {x: 10, y: 20, z: 30}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>计算最长的直线长度 <code>length</code></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> v1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> v2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 克隆后再计算避免被修改属性</span>
<span class="token keyword">const</span> len <span class="token operator">=</span> v2<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 96.89685237405806</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>网格模型<strong>复制和克隆</strong></p> <p>网格模型复制克隆和三维向量基本逻辑是相同,但是注意三维向量的属性值都是基本数据类型</p> <p>网格模型对象的几何体属性<code>mesh.geometry</code>和材质属性<code>mesh.material</code>的属性值都是引用数据类型</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> box <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建一个立方体几何对象</span>
<span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshLambertMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">color</span><span class="token operator">:</span><span class="token number">0x0000ff</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//材质对象</span>
<span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>box<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//网格模型对象</span>
<span class="token keyword">const</span> mesh2 <span class="token operator">=</span> mesh<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//克隆网格模型</span>

mesh<span class="token punctuation">.</span><span class="token function">translateX</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//网格模型mesh平移</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mesh<span class="token punctuation">,</span>mesh2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//网格模型添加到场景中</span>

box<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">,</span><span class="token number">1.5</span><span class="token punctuation">,</span><span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//几何体缩放</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>两个正方体都放大了, 也就是说对网格模型来说<code>clone</code>克隆的只是浅拷贝</p></blockquote> <p>几何体<strong>复制和克隆</strong></p> <p>几何体克隆或复制和网格模型有些不同, 比如几何体的顶点属性<code>Geometry.vertices</code>属性是一个数组对象</p> <p>但是复制或克隆的时候, 不是获得对象的索引值, 而是深拷贝属性的值</p> <h2 id="组-group"><a class="header-anchor" href="#组-group">#</a> 组（Group）</h2> <p><a href="https://threejs.org/docs/#api/zh/objects/Group" target="_blank" rel="noopener noreferrer"><code>THREE.Group()</code><OutboundLink></OutboundLink></a></p> <p>和<code>Object3D</code>类似, 可以通过<code>Group</code>的<code>add</code>方法把多个几何图形组成一个组,</p> <p>组的结构类似于<code>DOM</code>树, 修改父对象将会同时影响它下面的所有子对象</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 添加子对象</span>
group<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mesh1<span class="token punctuation">,</span> mesh2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 父对象旋转,子对象跟着旋转</span>
group<span class="token punctuation">.</span><span class="token function">rotateY</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">6</span><span class="token punctuation">)</span>
<span class="token comment">// 添加到场景中</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>myGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>.children</code>属性(数组)保存的就是自身所有的子对象</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>group<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>父对象执行<code>.add()</code>方法的本质就是把参数中的子对象添加到自身<code>.children</code>数组中</p></blockquote> <p><strong>remove</strong>方法</p> <p><code>.remove()</code>方法是删除父对象中的一个子对象, 和<code>.add()</code>一样改变的都是父对象的<code>.children()</code>属性</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 删除父对象myGroup的子对象网格模型mesh1</span>
group<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>mesh1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 一次删除场景中多个对象</span>
scene<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>light<span class="token punctuation">,</span> group<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="对象节点命名-查找-遍历"><a class="header-anchor" href="#对象节点命名-查找-遍历">#</a> 对象节点命名, 查找, 遍历</h3> <p><strong>模型命名</strong></p> <p>在层级模型中可以给一些模型对象通过<code>.name</code>属性命名进行标记</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code>group<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>Mesh<span class="token punctuation">)</span>
<span class="token comment">// 网格模型命名</span>
Mesh<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;眼睛&quot;</span>
<span class="token comment">// mesh父对象对象命名</span>
group<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;头&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>查找某个具体的模型</strong></p> <p>为 Group 命名,可以通过<code>getObjectByName</code>方法来获取到对应<strong>name</strong>属性的对象：</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 遍历查找对象的子对象,返回name对应的对象（name是可以重名的,返回第一个）</span>
<span class="token keyword">const</span> nameNode <span class="token operator">=</span> scene<span class="token punctuation">.</span><span class="token function">getObjectByName</span><span class="token punctuation">(</span><span class="token string">'头'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
nameNode<span class="token punctuation">.</span><span class="token function">rotateY</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>可以通过<code>getObjectById</code>方法来获取到对应<strong>ID</strong>的对象:</p> <div class="language-JS line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 遍历查找scene中复合条件的子对象,并返回id对应的对象</span>
<span class="token keyword">const</span> idNode <span class="token operator">=</span> scene<span class="token punctuation">.</span><span class="token function">getObjectById</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>idNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>traverse(callback)</strong></p> <p><strong>traverse</strong>方法可以遍历调用者和调用者的所有后代(<strong>children</strong>)</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code>group<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>isGroup<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span> <span class="token comment">// 是否是Group实例</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>isSprite<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span> <span class="token comment">// 是否是Sprite实例</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>isGeometry<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span> <span class="token comment">// 是否是Geometry实例</span>
    <span class="token comment">// 还有 isScene isMesh isAmbientLight 等等属性</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'Group'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span> <span class="token comment">// 类型属性</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'xxx'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span> <span class="token comment">// nang属性</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="本地坐标系和世界坐标系"><a class="header-anchor" href="#本地坐标系和世界坐标系">#</a> 本地坐标系和世界坐标系</h3> <p>访问模型的位置属性<code>.position</code>获得模型在本地坐标系或者说模型坐标系下的三维坐标,</p> <p>通过模型的<code>.getWorldPosition()</code>方法获得该模型在世界坐标下的三维坐标</p> <p><strong>getWorldPosition</strong> 方法</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 声明一个三维向量用来保存世界坐标</span>
<span class="token keyword">const</span> worldPosition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 执行getWorldPosition方法把模型的世界坐标保存到参数worldPosition中</span>
mesh<span class="token punctuation">.</span><span class="token function">getWorldPosition</span><span class="token punctuation">(</span>worldPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>本地坐标系</strong>:</p> <p>所谓本地坐标系(模型坐标系),就是模型对象<strong>相对于模型的父对象</strong>而言,</p> <p>模型位置属性<code>.position</code>表示的坐标值就是以本地坐标系为参考</p> <p><strong>世界坐标系</strong>:</p> <p>一个模型对象可能有多个父对象节点, 世界坐标系默认就是对整个场景建立的一个坐标系</p> <p>一个模型的世界坐标系的值就是该模型对象<strong>所有父对象以及模型本身</strong><code>.position</code>属性的<strong>累加</strong></p> <p><strong>本地矩阵</strong></p> <p>本地矩阵<code>.materix</code>是以本地坐标系为参考的模型矩阵</p> <p>Threejs 模型的位置属性<code>.position</code> 缩放系数属性<code>.scale</code>和角度属性<code>.rotation</code>记录了模型的所有平移</p> <p>缩放和旋转变换,本地矩阵<code>.materix</code>是以线性代数矩阵的形式表示<code>.position</code>、<code>.scale</code>和<code>.rotation</code></p> <p><strong>世界矩阵</strong></p> <p>世界矩阵<code>.matrixWorld</code>自然就是以是世界坐标系为参照的模型矩阵</p> <p>用矩阵的形式表示模型以及模型父对象的所有旋转缩放平移变换</p> <blockquote><p>更新本地矩阵属性使用<code>.updateMatrix()</code>方法, 更新世界矩阵属性使用<code>.updateMatrixWorld()</code>方法</p></blockquote> <blockquote><p>更多内容可以参考文章<a href="http://www.yanhuangxueyuan.com/doc/Three.js/matrixWorld.html" target="_blank" rel="noopener noreferrer">本地矩阵和世界矩阵<OutboundLink></OutboundLink></a></p></blockquote> <h2 id="材质-material"><a class="header-anchor" href="#材质-material">#</a> 材质（material）</h2> <p>使用白卡纸画画,还是用油纸画画,呈现出来的质感是不同的对不对,这就是<code>材质</code>！</p> <p>下面五个球的颜色都是一样的,而材质从左至右分别是:</p> <ul><li><a href="https://threejs.org/docs/index.html?q=MeshBasicMaterial#api/zh/materials/MeshBasicMaterial" target="_blank" rel="noopener noreferrer">THREE.MeshBasicMaterial<OutboundLink></OutboundLink></a>（基础材质,不受光照影响）</li> <li><a href="https://threejs.org/docs/index.html?q=MeshStandardMaterial#api/zh/materials/MeshStandardMaterial" target="_blank" rel="noopener noreferrer">THREE.MeshStandardMaterial<OutboundLink></OutboundLink></a>（PBR标准材质）</li> <li><a href="https://threejs.org/docs/index.html?q=MeshPhongMaterial#api/zh/materials/MeshPhongMaterial" target="_blank" rel="noopener noreferrer">THREE.MeshPhongMaterial<OutboundLink></OutboundLink></a>（高光材质,适用于陶瓷,烤漆类质感）</li> <li><a href="https://threejs.org/docs/index.html?q=MeshToonMaterial#api/zh/materials/MeshToonMaterial" target="_blank" rel="noopener noreferrer">THREE.MeshToonMaterial<OutboundLink></OutboundLink></a>（卡通材质,俗称三渲二）</li> <li><a href="https://threejs.org/docs/index.html?q=MeshStandardMaterial#api/zh/materials/MeshStandardMaterial" target="_blank" rel="noopener noreferrer">THREE.MeshStandardMaterial<OutboundLink></OutboundLink></a>（PBR标准材质模拟金属反射）</li> <li><strong>THREE.xxxMaterial:</strong> 指的是框架自带的材质</li></ul> <p><img src="/note-sites/assets/img/material.5ea5da43.png" alt=""></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 创建 MeshPhongMaterial 材质颜色为绿色</span>
<span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshPhongMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
    <span class="token comment">// 颜色</span>
    <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0x00ff00</span><span class="token punctuation">,</span>
    <span class="token comment">// 透明度</span>
    <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token comment">// 开启透明度效果</span>
    <span class="token literal-property property">transparent</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// 将几何图形渲染为线框, 默认值为false</span>
    <span class="token literal-property property">wireframe</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// 高光颜色</span>
    <span class="token literal-property property">specular</span><span class="token operator">:</span> <span class="token number">0x4488ee</span><span class="token punctuation">,</span>
    <span class="token comment">// 光照强度系数</span>
    <span class="token literal-property property">shininess</span><span class="token operator">:</span> <span class="token number">12</span>
    <span class="token comment">// 网格模型以线条的模式渲染</span>
    <span class="token literal-property property">wireframe</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 或者实例后重新指定颜色</span>
<span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshPhongMaterial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
material<span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">setHSL</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 红色</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><a href="https://threejs.org/docs/#api/zh/math/Color" target="_blank" rel="noopener noreferrer"><code>THREE.Color</code><OutboundLink></OutboundLink></a> 类型的属性有多种设置方式</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code>material<span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0x00FFFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 同 CSS的 #RRGGBB 风格</span>
material<span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>cssString<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 任何 CSS 颜色字符串, 比如 'purple', '#F32',</span>
                                 <span class="token comment">// 'rgb(255, 127, 64)',</span>
                                 <span class="token comment">// 'hsl(180, 50%, 25%)'</span>
material<span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>someColor<span class="token punctuation">)</span>    <span class="token comment">// 其他一些 THREE.Color</span>
material<span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">setHSL</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> s<span class="token punctuation">,</span> l<span class="token punctuation">)</span>   <span class="token comment">// 其中 h, s, 和 l 从 0 到 1</span>
material<span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">setRGB</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">)</span>   <span class="token comment">// 其中 r, g, 和 b 从 0 到 1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>实例化时同样支持多种颜色设置方案</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> m1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0xFF0000</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// 红色</span>
<span class="token keyword">const</span> m2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 红色</span>
<span class="token keyword">const</span> m3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'#F00'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// 红色</span>
<span class="token keyword">const</span> m4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'rgb(255,0,0)'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 红色</span>
<span class="token keyword">const</span> m5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'hsl(0,100%,50%)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 红色</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>材质常用属性:</p> <ul><li><a href="https://threejs.org/docs/#api/zh/materials/Material#flatShading" target="_blank" rel="noopener noreferrer"><code>flatShading</code><OutboundLink></OutboundLink></a>：对象是否使用平面着色,默认为<code>false</code></li></ul> <p><img src="/note-sites/assets/img/flat.90237856.png" alt="image-20211226172002183"></p> <ul><li><a href="https://threejs.org/docs/#api/zh/materials/Material#side" target="_blank" rel="noopener noreferrer"><code>side</code><OutboundLink></OutboundLink></a>：要显示三角形的哪个面。默认值是 <code>THREE.FrontSide</code>（<a href="https://threejs.org/docs/#api/zh/constants/Materials" target="_blank" rel="noopener noreferrer">材质常量<OutboundLink></OutboundLink></a>）
<ul><li>其他选项有 <code>THREE.BackSide</code> 和 <code>THREE.DoubleSide</code>（正反两面）</li> <li>设置 <code>side</code> 的最常见的原因是用于绘制平面或其他非实体对象,在这些对象中通常会看到三角形的反面</li></ul></li></ul> <p><img src="/note-sites/assets/img/side.1c7d87d5.png" alt="image-20211226171922056"></p> <ul><li><a href="https://threejs.org/docs/?q=material#api/zh/materials/Material.needsUpdate" target="_blank" rel="noopener noreferrer"><code>needsUpdate</code><OutboundLink></OutboundLink></a>: 指定需要重新编译材质
<ul><li>需要改变材质或纹理时, 需要设置<code>material.needsUpdate = true</code>来告诉 three 应用你的材质变化</li> <li>常用的场景:
<ul><li>切换<code>flatShading</code></li> <li>添加或删除纹理</li></ul></li></ul></li> <li><a href="https://threejs.org/docs/#api/zh/materials/Material#fog" target="_blank" rel="noopener noreferrer"><code>fog</code><OutboundLink></OutboundLink></a>: 材质是否受雾的影响。默认为<strong>true</strong></li> <li><a href="https://threejs.org/docs/#api/zh/materials/Material.dispose" target="_blank" rel="noopener noreferrer"><code>dispose()</code><OutboundLink></OutboundLink></a>: 删除材质, 释放相关资源</li></ul> <blockquote><p>更多关于材质介绍, 见 <a href="https://threejs.org/manual/#zh/materials" target="_blank" rel="noopener noreferrer">材质<OutboundLink></OutboundLink></a></p></blockquote> <h2 id="网格-mesh"><a class="header-anchor" href="#网格-mesh">#</a> 网格（Mesh）</h2> <p><a href="https://threejs.org/docs/index.html?q=mesh#api/zh/objects/Mesh" target="_blank" rel="noopener noreferrer"><code>THREE.Mesh()</code><OutboundLink></OutboundLink></a></p> <p>网格对象包含一个<strong>几何体</strong>以及作用在此几何体上的<strong>材质</strong>,</p> <p>可以直接将网格对象放入到我们的场景中,并让它在场景中自由移动</p> <p>用法和常用属性如下:</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 接受 几何体 和 材质</span>
<span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 网格对象旋转</span>
mesh<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.5</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">;</span>

<span class="token comment">// 使用 set 方法设置网格对象的 x y z 矩阵</span>
mesh<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// or</span>
mesh<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
mesh<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
mesh<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">// 设置网格对象的缩放 x y z 矩阵</span>
mesh<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设置网格对象的旋转 x y z</span>
mesh<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设置网格对象的旋转 x y z(在原先的基础上旋转)</span>
mesh<span class="token punctuation">.</span><span class="token function">rotateX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mesh<span class="token punctuation">.</span><span class="token function">rotateY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mesh<span class="token punctuation">.</span><span class="token function">rotateZ</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// x轴平移</span>
mesh<span class="token punctuation">.</span><span class="token function">translateX</span><span class="token punctuation">(</span>distance<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// x轴平移</span>
mesh<span class="token punctuation">.</span><span class="token function">translateY</span><span class="token punctuation">(</span>distance<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// z轴平移</span>
mesh<span class="token punctuation">.</span><span class="token function">translateZ</span><span class="token punctuation">(</span>distance<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//显示网格对象</span>
mesh<span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">//隐藏网格对象</span>
mesh<span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token comment">// 网格对象添加到场景中</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> mesh <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>默认情况下,调用**scene.add()<strong>的时候,物体将会被添加到</strong>(0,0,0)**坐标, 这将使得摄像机和立方体重叠在一起</p> <p>为了防止这种情况的发生,只需要将摄像机稍微向外移动一些即可</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code>mesh<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 或者</span>
mesh<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>点线面模型总结:</p> <p><img src="/note-sites/assets/img/image-20220104222445524.3f4d44b5.png" alt="image-20220104222445524"></p> <h2 id="渲染场景"><a class="header-anchor" href="#渲染场景">#</a> 渲染场景</h2> <p>前面的代码都是在设置样式, 参数, 页面是没有效果的, 因为还没有被真正渲染,</p> <p>可以使用<code>requestAnimationFrame</code>来<strong>循环渲染</strong>,</p> <blockquote><p>不推荐使用<code>setInterval</code>来循环渲染</p></blockquote> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 渲染函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 改变网格角度</span>
    mesh<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>x <span class="token operator">+=</span> <span class="token number">0.01</span><span class="token punctuation">;</span>
    mesh<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>y <span class="token operator">+=</span> <span class="token number">0.01</span><span class="token punctuation">;</span>
    <span class="token comment">// 重新渲染</span>
    renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 使用 requestAnimationFrame 重新调用渲染函数</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 调用渲染函数</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><hr> <h2 id="灯光-light"><a class="header-anchor" href="#灯光-light">#</a> 灯光（Light）</h2> <p><a href="https://threejs.org/docs/index.html#api/zh/lights/Light" target="_blank" rel="noopener noreferrer"><code>THREE.Light()</code><OutboundLink></OutboundLink></a></p> <p>3d引擎在没有手动创建光的情况下会默认有个<code>环境光</code>,不然什么都看不到。</p> <p>常见的灯光有以下几种类型:</p> <ul><li><a href="https://threejs.org/docs/index.html?q=AmbientLight#api/zh/lights/AmbientLight" target="_blank" rel="noopener noreferrer">THREE.AmbientLight<OutboundLink></OutboundLink></a>（环境光,充满所有的几何体表面,不会产生明暗）</li> <li><a href="https://threejs.org/docs/index.html?q=ligh#api/zh/lights/DirectionalLight" target="_blank" rel="noopener noreferrer">THREE.DirectionalLight<OutboundLink></OutboundLink></a>（平行光,参考日光来理解）</li></ul> <p><img src="/note-sites/assets/img/DirectionLight.4cae0237.png" alt="image-20211225102005035"></p> <p>方向光（<a href="https://threejs.org/docs/#api/zh/lights/DirectionalLight" target="_blank" rel="noopener noreferrer"><code>DirectionalLight</code><OutboundLink></OutboundLink></a>）常常用来表现太阳光照的效果</p> <ul><li><a href="https://threejs.org/docs/index.html?q=ligh#api/zh/lights/PointLight" target="_blank" rel="noopener noreferrer">THREE.PointLight<OutboundLink></OutboundLink></a>（点光源,参考灯泡来理解）</li></ul> <p><img src="/note-sites/assets/img/PointLight.b5d5eff6.png" alt="image-20211225102111437"></p> <p>点光源（<a href="https://threejs.org/docs/#api/zh/lights/PointLight" target="_blank" rel="noopener noreferrer"><code>PointLight</code><OutboundLink></OutboundLink></a>）有额外的一个范围（<a href="https://threejs.org/docs/#api/zh/lights/PointLight#distance" target="_blank" rel="noopener noreferrer"><code>distance</code><OutboundLink></OutboundLink></a>）属性。 如果 <code>distance</code> 设为 0,则光线可以照射到无限远处。</p> <p>如果大于 0,则只可以照射到指定的范围,光照强度在这个过程中逐渐衰减,在光源位置时,<code>intensity</code> 是设定的大小,</p> <p>在距离光源 <code>distance</code> 位置的时候,<code>intensity</code> 为 0</p> <ul><li><a href="https://threejs.org/docs/index.html?q=SpotLight#api/zh/lights/SpotLight" target="_blank" rel="noopener noreferrer">THREE.SpotLight<OutboundLink></OutboundLink></a>（聚光灯,参考舞台聚光灯）</li></ul> <p><img src="/note-sites/assets/img/SpotLight.c87f500a.png" alt="image-20211225102252307"></p> <p>聚光灯的圆锥顶部角度大小通过 <a href="https://threejs.org/docs/#api/zh/lights/SpotLight#angle" target="_blank" rel="noopener noreferrer"><code>angle</code><OutboundLink></OutboundLink></a> 属性设置,以弧度作单位。内圆锥是通过设置 <a href="https://threejs.org/docs/#api/zh/lights/SpotLight#penumbra" target="_blank" rel="noopener noreferrer"><code>penumbra</code><OutboundLink></OutboundLink></a> 属性来定义的,</p> <p>属性值代表了内圆锥相对外圆锥大小变化的百分比, 当 <code>penumbra</code> 为 0 时,内圆锥大小与外圆锥大小一致；</p> <p>当 <code>penumbra</code> 为 1 时,内圆锥大小为 0,光照强度从中轴线就开始往外递减；当 <code>penumbra</code> 为 0.5 时,</p> <p>光照强度从外圆锥半径的中点处开始往外递减</p> <ul><li>**THREE.xxxLight: **指的是框架自带的光源构造函数</li></ul> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 创建点光源</span>
<span class="token comment">// 颜色为0xffffff, 光照强度为2</span>
<span class="token keyword">const</span> light <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PointLight</span><span class="token punctuation">(</span><span class="token number">0xffffff</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置光源的位置</span>
light<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置光源的照向位置(SpotLight独有属性)</span>
light<span class="token punctuation">.</span>target <span class="token operator">=</span> plane<span class="token punctuation">;</span>
<span class="token comment">// 添加到场景中</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>light<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>在设置光照时,基本思路是不要设置 <code>distance</code> 来表现光照的衰减,也不要设置 <code>intensity</code></p> <p>而是设置光照的 <a href="https://threejs.org/docs/#api/zh/lights/PointLight#power" target="_blank" rel="noopener noreferrer"><code>power</code><OutboundLink></OutboundLink></a> 属性,以流明为单位,three.js 会进行物理计算,从而表现出接近真实的光照效果</p> <p>在这种情况下 three.js 参与计算的长度单位是米,一个 60瓦 的灯泡大概是 800 流明强度</p> <p>并且光源有一个 <a href="https://threejs.org/docs/#api/zh/lights/PointLight#decay" target="_blank" rel="noopener noreferrer"><code>decay</code><OutboundLink></OutboundLink></a> 属性,为了模拟真实效果,应该被设置为 <code>2</code></p> <blockquote><p>上面的只有平行光, 点光源, 聚光灯可以产生<strong>阴影</strong>而且有的材料是受光源影响, 没有光就是黑的; 而一些材料是不受光影响的</p></blockquote> <p>一个3D世界当然不止一种光构成,所以光是可以叠加的,叠加的结果作用与物体上,</p> <p>而且物体的影子也不是白送的,需要某些支持影子的光加上开发者配置：</p> <p><strong>Threejs 所默认使用<em>阴影图（阴影贴图）</em>,阴影贴图的工作方式就是具有投射阴影的光能对所有能被投射阴影的物体</strong></p> <p><strong>从光源渲染阴影</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 渲染器渲染阴影</span>
renderer<span class="token punctuation">.</span>shadowMap<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">// 光能投射阴影</span>
light<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">// 网格被投射阴影(接受)</span>
mesh<span class="token punctuation">.</span>receiveShadow  <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">// 网格能投射阴影</span>
mesh<span class="token punctuation">.</span>castShadow  <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">// 球体和立方体需要同时设置两种</span>
sphereMesh<span class="token punctuation">.</span>receiveShadow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
sphereMesh<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">// 地面只设置 receiveShadow 即可</span>
planeMesh<span class="token punctuation">.</span>receiveShadow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>镜头光晕</strong></p> <p>镜头光晕使用<a href="https://threejs.org/docs/index.html?q=lens#examples/zh/objects/Lensflare" target="_blank" rel="noopener noreferrer">Lensflare<OutboundLink></OutboundLink></a>类来实现</p> <h2 id="纹理-texture"><a class="header-anchor" href="#纹理-texture">#</a> 纹理（texture）</h2> <p><strong>纹理</strong>又叫<strong>贴图</strong></p> <p><a href="https://threejs.org/docs/index.html?q=texture#api/zh/textures/Texture" target="_blank" rel="noopener noreferrer"><code>THREE.texture()</code><OutboundLink></OutboundLink></a></p> <p>纹理一般是指我们常见的在一些第三方程序中创建的图像, 将其应用到几何表面,或者作为反射/折射贴图</p> <p><img src="/note-sites/assets/img/image-20220109155951493.3006c9ef.png" alt="image-20220109155951493"></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 创建正方体</span>
<span class="token keyword">const</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 需要 TextureLoader 类的 load方法 来加载纹理</span>
<span class="token keyword">const</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>TextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建 MeshBasicMaterial 纹理</span>
<span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// map 指定纹理</span>
    <span class="token literal-property property">map</span><span class="token operator">:</span> loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./wall.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 高光亮度</span>
    <span class="token literal-property property">shininess</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token comment">// 如果不透明度低于此值, 则不会渲染材质</span>
    <span class="token literal-property property">alphaTest</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
    <span class="token comment">// 材质允许透明</span>
    <span class="token literal-property property">transparent</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// 材质透明度</span>
    <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token comment">// 是否在渲染此材质时启用深度测试</span>
    <span class="token literal-property property">depthTest</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cube <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>cube<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><blockquote><p>材质的颜色贴图属性<code>.map</code>设置后,模型会从纹理贴图上采集像素值,这时候就不需要再设置材质颜</p> <p>色<code>.color</code>, <code>.map</code>贴图之所以称之为颜色贴图就是因为网格模型会获得颜色贴图的颜色值RGB</p></blockquote> <p>如果更改了图像,画布,视频和数据纹理,则需要设置以下标志</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code>texture<span class="token punctuation">.</span>needsUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>删除材质</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code>Texture<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>有一些类型的贴图会和光照发生反应</p> <h3 id="纹理对象-texture"><a class="header-anchor" href="#纹理对象-texture">#</a> 纹理对象 <strong>Texture</strong></h3> <p>通过图片加载器 <a href="https://threejs.org/docs/index.html#api/zh/loaders/ImageLoader" target="_blank" rel="noopener noreferrer">ImageLoader<OutboundLink></OutboundLink></a> 可以加载一张图片, 所谓纹理对象Texture简单地说就是,纹理对象Texture的<code>.image</code>属性值是一张图片</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 正方形</span>
<span class="token keyword">const</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//立方体</span>
<span class="token comment">// 图片加载器</span>
<span class="token keyword">const</span> ImageLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>ImageLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// load方法回调函数,按照路径加载图片,返回一个html的元素img对象</span>
ImageLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'../day2/wall.jpg'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">img</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// image对象作为参数,创建一个纹理对象Texture</span>
    <span class="token keyword">const</span> texture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Texture</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 下次使用纹理时触发更新</span>
    texture<span class="token punctuation">.</span>needsUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshLambertMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">map</span><span class="token operator">:</span> texture<span class="token punctuation">,</span> <span class="token comment">//设置纹理贴图</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//网格模型对象Mesh</span>
    scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//网格模型添加到场景中</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><img src="/note-sites/assets/img/image-20220109102453777.c160365a.png" alt="image-20220109102453777"></p> <blockquote><p>详细介绍见, 官方<a href="https://threejs.org/manual/#zh/textures" target="_blank" rel="noopener noreferrer">纹理<OutboundLink></OutboundLink></a>,</p></blockquote> <h3 id="数组材质、材质索引"><a class="header-anchor" href="#数组材质、材质索引">#</a> 数组材质、材质索引</h3> <p><strong>数组材质</strong></p> <p>可以把数组材质作为几何体的纹理贴图,所谓数组材质就是多个材质对象构成一个数组作为模型对象的材质</p> <p>以正方形为例</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 设置材质数组</span>
<span class="token keyword">const</span> materialArr <span class="token operator">=</span> <span class="token punctuation">[</span>material_2<span class="token punctuation">,</span> material_1<span class="token punctuation">,</span> material_2<span class="token punctuation">,</span> material_1<span class="token punctuation">,</span> material_2<span class="token punctuation">,</span> material_1<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 设置数组材质对象作为网格模型材质参数, 这样材质数组里的每一项对应正方体的一个面</span>
<span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> materialArr<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>材质索引</strong></p> <p><a href="https://www.mrguo.link/article?id=41" target="_blank" rel="noopener noreferrer">uv映射<OutboundLink></OutboundLink></a></p> <h3 id="纹理对象texture阵列、偏移、旋转"><a class="header-anchor" href="#纹理对象texture阵列、偏移、旋转">#</a> 纹理对象<strong>Texture</strong>阵列、偏移、旋转</h3> <p><strong>阵列</strong></p> <p>纹理贴图阵列映射</p> <p>默认情况下, 纹理是不重复的, 要设置纹理是否重复, 有2个属性,<a href="https://threejs.org/docs/#api/zh/textures/Texture#wrapS" target="_blank" rel="noopener noreferrer"><code>wrapS</code><OutboundLink></OutboundLink></a> 用于水平包裹,<a href="https://threejs.org/docs/#api/zh/textures/Texture#wrapT" target="_blank" rel="noopener noreferrer"><code>wrapT</code><OutboundLink></OutboundLink></a> 用于垂直包裹</p> <p>重复是用<code>repeat</code>重复属性设置的</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> texture <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'太阳能板.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置阵列模式, 默认ClampToEdgeWrapping  </span>
texture<span class="token punctuation">.</span>wrapS <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping<span class="token punctuation">;</span>
texture<span class="token punctuation">.</span>wrapT <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping<span class="token punctuation">;</span>
<span class="token comment">// uv两个方向纹理重复数量</span>
texture<span class="token punctuation">.</span>repeat<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>阵列模式:</p> <ul><li><p><code>THREE.ClampToEdgeWrapping</code></p> <p>每条边上的最后一个像素无限重复。</p></li> <li><p><code>THREE.RepeatWrapping</code></p> <p>纹理重复</p></li> <li><p><code>THREE.MirroredRepeatWrapping</code></p> <p>在每次重复时将进行镜像</p></li></ul> <p><strong>偏移</strong></p> <p>不设置阵列纹理贴图,只设置偏移</p> <p>纹理的偏移是以单位为单位的, 0 = 没有偏移,1 = 偏移一个完整的纹理数量</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 不设置重复  偏移范围 -1 ~ 1</span>
texture<span class="token punctuation">.</span>offset <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector2</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>纹理旋转</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 设置纹理旋转角度texture.rotation = Math.PI/4;// 设置纹理的旋转中心,默认(0,0)texture.center.set(0.5,0.5);</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>纹理动画</strong></p> <p>纹理动画比较简单,在渲染函数中一直修改<code>texture.offset</code>属性动态改变纹理对象的偏移属性就可以</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 渲染函数</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 使用加减法可以设置不同的运动方向</span>
  <span class="token comment">// 设置纹理偏移</span>
  texture<span class="token punctuation">.</span>offset<span class="token punctuation">.</span>x <span class="token operator">-=</span> <span class="token number">0.06</span>
<span class="token punctuation">}</span>
<span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>总结:</strong></p> <p><img src="/note-sites/assets/img/image-20220109133725059.1216ab24.png" alt="image-20220109133725059"></p> <h3 id="canvas画布、视频作为纹理贴图"><a class="header-anchor" href="#canvas画布、视频作为纹理贴图">#</a> canvas画布、视频作为纹理贴图</h3> <p>通过<a href="https://threejs.org/docs/?q=texture#api/zh/textures/CanvasTexture" target="_blank" rel="noopener noreferrer"><code>CanvasTexture</code><OutboundLink></OutboundLink></a>和<a href="https://threejs.org/docs/?q=texture#api/zh/textures/VideoTexture" target="_blank" rel="noopener noreferrer"><code>VideoTexture</code><OutboundLink></OutboundLink></a>两个类可以分别实现把Canvas画布、视频作为纹理贴图使用</p> <p>Canvas画布可以通过2D API绘制各种各样的几何形状, 通过Canvas绘制一个轮廓后然后作为网格模型、精灵模型</p> <p>等模型对象的纹理贴图</p> <p><strong>CanvasTexture基本使用</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// canvas绘制渐变</span>
<span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> winW <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
<span class="token keyword">const</span> winH <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight
<span class="token comment">// 画布宽高</span>
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> winW<span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> winH<span class="token punctuation">;</span>
<span class="token comment">// 上下文</span>
<span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置渐变相关属性</span>
<span class="token keyword">const</span> gradient <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">createLinearGradient</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> winW<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'#4e22b7'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'#3292ff'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置样式</span>
ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> gradient<span class="token punctuation">;</span>
<span class="token comment">// 绘制矩形</span>
ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> winW<span class="token punctuation">,</span> winH<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// canvas画布对象作为CanvasTexture的参数重建一个纹理对象, 可以理解为一张图片</span>
<span class="token keyword">const</span> canvasTexture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>CanvasTexture</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Canvas画布作为场景背景使用</span>
scene<span class="token punctuation">.</span>background <span class="token operator">=</span> canvasTexture<span class="token punctuation">;</span>

<span class="token comment">// Canvas画布作为矩形网格模型的纹理贴图使用</span>
<span class="token keyword">const</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PlaneGeometry</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshPhongMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">map</span><span class="token operator">:</span> texture<span class="token punctuation">,</span> <span class="token comment">// 设置纹理贴图</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建一个矩形平面网模型,Canvas画布作为矩形网格模型的纹理贴图</span>
<span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p><strong>Canvas画布加载图片</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./贴图.jpg&quot;</span><span class="token punctuation">;</span>
Image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> bg <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">createPattern</span><span class="token punctuation">(</span>Image<span class="token punctuation">,</span> <span class="token string">&quot;no-repeat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 注意图片加载完成执行canvas相关方法后,必须要更新一下纹理  </span>
    texture<span class="token punctuation">.</span>needsUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>VideoTexture基本使用</strong></p> <p>视频本质上就是一帧帧图片流构成,把视频作为模型的纹理贴图使用,就是从视频中提取一帧一帧的图片作为模型</p> <p>的纹理贴图,然后不停的更新的纹理贴图就可以产生视频播放的效果</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 创建video对象</span>
<span class="token keyword">const</span> video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
video<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;xxx.mp4&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 设置视频地址</span>
video<span class="token punctuation">.</span>autoplay <span class="token operator">=</span> <span class="token string">&quot;autoplay&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 自动播放</span>
<span class="token comment">// video对象作为VideoTexture参数创建纹理对象</span>
<span class="token keyword">const</span> texture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>VideoTexture</span><span class="token punctuation">(</span>video<span class="token punctuation">)</span>
<span class="token comment">// 矩形平面</span>
<span class="token keyword">const</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PlaneGeometry</span><span class="token punctuation">(</span><span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 材质对象Material</span>
<span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshPhongMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">map</span><span class="token operator">:</span> texture<span class="token punctuation">,</span> <span class="token comment">// 设置纹理贴图</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 网格模型对象Mesh</span>
<span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span> 
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 网格模型添加到场景中</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>VideoTexture.js</strong>封装了一个<code>update</code>函数,three每次执行渲染方法进行渲染场景中的时候,都会执行</p> <p><strong>VideoTexture</strong>封装的<code>update</code>函数,执行update函数中代码<code>this.needsUpdate = true;</code>读取视频流最</p> <p>新一帧图片来更新Threejs模型纹理贴图</p> <h3 id="凹凸贴图和法线贴图"><a class="header-anchor" href="#凹凸贴图和法线贴图">#</a> 凹凸贴图和法线贴图</h3> <p>复杂的曲面模型顶点数量是非常多的,模型文件比较大,为了降低模型文件大小,法线贴图<code>.normalMap</code>算法就</p> <p>产生了,复杂的三维模型3D美术可以通过减面操作把精模简化为简模,然后把精模表面的复杂几何信息映射到法</p> <p>线贴图<code>.normalMap</code>上</p> <p><strong>法线贴图</strong></p> <p><img src="/note-sites/assets/img/image-20220109161134797.82686508.png" alt="image-20220109161134797"></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 纹理加载器</span>
<span class="token keyword">const</span> textreLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>TextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 材质对象Material</span>
<span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshPhongMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 加载纹理贴图</span>
    <span class="token literal-property property">map</span><span class="token operator">:</span> textreLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./assets/earth.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 加载法线贴图</span>
    <span class="token literal-property property">normalMap</span><span class="token operator">:</span> textreLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./assets/normal.png'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token comment">// 设置深浅程度,默认值(1,1)。</span>
    <span class="token literal-property property">normalScale</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector2</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 网格模型对象Mesh</span>
<span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设置深浅程度</span>
<span class="token comment">// mesh.material.normalScale.set(1.5, 1.5);</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>凹凸贴图</strong></p> <p>凹凸贴图和法线贴图功能相似,只是没有法线贴图丰富的表面信息, 凹凸贴图是用图片像素的灰度值</p> <p>表示几何表面的高低深度,如果模型定义了法线贴图,就没有必要再使用凹凸贴图了</p> <p><img src="/note-sites/assets/img/image-20220109161339427.add48e37.png" alt="image-20220109161339427"></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> textureLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>TextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 加载颜色纹理贴图</span>
<span class="token keyword">const</span> texture <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./凹凸贴图/diffuse.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 加载凹凸贴图</span>
<span class="token keyword">const</span> textureBump <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./凹凸贴图/bump.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshPhongMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">map</span><span class="token operator">:</span> texture<span class="token punctuation">,</span><span class="token comment">// 普通纹理贴图</span>
  <span class="token literal-property property">bumpMap</span><span class="token operator">:</span>textureBump<span class="token punctuation">,</span><span class="token comment">//凹凸贴图</span>
  <span class="token literal-property property">bumpScale</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token comment">//设置凹凸高度,默认值1。</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//材质对象Material</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>总结</strong></p> <p><img src="/note-sites/assets/img/image-20220109140640276.330b323f.png" alt="image-20220109140640276"></p> <h3 id="光照贴图添加阴影"><a class="header-anchor" href="#光照贴图添加阴影">#</a> 光照贴图添加阴影</h3> <p>在三维场景中有时候需要设置模型的阴影,也就是阴影贴图或者说光照贴图<code>·lightMap</code>,一般 Threejs 加载外部</p> <p>模型的光照贴图<code>·lightMap</code>,三维模型加载器可以自动设置,不需要程序员通过代码去设置</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">//创建一个平面几何体作为投影面</span>
<span class="token keyword">const</span> planeGeometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PlaneGeometry</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> textureLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>TextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 加载光照贴图</span>
<span class="token keyword">const</span> textureLight <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'shadow.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> planeMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshLambertMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0x999999</span><span class="token punctuation">,</span>
  <span class="token literal-property property">lightMap</span><span class="token operator">:</span>textureLight<span class="token punctuation">,</span> <span class="token comment">// 设置光照贴图</span>
  <span class="token comment">// lightMapIntensity:0.5, // 烘培光照的强度. 默认1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> planeMesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>planeGeometry<span class="token punctuation">,</span> planeMaterial<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//网格模型对象Mesh</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>可以通过设置模型, 光照的阴影设置实时计算阴影,而光照贴图<code>·lightMap</code>是3D美术渲染好提供给程序员</p> <p>这两种方式相比较通过贴图的方式更为节约资源,提高渲染性功能</p> <h3 id="高光贴图"><a class="header-anchor" href="#高光贴图">#</a> 高光贴图</h3> <p>高光网格材质<a href="https://threejs.org/docs/index.html?q=MeshPhongMaterial#api/zh/materials/MeshPhongMaterial" target="_blank" rel="noopener noreferrer">MeshPhongMaterial<OutboundLink></OutboundLink></a>具有高光属性<code>.specular</code>,如果一个网格模型<code>Mesh</code>都是相同的材质并且表面粗糙度相同,或者说网格</p> <p>模型外表面所有不同区域的镜面反射能力相同,可以直接设置材质的高光属性<code>.specular</code>, 如果一个网格模型表示一个人, 人的不同部位高</p> <p>光程度是不同的, 不可能直接通过<code>.specular</code>属性来描述, 在这种情况通过高光贴图<code>.specularMap</code>的RGB值来描述不同区域镜面反射</p> <p>的能力,<code>.specularMap</code>和颜色贴图<code>.Map</code>一样和通过UV坐标映射到模型表面高光贴图<code>.specularMap</code>不同区域像素值不同,表示网格</p> <p>模型不同区域的高光值不同</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 加载纹理贴图</span>
<span class="token keyword">const</span> texture <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'earth_diffuse.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 加载高光贴图</span>
<span class="token keyword">const</span> textureSpecular <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'earth_specular.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshPhongMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// specular: 0xff0000, // 高光部分的颜色</span>
  <span class="token literal-property property">shininess</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token comment">// 高光部分的亮度,默认30</span>
  <span class="token literal-property property">map</span><span class="token operator">:</span> texture<span class="token punctuation">,</span> <span class="token comment">// 普通纹理贴图</span>
  <span class="token literal-property property">specularMap</span><span class="token operator">:</span> textureSpecular<span class="token punctuation">,</span> <span class="token comment">// 高光贴图</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 材质对象Material</span>

<span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// mesh.material.specular.set(0xffffff);// 高光反射颜色</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><blockquote><p><code>.specularMap</code>和<code>.specular</code>是对应的, 只有高光网格材质对象<code>MeshPhongMaterial</code>才具备高光贴图属性</p></blockquote> <h3 id="环境贴图"><a class="header-anchor" href="#环境贴图">#</a> 环境贴图</h3> <p>Threejs 环境贴图<code>.envMap</code>字面意思就是三维模型周边环境</p> <p>创建一个立方体盒子作为天空盒使用，然后把一个环境中上下左右前后六张视图图片作为立方体盒子的纹理贴图使用</p> <p>加载环境贴图的6张纹理贴图，可以通过<a href="https://threejs.org/docs/index.html?q=CubeTextureLoader#api/zh/loaders/CubeTextureLoader" target="_blank" rel="noopener noreferrer">CubeTextureLoader<OutboundLink></OutboundLink></a>类去实现</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//立方体</span>
<span class="token keyword">const</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>CubeTextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 所有贴图在同一目录下，可以使用该方法设置共用路径</span>
loader<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">'环境贴图/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 立方体纹理加载器返回立方体纹理对象CubeTexture</span>
<span class="token keyword">const</span> CubeTexture <span class="token operator">=</span> loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'px.jpg'</span><span class="token punctuation">,</span> <span class="token string">'nx.jpg'</span><span class="token punctuation">,</span> <span class="token string">'py.jpg'</span><span class="token punctuation">,</span> <span class="token string">'ny.jpg'</span><span class="token punctuation">,</span> <span class="token string">'pz.jpg'</span><span class="token punctuation">,</span> <span class="token string">'nz.jpg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//材质对象Material</span>
<span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshPhongMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">//网格模型设置颜色，网格模型颜色和环境贴图会进行融合计算</span>
  <span class="token comment">// color:0xff0000,</span>
  <span class="token literal-property property">envMap</span><span class="token operator">:</span> CubeTexture<span class="token punctuation">,</span> <span class="token comment">//设置环境贴图</span>
  <span class="token comment">// 环境贴图反射率   控制环境贴图对被渲染三维模型影响程度</span>
  <span class="token comment">// reflectivity: 0.1,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// console.log(CubeTexture.image);</span>
<span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 网格模型对象Mesh</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 网格模型添加到场景中</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>高光网格材质<a href="https://threejs.org/docs/index.html?q=MeshPhongMaterial#api/zh/materials/MeshPhongMaterial" target="_blank" rel="noopener noreferrer">MeshPhongMaterial<OutboundLink></OutboundLink></a>和物理PBR材质<a href="https://threejs.org/docs/index.html?q=MeshStandardMaterial#api/zh/materials/MeshStandardMaterial" target="_blank" rel="noopener noreferrer">MeshStandardMaterial<OutboundLink></OutboundLink></a>通常会使用环境贴图<code>.envMap</code>来实现更好的渲染效果。一个</p> <p>材质对应的是普通次时代模型，一个材质对应的是PBR模型</p> <h3 id="数据纹理对象"><a class="header-anchor" href="#数据纹理对象">#</a> 数据纹理对象</h3> <p>Threejs 数据纹理对象<a href="https://threejs.org/docs/index.html?q=DataTexture#api/zh/textures/DataTexture" target="_blank" rel="noopener noreferrer">DataTexture<OutboundLink></OutboundLink></a>简单地说就是通过程序创建纹理贴图的每一个像素值</p> <p><strong>生成一张图片的RGB值</strong></p> <p><img src="/note-sites/assets/img/image-20220109172613515.4457e7b3.png" alt="image-20220109172613515"></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PlaneGeometry</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//矩形平面</span>
<span class="token comment">/**
 * 创建纹理对象的像素数据
 */</span>
<span class="token keyword">const</span> width <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">;</span> <span class="token comment">//纹理宽度</span>
<span class="token keyword">const</span> height <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">;</span> <span class="token comment">//纹理高度</span>
<span class="token keyword">const</span> size <span class="token operator">=</span> width <span class="token operator">*</span> height<span class="token punctuation">;</span> <span class="token comment">//像素大小</span>
<span class="token keyword">const</span> len <span class="token operator">=</span> size <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 乘3对应 RGB 三个值	</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 像素在缓冲区占用空间</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 每次递增3, 对应 RGB 三个值</span>
    <span class="token comment">// 随机设置RGB分量的值</span>
    data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 对应 R</span>
    data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 对应 G</span>
    data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 对应 B</span>
<span class="token punctuation">}</span>
<span class="token comment">// 创建数据纹理对象</span>
<span class="token keyword">const</span> texture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>DataTexture</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RGBFormat<span class="token punctuation">)</span><span class="token punctuation">;</span>
texture<span class="token punctuation">.</span>needsUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">//纹理更新</span>
<span class="token comment">// 可以查看纹理对象的image属性</span>
<span class="token comment">// console.log(texture.image);</span>

<span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshPhongMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">map</span><span class="token operator">:</span> texture<span class="token punctuation">,</span> <span class="token comment">// 设置纹理贴图</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//材质对象Material</span>
<span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p><strong>带透明度的RGB图片</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PlaneGeometry</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//矩形平面</span>
<span class="token comment">/**
 * 创建纹理对象的像素数据
 */</span>
<span class="token keyword">const</span> width <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">;</span> <span class="token comment">//纹理宽度</span>
<span class="token keyword">const</span> height <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">;</span> <span class="token comment">//纹理高度</span>
<span class="token keyword">const</span> size <span class="token operator">=</span> width <span class="token operator">*</span> height<span class="token punctuation">;</span> <span class="token comment">//像素大小</span>
<span class="token keyword">const</span> len <span class="token operator">=</span> size <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// 乘4对应 RGBA 四个值	</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 像素在缓冲区占用空间</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 递增4, 对应RGBA</span>
    <span class="token comment">// 随机设置RGB分量的值</span>
    data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 对应 R</span>
    data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 对应 G</span>
    data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 对应 B</span>
    <span class="token comment">// 设置透明度分量A</span>
    data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span> <span class="token comment">// 对应 A</span>
<span class="token punctuation">}</span>
<span class="token comment">// 创建数据文理对象   RGBA格式：THREE.RGBAFormat</span>
<span class="token keyword">const</span> texture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>DataTexture</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RGBAFormat<span class="token punctuation">)</span><span class="token punctuation">;</span>
texture<span class="token punctuation">.</span>needsUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">//纹理更新</span>
<span class="token comment">//打印纹理对象的image属性</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>texture<span class="token punctuation">.</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshPhongMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">map</span><span class="token operator">:</span> texture<span class="token punctuation">,</span> <span class="token comment">// 设置纹理贴图</span>
    <span class="token literal-property property">transparent</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//允许透明设置</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p><strong>图片格式</strong></p> <p>像素值包含RGBA四个分量的图片格式有<code>.PNG</code>等格式，通过WebGL原生API加载解析这些类型格式的图片需要设置<code>gl.RGBA</code>，对于</p> <p>Threejs而言对WebGL进行封装了，<code>gl.RGBA</code>对应的设置是<a href="http://localhost:8888/three.js-dev/docs/index.html?q=Texture#api/zh/constants/Textures" target="_blank" rel="noopener noreferrer"><code>THREE.RGBAFormat</code><OutboundLink></OutboundLink></a></p> <h2 id="雾"><a class="header-anchor" href="#雾">#</a> 雾</h2> <p>在3D引擎里,雾通常是基于离摄像机的距离褪色至某种特定颜色的方式。在 Threejs 中添加雾是通过创建 <a href="https://threejs.org/docs/#api/zh/scenes/Fog" target="_blank" rel="noopener noreferrer"><code>Fog</code><OutboundLink></OutboundLink></a> 或者 <a href="https://threejs.org/docs/#api/zh/scenes/FogExp2" target="_blank" rel="noopener noreferrer"><code>FogExp2</code><OutboundLink></OutboundLink></a> 实例并设定scene的<a href="https://threejs.org/docs/#api/zh/scenes/Scene#fog" target="_blank" rel="noopener noreferrer"><code>fog</code><OutboundLink></OutboundLink></a> 属性</p> <p><a href="https://threejs.org/docs/#api/zh/scenes/Fog" target="_blank" rel="noopener noreferrer"><code>Fog</code><OutboundLink></OutboundLink></a> 让你设定 <code>near</code> 和 <code>far</code> 属性,代表距离摄像机的距离。任何物体比 <code>near</code> 近不会受到影响,任何物体比 <code>far</code> 远则完全是雾的</p> <p>颜色。在 <code>near</code> 和 <code>far</code> 中间的物体,会从它们自身材料的颜色褪色到雾的颜色。</p> <p><a href="https://threejs.org/docs/#api/zh/scenes/FogExp2" target="_blank" rel="noopener noreferrer"><code>FogExp2</code><OutboundLink></OutboundLink></a> 会根据离摄像机的距离呈指数增长</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Fog</span>
<span class="token punctuation">{</span>
  <span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token number">0xFFFFFF</span><span class="token punctuation">;</span>  <span class="token comment">// white</span>
  <span class="token keyword">const</span> near <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> far <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
  scene<span class="token punctuation">.</span>fog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Fog</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// FogExp2</span>
<span class="token punctuation">{</span>
  <span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token number">0xFFFFFF</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> density <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>
  scene<span class="token punctuation">.</span>fog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>FogExp2</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span> density<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><blockquote><p>注意: 一般<strong>雾</strong>和<strong>场景的背景颜色</strong>都为同一种颜色</p></blockquote> <h2 id="加载器"><a class="header-anchor" href="#加载器">#</a> 加载器</h2> <p>Threejs 里使用指定类型的<a href="https://threejs.org/docs/index.html?q=loader#examples/zh/loaders/GLTFLoader" target="_blank" rel="noopener noreferrer">加载器类<OutboundLink></OutboundLink></a>来加载指定类型的模型文件, 最常见的模型文件格式有:<code>.obj</code> <code>.gltf</code> 等</p> <p>以<a href="https://threejs.org/docs/index.html?q=load#examples/zh/loaders/GLTFLoader.load" target="_blank" rel="noopener noreferrer"><code>GLTFLoader</code><OutboundLink></OutboundLink></a>为例, 可以在其他网站上下载3D模型, 然后使用3D软件或<a href="https://threejs.org/editor/" target="_blank" rel="noopener noreferrer">three编辑器<OutboundLink></OutboundLink></a>导出转换指定的格式</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 引入加载器类</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> GLTFLoader <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../libs/jsm/GLTFLoader.js'</span><span class="token punctuation">;</span>
<span class="token comment">// 加载类</span>
<span class="token keyword">const</span> gltfLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GLTFLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 加载单个模型(异步)</span>
<span class="token comment">// .load (url,onLoad,onProgress,onError)</span>
<span class="token comment">// onLoad事件, 模型加载完成</span>
<span class="token comment">// onProgress事件, 模型加载中</span>
<span class="token comment">// onError事件, 模型加载失败</span>
gltfLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'.url'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">gltf</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>gltf<span class="token punctuation">.</span>scene<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 模型加载到场景中</span>
    <span class="token comment">// traverse 会自动遍历 children 数组 =&gt; gltf.scene.children.forEach  </span>
    gltf<span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// isMesh 属性表示是不是 mesh 对象</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>isMesh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 点数据</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span> array <span class="token punctuation">}</span> <span class="token operator">=</span> child<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>position<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h4 id="加载管理器"><a class="header-anchor" href="#加载管理器">#</a> 加载管理器</h4> <p><a href="https://threejs.org/docs/index.html?q=load#api/zh/loaders/managers/LoadingManager" target="_blank" rel="noopener noreferrer"><code>LoadingManager</code><OutboundLink></OutboundLink></a></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 实例化加载管理器类</span>
<span class="token keyword">const</span> manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>LoadingManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 可以将加载器类传递给加载类</span>
<span class="token keyword">const</span> gltfLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GLTFLoader</span><span class="token punctuation">(</span>manager<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 可以直接给加载管理器添加对应的事件</span>
<span class="token comment">// onLoad事件, 模型加载完成</span>
manager<span class="token punctuation">.</span><span class="token function-variable function">onLoad</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// onProgress事件, 模型加载中</span>
manager<span class="token punctuation">.</span><span class="token function-variable function">onProgress</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> itemsLoaded<span class="token punctuation">,</span> itemsTotal</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// onError事件, 模型加载失败</span>
manager<span class="token punctuation">.</span><span class="token function-variable function">onError</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="fileloader"><a class="header-anchor" href="#fileloader">#</a> FileLoader</h3> <p>使用XMLHttpRequest来加载资源的低级类，并由大多数加载器内部使用, <a href="https://threejs.org/docs/index.html?q=loader#api/zh/loaders/FileLoader" target="_blank" rel="noopener noreferrer">FileLoader<OutboundLink></OutboundLink></a>也可以直接用于加载任何没有对应加载器的文件类型, 基类是<a href="http://localhost:8888/three.js-dev/docs/index.html?q=FileLoader#api/zh/loaders/Loader" target="_blank" rel="noopener noreferrer">Loader<OutboundLink></OutboundLink></a>, 同样具有<code>onLoad</code> <code>onProgress</code> <code>onError</code>事件回调</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 文件加载对象</span>
<span class="token keyword">const</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>FileLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 指定为JSON类型, 不指定类型的话three会自动根据文件类型来判断</span>
loader<span class="token punctuation">.</span><span class="token function">setResponseType</span><span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><em>注意:</em> 必须启用缓存</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token constant">THREE</span><span class="token punctuation">.</span>Cache<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这是一个全局属性，只需要设置一次，供内部使用FileLoader的所有加载器使用,  <a href="http://localhost:8888/three.js-dev/docs/index.html?q=FileLoader#api/zh/loaders/Cache" target="_blank" rel="noopener noreferrer">Cache<OutboundLink></OutboundLink></a> 是一个缓存模块，用于保存通过此加载器发出的每个请求的响应，因此每个文件都会被请求一次</p> <h2 id="精灵模型和粒子系统"><a class="header-anchor" href="#精灵模型和粒子系统">#</a> 精灵模型和粒子系统</h2> <h3 id="精灵模型sprite"><a class="header-anchor" href="#精灵模型sprite">#</a> 精灵模型<strong>Sprite</strong></h3> <p>Threejs 的精灵模型对象<a href="https://threejs.org/docs/index.html?q=Sprite#api/zh/objects/Sprite" target="_blank" rel="noopener noreferrer">Sprite<OutboundLink></OutboundLink></a>和Threejs的网格模型<a href="https://threejs.org/docs/index.html?q=mesh#api/zh/objects/Mesh" target="_blank" rel="noopener noreferrer">Mesh<OutboundLink></OutboundLink></a>一样都是模型对象，基类都是<a href="https://threejs.org/docs/index.html?q=object3d#api/zh/core/Object3D" target="_blank" rel="noopener noreferrer">Object3D<OutboundLink></OutboundLink></a>,关于精灵模型对</p> <p>象的方法和属性除了可以查看文档<a href="https://threejs.org/docs/index.html?q=sprite#api/zh/objects/Sprite" target="_blank" rel="noopener noreferrer">Sprite<OutboundLink></OutboundLink></a>，也可以查看基类<a href="https://threejs.org/docs/index.html?q=object3d#api/zh/core/Object3D" target="_blank" rel="noopener noreferrer">Object3D<OutboundLink></OutboundLink></a></p> <p>精灵不会投射任何阴影，即使设置了<code>castShadow</code>也不会有效果</p> <p>创建精灵模型对象<code>Sprite</code>和创建网格模型对象一样需要创建一个材质对象，不同的地方在于创建精灵模型对象</p> <p>不需要创建几何体对象<code>Geometry</code>，精灵模型对象本质上你可以理解为已经内部封装了一个平面矩形几何体</p> <p><code>PlaneGeometry</code>，矩形精灵模型与矩形网格模型的区别在于精灵模型的矩形平面会<strong>始终平行于Canvas画布</strong></p> <h4 id="spritematerial"><a class="header-anchor" href="#spritematerial">#</a> SpriteMaterial</h4> <p>通过<code>Sprite</code>创建精灵模型不需要几何体，只需要给构造函数<code>Sprite</code>参数设置为一个精灵材质<a href="https://threejs.org/docs/index.html?q=spritematerial#api/zh/materials/SpriteMaterial" target="_blank" rel="noopener noreferrer">SpriteMaterial<OutboundLink></OutboundLink></a>即可.</p> <p>精灵材质对象<code>SpriteMaterial</code>和普通的网格材质一样可以设置颜色<code>.color</code>、颜色贴图<code>.map</code>、开启透明<code>.transparent</code>、透明度<code>.opacity</code>等属性，精灵材质对象<code>SpriteMaterial</code>的基类是材质<a href="https://threejs.org/docs/index.html?q=material#api/zh/materials/Material" target="_blank" rel="noopener noreferrer">Material<OutboundLink></OutboundLink></a></p> <p>精灵材质<a href="https://threejs.org/docs/index.html?q=material#api/zh/materials/SpriteMaterial" target="_blank" rel="noopener noreferrer">SpriteMaterial<OutboundLink></OutboundLink></a>的属性除了和网格材质类似的属性和方法外，还有一些自己独特的方法和属性，比如<code>.rotation</code>旋转精灵模型</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> texture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>TextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;sprite.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建精灵材质对象SpriteMaterial</span>
<span class="token keyword">const</span> spriteMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>SpriteMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0xff00ff</span><span class="token punctuation">,</span> <span class="token comment">// 设置精灵矩形区域颜色</span>
  <span class="token literal-property property">rotation</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token operator">/</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">// 旋转精灵对象45度，弧度值</span>
  <span class="token literal-property property">map</span><span class="token operator">:</span> texture<span class="token punctuation">,</span> <span class="token comment">// 设置精灵纹理贴图</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建精灵模型对象，不需要几何体geometry参数</span>
<span class="token keyword">const</span> sprite <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Sprite</span><span class="token punctuation">(</span>spriteMaterial<span class="token punctuation">)</span><span class="token punctuation">;</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sprite<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 控制精灵大小，比如可视化中精灵大小表征数据大小</span>
sprite<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 只需要设置x、y两个分量就可以</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>.scale</strong>和**.position**</p> <p>精灵模型对象和网格模型<code>Mesh</code>对一样基类都是<code>Object3D</code>，自然精灵模型也有缩放属性<code>.scale</code>和位置属性<code>.position</code>，一般设置精灵模型的大小是通过<code>.scale</code>属性实现，而精灵模型的位置通过属性<code>.position</code>实现，精灵模型和普通模型一样，可以改变它在三维场景中的位置，区别在于精灵模型的正面一直平行于canvas画布</p> <p>在使用透视投影相机对象的时候，精灵模型对象显示的大小和网格模型一样受距离相机的距离影响，也就是距离越远，显示效果越小</p> <h4 id="sprite用途"><a class="header-anchor" href="#sprite用途">#</a> <strong>Sprite</strong>用途</h4> <p>可以在三维场景中把精灵模型作为一个模型的标签，标签上可以显示一个关于模型的信息, 可以通过足够多的精灵模型对象，构建一个粒子系统，来模拟一个下雨、森林、或下雪的场景效果</p> <p><strong>精灵模型创建树林效果</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 加载树的图片</span>
<span class="token keyword">const</span> textureTree <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>TextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;./tree.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 批量创建表示一个树的精灵模型</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> spriteMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>SpriteMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">map</span><span class="token operator">:</span> textureTree<span class="token punctuation">,</span><span class="token comment">//设置精灵纹理贴图</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建精灵模型对象</span>
    <span class="token keyword">const</span> sprite <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Sprite</span><span class="token punctuation">(</span>spriteMaterial<span class="token punctuation">)</span><span class="token punctuation">;</span>
    scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sprite<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 控制精灵大小,</span>
    sprite<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 只需要设置x、y两个分量就可以</span>
    <span class="token keyword">const</span> k1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> k2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置精灵模型位置，在xyz平面上随机分布</span>
    sprite<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">400</span> <span class="token operator">*</span> k1<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">400</span> <span class="token operator">*</span> k2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>效果如下:</p> <p><img src="/note-sites/assets/img/image-20220109220354941.627664dc.png" alt="image-20220109220354941"></p> <h2 id="帧动画模块"><a class="header-anchor" href="#帧动画模块">#</a> 帧动画模块</h2> <p>Threejs提供了一系列用户编辑和播放关键帧动画的API,例如关键帧<a href="https://threejs.org/docs/index.html?q=KeyframeTrack#api/zh/animation/KeyframeTrack" target="_blank" rel="noopener noreferrer">KeyframeTrack<OutboundLink></OutboundLink></a>、剪辑<a href="https://threejs.org/docs/index.html?q=animation#api/zh/animation/AnimationClip" target="_blank" rel="noopener noreferrer">AnimationClip<OutboundLink></OutboundLink></a>、操作<a href="http://localhost:8888/three.js-dev/docs/index.html?q=animation#api/zh/animation/AnimationAction" target="_blank" rel="noopener noreferrer">AnimationAction<OutboundLink></OutboundLink></a>、混合器<a href="http://localhost:8888/three.js-dev/docs/index.html?q=animation#api/zh/animation/AnimationMixer" target="_blank" rel="noopener noreferrer">AnimationMixer<OutboundLink></OutboundLink></a></p> <p><img src="/note-sites/assets/img/image-20220110210633298.4e0da4c5.png" alt="image-20220110210633298"></p> <p>实际开发中如果需要制作一个复杂三维模型的帧动画，比如一个人走路、跑步等动作，一般情况是美术通过3dmax、blender等软件编辑好，不需要程序员用代码实现</p> <p><strong>播放关键帧</strong></p> <p>混合器<code>THREE.AnimationMixer()</code>的参数是<code>Object3D</code>，可以是几何也可以是加载外部模型返回的模型对象</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">/**
 * 播放编辑好的关键帧数据
 */</span>
<span class="token comment">// group作为混合器的参数，可以播放group中所有子对象的帧动画</span>
<span class="token keyword">const</span> mixer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AnimationMixer</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 剪辑clip作为参数，通过混合器clipAction方法返回一个操作对象AnimationAction</span>
<span class="token keyword">const</span> AnimationAction <span class="token operator">=</span> mixer<span class="token punctuation">.</span><span class="token function">clipAction</span><span class="token punctuation">(</span>clip<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//通过操作Action设置播放方式</span>
AnimationAction<span class="token punctuation">.</span>timeScale <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span><span class="token comment">//默认1，可以调节播放速度</span>
<span class="token comment">// AnimationAction.loop = THREE.LoopOnce; //不循环播放</span>
AnimationAction<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//开始播放</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>播放关键帧动画的时候，注意在渲染函数<code>render()</code>中执行<code>mixer.update(渲染间隔时间)</code>告诉帧动画系统</p> <p>Threejs两次渲染的时间间隔，获得时间间隔可以通过Threejs提供的一个时钟类<a href="https://threejs.org/docs/index.html?q=clock#api/zh/core/Clock" target="_blank" rel="noopener noreferrer">Clock<OutboundLink></OutboundLink></a>实现</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 创建一个时钟对象Clock</span>
<span class="token keyword">const</span> clock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 渲染函数</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  <span class="token comment">//clock.getDelta()方法获得两帧的时间间隔</span>
  <span class="token comment">// 更新混合器相关的时间</span>
  mixer<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>clock<span class="token punctuation">.</span><span class="token function">getDelta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="解析外部模型的帧动画"><a class="header-anchor" href="#解析外部模型的帧动画">#</a> 解析外部模型的帧动画</h3> <p>关键帧<strong>model.json</strong>文件类似如下数据</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token string-property property">&quot;object&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token comment">// 绑定动画的模型名称Box</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Box&quot;</span><span class="token punctuation">,</span>
<span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 动画数据</span>
<span class="token string-property property">&quot;animations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;fps&quot;</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;tracks&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 位置变化关键帧</span>
    <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vector3&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Box.position&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;keys&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token string-property property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token number">50</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token operator">...</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 角度变化关键帧</span>
  <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;quaternion&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Box.quaternion&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;keys&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token string-property property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token operator">...</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 颜色变化关键帧</span>
  <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;color&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Box.material.color&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;keys&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token string-property property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token number">20</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p><strong>播放模型帧动画</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 通过ObjectLoader加载模型文件model.json</span>
<span class="token keyword">const</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>ObjectLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> mixer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">//声明一个混合器变量</span>
<span class="token comment">// 加载文件返回一个对象obj</span>
loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;./model.json&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  obj<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//缩放加载的模型</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// obj作为混合器的参数，可以播放obj包含的帧动画数据</span>
  mixer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AnimationMixer</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// obj.animations[0]; 获得剪辑clip对象</span>
  <span class="token comment">// 剪辑clip作为参数，通过混合器clipAction方法返回一个操作对象AnimationAction</span>
  <span class="token keyword">const</span> AnimationAction <span class="token operator">=</span> mixer<span class="token punctuation">.</span><span class="token function">clipAction</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>animations<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  AnimationAction<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 播放</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 创建一个时钟对象Clock</span>
<span class="token keyword">const</span> clock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 渲染函数</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>

   <span class="token comment">//clock.getDelta()方法获得两帧的时间间隔</span>
   <span class="token comment">// 更新混合器相关的时间</span>
   mixer<span class="token operator">?.</span><span class="token function">update</span><span class="token punctuation">(</span>clock<span class="token punctuation">.</span><span class="token function">getDelta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="播放设置"><a class="header-anchor" href="#播放设置">#</a> 播放设置</h3> <p>可以通过操作<a href="https://threejs.org/docs/index.html?q=AnimationAction#api/zh/animation/AnimationAction" target="_blank" rel="noopener noreferrer">AnimationAction<OutboundLink></OutboundLink></a>的相关属性设置播放效果</p> <p><strong>取消循环播放</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">//不循环播放(默认是循环播放)</span>
AnimationAction<span class="token punctuation">.</span>loop <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>LoopOnce<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>暂停播放</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 暂停播放</span>
AnimationAction<span class="token punctuation">.</span>paused <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token comment">//暂停在最后一帧播放的状态</span>
AnimationAction<span class="token punctuation">.</span>clampWhenFinished <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>播放clip特定时间段</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">/**
 * 播放编辑好的关键帧数据
 */</span>
<span class="token keyword">const</span> mixer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AnimationMixer</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建混合器</span>
<span class="token keyword">const</span> AnimationAction <span class="token operator">=</span> mixer<span class="token punctuation">.</span><span class="token function">clipAction</span><span class="token punctuation">(</span>clip<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//返回动画操作对象</span>
<span class="token comment">// AnimationAction.timeScale = 5; //默认1，可以调节播放速度</span>
<span class="token comment">// 设置播放区间10~18   关键帧数据总时间是20</span>
AnimationAction<span class="token punctuation">.</span>time <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">//操作对象设置开始播放时间</span>
clip<span class="token punctuation">.</span>duration <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span><span class="token comment">//剪辑对象设置播放结束时间</span>
AnimationAction<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//开始播放</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>定位在某个时间点</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 开始结束时间设置为一样，相当于播放时间为0，直接跳转到时间点对应的状态</span>
AnimationAction<span class="token punctuation">.</span>time <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">//操作对象设置开始播放时间</span>
clip<span class="token punctuation">.</span>duration <span class="token operator">=</span> AnimationAction<span class="token punctuation">.</span>time<span class="token punctuation">;</span><span class="token comment">//剪辑对象设置播放结束时间</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="骨骼动画和变形动画"><a class="header-anchor" href="#骨骼动画和变形动画">#</a> 骨骼动画和变形动画</h2> <h3 id="骨骼动画"><a class="header-anchor" href="#骨骼动画">#</a> 骨骼动画</h3> <p><strong>解析查看骨骼动画数据</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 通过加载器ObjectLoader加载./marine_anims_core.json模型文件</span>
<span class="token keyword">const</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>ObjectLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;./marine_anims_core.json&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//添加到场景中</span>
    scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//从返回对象获得骨骼网格模型</span>
    SkinnedMesh <span class="token operator">=</span> obj<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 查看骨头关节Bone</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>SkinnedMesh<span class="token punctuation">.</span>skeleton<span class="token punctuation">.</span>bones<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 骨骼辅助显示</span>
<span class="token keyword">const</span> skeletonHelper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>SkeletonHelper</span><span class="token punctuation">(</span>SkinnedMesh<span class="token punctuation">)</span><span class="token punctuation">;</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>skeletonHelper<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 遍历骨骼模型中的骨关节Bone，并获得世界坐标</span>
SkinnedMesh<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">elem</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>elem<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'Bone'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>elem<span class="token punctuation">.</span><span class="token function">getWorldPosition</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>解析渲染骨骼动画</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>ObjectLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建一个加载器</span>
<span class="token keyword">const</span> mixer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">//声明一个混合器变量</span>
loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;./marine_anims_core.json&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//添加到场景中</span>
  <span class="token comment">//从返回对象获得骨骼网格模型</span>
  <span class="token keyword">const</span> SkinnedMesh <span class="token operator">=</span> obj<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">//骨骼网格模型作为参数创建一个混合器</span>
  mixer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AnimationMixer</span><span class="token punctuation">(</span>SkinnedMesh<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 查看骨骼网格模型的帧动画数据</span>
  <span class="token comment">// console.log(SkinnedMesh.geometry.animations)</span>
  <span class="token comment">// 解析跑步状态对应剪辑对象clip中的关键帧数据</span>
  <span class="token keyword">const</span> AnimationAction <span class="token operator">=</span> mixer<span class="token punctuation">.</span><span class="token function">clipAction</span><span class="token punctuation">(</span>SkinnedMesh<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>animations<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 解析步行状态对应剪辑对象clip中的关键帧数据</span>
  <span class="token comment">// const AnimationAction = mixer.clipAction(SkinnedMesh.geometry.animations[3]);</span>
  AnimationAction<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 创建一个时钟对象Clock</span>
<span class="token keyword">const</span> clock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 渲染函数</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token operator">...</span>

    <span class="token comment">//clock.getDelta()方法获得两帧的时间间隔</span>
    <span class="token comment">// 更新混合器相关的时间</span>
    mixer<span class="token operator">?.</span><span class="token function">update</span><span class="token punctuation">(</span>clock<span class="token punctuation">.</span><span class="token function">getDelta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="变形动画"><a class="header-anchor" href="#变形动画">#</a> 变形动画</h3> <p>关于变形动画, 可以理解为多组顶点数据，从一个状态变化到另一个状态，比如人的面部表情，哭的表情用一系列的顶点表示，笑的表情用一系列的顶点表示，从哭的表情过渡到笑的表情，就是表情对应的两组顶点之间的过渡，几何体的顶点的位置坐标发生变化，<strong>从一个状态过渡到另一个状态自然就产生了变形动画</strong></p> <p><img src="/note-sites/assets/img/morphTargetInfluences.a985dc1e.gif" alt="morphTargetInfluences"></p> <p><strong>创建变形动画的顶点数据</strong></p> <p>先获取两个变形目标<code>box1</code>和<code>box2</code>的顶点数据，然后通过几何体<a href="https://threejs.org/docs/index.html?q=geometry#api/zh/core/BufferGeometry" target="_blank" rel="noopener noreferrer">BufferGeometry<OutboundLink></OutboundLink></a>的变形目标属性<code>.morphAttributes</code>设置好变形动画</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">/**
 * 创建网格模型，并给模型的几何体设置多个变形目标
 */</span>
<span class="token comment">// 创建一个几何体具有8个顶点</span>
<span class="token keyword">const</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//立方体几何对象</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>geometry<span class="token punctuation">.</span>vertices<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 为geometry提供变形目标的数据</span>
<span class="token keyword">const</span> box1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//为变形目标1提供数据</span>
<span class="token keyword">const</span> box2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//为变形目标2提供数据</span>
<span class="token comment">// 设置变形目标的数据</span>
geometry<span class="token punctuation">.</span>morphTargets<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'target1'</span><span class="token punctuation">,</span><span class="token literal-property property">vertices</span><span class="token operator">:</span> box1<span class="token punctuation">.</span>vertices<span class="token punctuation">}</span><span class="token punctuation">;</span>
geometry<span class="token punctuation">.</span>morphTargets<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'target2'</span><span class="token punctuation">,</span><span class="token literal-property property">vertices</span><span class="token operator">:</span> box2<span class="token punctuation">.</span>vertices<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshLambertMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">morphAttributes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//允许变形</span>
  <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0x0000ff</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//材质对象</span>
<span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//网格模型对象</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//网格模型添加到场景中</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>网格模型.morphTargetInfluences属性</strong></p> <p>通过上面代码把变形动画顶点数据设置好以后，如果想生成变形动画，首先要设置网格模型<a href="https://threejs.org/docs/index.html?q=mesh#api/zh/objects/Mesh.morphTargetInfluences" target="_blank" rel="noopener noreferrer">Mesh<OutboundLink></OutboundLink></a>的<code>.morphTargetInfluences</code>属性</p> <p>如下代码可以改变网格模型的形状</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 启用变形目标并设置变形目标影响权重，范围一般0~1</span>
<span class="token comment">// 设置第一组顶点对几何体形状影响的变形系数</span>
mesh<span class="token punctuation">.</span>morphTargetInfluences<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 设置第二组顶点对几何体形状影响的变形系数</span>
mesh<span class="token punctuation">.</span>morphTargetInfluences<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>生成变形动画</strong></p> <p><img src="/note-sites/assets/img/ren.996f841b.gif" alt="人"></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">/**
 * 设置关键帧数据
 */</span>
<span class="token comment">// 设置变形目标1对应权重随着时间的变化</span>
<span class="token keyword">const</span> Track1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>KeyframeTrack</span><span class="token punctuation">(</span><span class="token string">'.morphTargetInfluences[0]'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置变形目标2对应权重随着时间的变化</span>
<span class="token keyword">const</span> Track2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>KeyframeTrack</span><span class="token punctuation">(</span><span class="token string">'.morphTargetInfluences[1]'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建一个剪辑clip对象，命名&quot;default&quot;，持续时间40</span>
<span class="token keyword">const</span> clip <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AnimationClip</span><span class="token punctuation">(</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Track1<span class="token punctuation">,</span>Track2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">/**
 * 播放编辑好的关键帧数据
 */</span>
<span class="token keyword">const</span> mixer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AnimationMixer</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建混合器</span>
<span class="token keyword">const</span> AnimationAction <span class="token operator">=</span> mixer<span class="token punctuation">.</span><span class="token function">clipAction</span><span class="token punctuation">(</span>clip<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回动画操作对象</span>
AnimationAction<span class="token punctuation">.</span>timeScale <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 默认1，可以调节播放速度</span>
<span class="token comment">// AnimationAction.loop = THREE.LoopOnce; // 不循环播放</span>
<span class="token comment">// AnimationAction.clampWhenFinished=true;// 暂停在最后一帧播放的状态</span>
AnimationAction<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 开始播放</span>
<span class="token operator">...</span>
<span class="token operator">...</span>
<span class="token comment">// 创建一个时钟对象Clock</span>
<span class="token keyword">const</span> clock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 渲染函数</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token comment">// clock.getDelta()方法获得两帧的时间间隔</span>
  <span class="token comment">// 更新混合器相关的时间</span>
  mixer<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>clock<span class="token punctuation">.</span><span class="token function">getDelta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><strong>加载查看模型变形动画数据</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 通过加载器JSONLoader加载变形动画模型文件./人/umich_ucs.json</span>
<span class="token keyword">const</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>JSONLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;./人/umich_ucs.json&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">geometry<span class="token punctuation">,</span> materials</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 查看模型的变形数据 </span>
  <span class="token comment">// console.log(geometry);</span>
  <span class="token comment">// console.log(materials);</span>
    
  <span class="token comment">// 通过平均面法线来计算顶点法线，效果更光滑</span>
  geometry<span class="token punctuation">.</span><span class="token function">computeVertexNormals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> materials<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 材质对象开启渲染目标</span>
  mesh<span class="token punctuation">.</span>material<span class="token punctuation">.</span>morphTargets <span class="token operator">=</span> <span class="token boolean">true</span>
  mesh<span class="token punctuation">.</span><span class="token function">rotateX</span><span class="token punctuation">(</span><span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mesh<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">;</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//插入到场景中</span>
  <span class="token comment">// 查看变形目标数据</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>geometry<span class="token punctuation">.</span>morphTargets<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>可以在代码中给网格模型的<code>.morphTargetInfluences</code>属性赋予不同的值, 使模型变化(胖瘦变化)</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 变胖</span>
mesh<span class="token punctuation">.</span>morphTargetInfluences<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">// 变瘦</span>
mesh<span class="token punctuation">.</span>morphTargetInfluences<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>鸟飞行变形动画</strong></p> <p><img src="/note-sites/assets/img/niao.62427779.gif" alt="鸟"></p> <p>通过混合器<a href="https://threejs.org/docs/index.html?q=AnimationMixer#api/zh/animation/AnimationMixer" target="_blank" rel="noopener noreferrer">AnimationMixer<OutboundLink></OutboundLink></a>获取模型中的变形动画关键帧数据然后进行播放</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>JSONLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建加载器</span>
<span class="token keyword">let</span> mixer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">//声明一个混合器变量</span>
loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;./鸟/flamingo.json&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">geometry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log(geometry);</span>
  <span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshPhongMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">morphTargets</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">vertexColors</span><span class="token operator">:</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>FaceColors<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 通过平均面法线来计算顶点法线，效果更光滑</span>
  geometry<span class="token punctuation">.</span><span class="token function">computeVertexNormals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//插入到场景中</span>

  <span class="token comment">// 创建一个混合器，播放网格模型模型的变形动画</span>
  mixer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AnimationMixer</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// geometry.animations[0]：获得剪辑对象clip</span>
  <span class="token keyword">const</span> AnimationAction<span class="token operator">=</span>mixer<span class="token punctuation">.</span><span class="token function">clipAction</span><span class="token punctuation">(</span>geometry<span class="token punctuation">.</span>animations<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// AnimationAction.timeScale = 0.5; //默认1，可以调节播放速度</span>
  <span class="token comment">// AnimationAction.loop = THREE.LoopOnce; //不循环播放</span>
  <span class="token comment">// AnimationAction.clampWhenFinished=true;//暂停在最后一帧播放的状态</span>
  AnimationAction<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//播放动画</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>在渲染函数中，通过时钟类<a href="https://threejs.org/docs/index.html?q=Clock#api/zh/core/Clock" target="_blank" rel="noopener noreferrer">Clock<OutboundLink></OutboundLink></a>获得两次渲染的时间间隔，然后执行<code>mixer.update();</code>传递给混合器</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 创建一个时钟对象Clock</span>
<span class="token keyword">const</span> clock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 渲染函数</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  <span class="token comment">//clock.getDelta()方法获得两帧的时间间隔</span>
  <span class="token comment">// 更新混合器相关的时间</span>
  mixer<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>clock<span class="token punctuation">.</span><span class="token function">getDelta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="语音模块"><a class="header-anchor" href="#语音模块">#</a> 语音模块</h2> <p>Threejs对原生<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Audio_API" target="_blank" rel="noopener noreferrer">Web Audio API<OutboundLink></OutboundLink></a>的封装提供了一些方便使用的语音模块, 比如一个声音和一个网格模型绑定，这样网格模型的位置就是音源位置</p> <p>Threejs提供了一系列音频相关的API：音频<a href="https://threejs.org/docs/index.html?q=audio#api/zh/audio/Audio" target="_blank" rel="noopener noreferrer">Audio<OutboundLink></OutboundLink></a>、位置音频<a href="https://threejs.org/docs/index.html?q=audio#api/zh/audio/PositionalAudio" target="_blank" rel="noopener noreferrer">PositionalAudio<OutboundLink></OutboundLink></a>、监听者<a href="https://threejs.org/docs/index.html?q=audio#api/zh/audio/AudioListener" target="_blank" rel="noopener noreferrer">AudioListener<OutboundLink></OutboundLink></a>、音频分析器<a href="https://threejs.org/docs/index.html?q=audio#api/zh/audio/AudioAnalyser" target="_blank" rel="noopener noreferrer">AudioAnalyser<OutboundLink></OutboundLink></a>、音频加载器<a href="https://threejs.org/docs/index.html?q=audio#api/zh/loaders/AudioLoader" target="_blank" rel="noopener noreferrer">AudioLoader<OutboundLink></OutboundLink></a>。</p> <p>音频<code>Audio</code>、位置音频<code>PositionalAudio</code>等Threejs类本质上是对原生<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Audio_API" target="_blank" rel="noopener noreferrer">Web Audio API<OutboundLink></OutboundLink></a>的封装</p> <h3 id="非位置音频"><a class="header-anchor" href="#非位置音频">#</a> 非位置音频</h3> <p>通过非位置音频<code>THREE.Audio</code>加载一段音频进行进行播放，该音频播放效果不受具体位置影响，一般可以用于一个三维场景的背景音乐</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 非位置音频可用于不考虑位置的背景音乐</span>
<span class="token comment">// 创建一个监听者</span>
<span class="token keyword">const</span> listener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AudioListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// camera.add( listener );</span>
<span class="token comment">// 创建一个非位置音频对象  用来控制播放</span>
<span class="token keyword">const</span> audio <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Audio</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建一个音频加载器对象</span>
<span class="token keyword">const</span> audioLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AudioLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 加载音频文件，返回一个音频缓冲区对象作为回调函数参数</span>
audioLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./好运来.mp3'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">AudioBuffer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log(AudioBuffer)</span>
  <span class="token comment">// 音频缓冲区对象关联到音频对象audio</span>
  audio<span class="token punctuation">.</span><span class="token function">setBuffer</span><span class="token punctuation">(</span>AudioBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  audio<span class="token punctuation">.</span><span class="token function">setLoop</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//是否循环</span>
  audio<span class="token punctuation">.</span><span class="token function">setVolume</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//音量</span>
  <span class="token comment">// 播放缓冲区中的音频数据</span>
  audio<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//play播放、stop停止、pause暂停</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="位置音频"><a class="header-anchor" href="#位置音频">#</a> 位置音频</h3> <p>在实际生活中，听到声音的效果，受音源相对监听者的位置和角度影响。音频源位置发生变化，听到的声音有所变化，比如音量大小。Threejs提供了一个和非位置音频<code>THREE.Audio</code>不同的API位置音频<code>THREE.PositionalAudio</code>，通过位置音频创建的音频播放效果可以模仿自然界中，人听到不同位置音源的声音效果</p> <p>可以将监听者<code>AudioListener</code>绑定到了相机对象<code>camera</code>上, 改变相机的位置或角度本质上就是改变监听者的位置或角度, 这样的话就相当于音源绑定的网格模型<code>audioMesh</code>相对监听者的位置或角度发生了变化, 声音也就一起发生变化了</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token operator">...</span>
<span class="token comment">// 用来定位音源的网格模型</span>
<span class="token keyword">const</span> audioMesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置网格模型的位置，相当于设置音源的位置</span>
audioMesh<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>audioMesh<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span>

<span class="token comment">// 创建一个虚拟的监听者</span>
<span class="token keyword">const</span> listener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AudioListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 监听者绑定到相机对象</span>
camera<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建一个位置音频对象, 监听者作为参数,音频和监听者关联。</span>
<span class="token keyword">const</span> PosAudio <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PositionalAudio</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 音源绑定到一个网格模型上</span>
audioMesh<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>PosAudio<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建一个音频加载器</span>
<span class="token keyword">const</span> audioLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AudioLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 加载音频文件，返回一个音频缓冲区对象作为回调函数参数</span>
audioLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./好运来.mp3'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">AudioBuffer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log(buffer);</span>
  <span class="token comment">// 音频缓冲区对象关联到音频对象audio</span>
  PosAudio<span class="token punctuation">.</span><span class="token function">setBuffer</span><span class="token punctuation">(</span>AudioBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  PosAudio<span class="token punctuation">.</span><span class="token function">setVolume</span><span class="token punctuation">(</span><span class="token number">0.9</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 音量</span>
  PosAudio<span class="token punctuation">.</span><span class="token function">setRefDistance</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//参数值越大, 声音越大</span>
  PosAudio<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 播放</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="音乐可视化"><a class="header-anchor" href="#音乐可视化">#</a> 音乐可视化</h3> <p>通过Threejs音频相关的APi可以获得音乐音频的频率数据然后可视化</p> <p><img src="/note-sites/assets/img/yyksh.74f393ca.gif" alt="音乐可视化"></p> <p><strong>查看平均频率</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">let</span> analyser <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 声明一个分析器变量</span>
<span class="token keyword">const</span> listener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AudioListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 监听者</span>
<span class="token keyword">const</span> audio <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Audio</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 非位置音频对象</span>
<span class="token keyword">const</span> audioLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AudioLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 音频加载器</span>
<span class="token comment">// 加载音频文件</span>
audioLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'中国人.mp3'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">AudioBuffer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  audio<span class="token punctuation">.</span><span class="token function">setBuffer</span><span class="token punctuation">(</span>AudioBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 音频缓冲区对象关联到音频对象audio</span>
  audio<span class="token punctuation">.</span><span class="token function">setLoop</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 是否循环</span>
  audio<span class="token punctuation">.</span><span class="token function">setVolume</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 音量</span>
  audio<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 播放</span>
  <span class="token comment">// 音频分析器和音频绑定，可以实时采集音频时域数据进行快速傅里叶变换</span>
  analyser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AudioAnalyser</span><span class="token punctuation">(</span>audio<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 渲染函数</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>analyser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// getAverageFrequency()返回平均音频</span>
    <span class="token keyword">const</span> frequency <span class="token operator">=</span> analyser<span class="token punctuation">.</span><span class="token function">getAverageFrequency</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mesh<span class="token punctuation">.</span>scale<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">*</span> frequency <span class="token operator">/</span> <span class="token number">256</span><span class="token punctuation">;</span>
    mesh<span class="token punctuation">.</span>material<span class="token punctuation">.</span>color<span class="token punctuation">.</span>r <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">*</span> frequency <span class="token operator">/</span> <span class="token number">256</span><span class="token punctuation">;</span>
    <span class="token comment">// 返回所有的音频频率数据</span>
    <span class="token comment">// console.log(analyser.getFrequencyData())</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><strong>频率数据可视化</strong></p> <p>获取频率数据，然后通过频率数据控制网格模型的长度方向伸缩变化</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">/**
 * 创建多个网格模型组成的组对象
 */</span>
 <span class="token keyword">const</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">let</span> <span class="token constant">N</span> <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span> <span class="token comment">//控制音频分析器返回频率数据数量</span>
 <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token constant">N</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> box <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建一个立方体几何对象</span>
   <span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshPhongMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
     <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0x0000ff</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//材质对象</span>
   <span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>box<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//网格模型对象</span>
   <span class="token comment">// 长方体间隔20，整体居中</span>
   mesh<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">20</span> <span class="token operator">*</span> i <span class="token operator">-</span> <span class="token constant">N</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
   group<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">let</span> analyser <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 声明一个分析器变量</span>
<span class="token comment">// 渲染函数</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">...</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>analyser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获得频率数据N个</span>
    <span class="token keyword">const</span> arr <span class="token operator">=</span> analyser<span class="token punctuation">.</span><span class="token function">getFrequencyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// console.log(arr);</span>
    <span class="token comment">// 遍历组对象，每个网格子对象设置一个对应的频率数据</span>
    group<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">elem<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      elem<span class="token punctuation">.</span>scale<span class="token punctuation">.</span>y <span class="token operator">=</span> arr<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">80</span>
      elem<span class="token punctuation">.</span>material<span class="token punctuation">.</span>color<span class="token punctuation">.</span>r <span class="token operator">=</span> arr<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">200</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> listener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AudioListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 监听者</span>
<span class="token keyword">const</span> audio <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Audio</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 非位置音频对象</span>
<span class="token keyword">const</span> audioLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AudioLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 音频加载器</span>
<span class="token comment">// 加载音频文件</span>
audioLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'中国人.mp3'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">AudioBuffer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  audio<span class="token punctuation">.</span><span class="token function">setBuffer</span><span class="token punctuation">(</span>AudioBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 音频缓冲区对象关联到音频对象audio</span>
  audio<span class="token punctuation">.</span><span class="token function">setLoop</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 是否循环</span>
  audio<span class="token punctuation">.</span><span class="token function">setVolume</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 音量</span>
  audio<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 播放</span>
  <span class="token comment">// 音频分析器和音频绑定，可以实时采集音频时域数据进行快速傅里叶变换</span>
  analyser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AudioAnalyser</span><span class="token punctuation">(</span>audio<span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">*</span><span class="token constant">N</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="加载外部模型文件"><a class="header-anchor" href="#加载外部模型文件">#</a> 加载外部模型文件</h2> <p>实际开发中，大多数项目，通常是3D美术设计师或建筑、机械等行业工程师提供的由3dmx、blender、substence、Solidworks等软件创建好的三维模型文件, 程序员使用代码导入渲染执, 行相关动画</p> <p><img src="/note-sites/assets/img/image-20220111115901238.4e1ca7ce.png" alt="image-20220111115901238"></p> <h3 id="数据结构、导入导出"><a class="header-anchor" href="#数据结构、导入导出">#</a> 数据结构、导入导出</h3> <p><strong>导出模型信息</strong></p> <p>查看Threejs文档<a href="https://threejs.org/docs/index.html?q=buffergeometry#api/zh/core/BufferGeometry" target="_blank" rel="noopener noreferrer">BufferGeometry<OutboundLink></OutboundLink></a>、<a href="https://threejs.org/docs/index.html?q=Material#api/zh/materials/Material" target="_blank" rel="noopener noreferrer">Material<OutboundLink></OutboundLink></a>、<a href="https://threejs.org/docs/index.html?q=light#api/zh/lights/Light" target="_blank" rel="noopener noreferrer">Light<OutboundLink></OutboundLink></a>、<a href="https://threejs.org/docs/index.html?q=object3d#api/zh/core/Object3D" target="_blank" rel="noopener noreferrer">Object3D<OutboundLink></OutboundLink></a>等类，你可以发现这些类都提供了一个方法<code>.toJSON()</code>通过这个方法可以导出Threejs三维模型的各类数据，该方法的功能就是把Threejs的几何体、材质、光源等对象转化为JSON格式导出</p> <p><strong>导出几何数据</strong></p> <p>不只是几何, 场景, 材质, 相机, 网格等都是可以导出的</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 控制台查看立方体数据</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>geometry<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 控制台查看geometry.toJSON()结果</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>geometry<span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// JSON对象转化为字符串</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>geometry<span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// JSON.stringify()方法内部会自动调用参数的toJSON()方法</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>geometry<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>加载Threejs导出的模型数据</strong></p> <p>加载几何体数据</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BufferGeometryLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'bufferGeometry.json'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">geometry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 控制台查看加载放回的threejs对象结构</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>geometry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshLambertMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0x0000ff</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//材质对象Material</span>
    <span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//网格模型对象Mesh</span>
    scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//网格模型添加到场景中</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>网格模型Mesh加载，包含几何体Geometry和材质Material</p> <div class="language-javascript line-numbers-mode"><pre v-pre="" class="language-javascript"><code><span class="token keyword">var</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>ObjectLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'model.json'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    obj<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
    scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>加载组Group对象，模型对象构成的树结构</p> <div class="language-javascript line-numbers-mode"><pre v-pre="" class="language-javascript"><code>loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'group.json'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>加载场景对象，场景对象不仅包含模型，还包括光源对象</p> <div class="language-javascript line-numbers-mode"><pre v-pre="" class="language-javascript"><code>loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'scene.json'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    obj<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
    scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="stl格式模型加载"><a class="header-anchor" href="#stl格式模型加载">#</a> .stl格式模型加载</h3> <p>基本所有的三维软件都支持导出<code>.stl</code>格式的三维模型文件，<code>.stl</code>格式的三维模型不包含材质Material信息，只包含几何体顶点数据的信息，可以简单地把stl文件理解为几何体对象Geometry</p> <p><strong>需要引入<code>STLLoader.js</code>文件来加载.stl文件</strong></p> <p>加载器文件路径在<code>three.js-master/examples/js/loaders</code></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 引入STLLoader.js文件</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./three.js-master/examples/js/loaders/STLLoader.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">/**
 * stl数据加载
 */</span>
<span class="token keyword">const</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>STLLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 立方体默认尺寸长宽高各200</span>
loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'立方体.stl'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">geometry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 控制台查看加载放回的threejs对象结构</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>geometry<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 查看顶点数，一个立方体6个矩形面，每个矩形面至少2个三角面，每个三角面3个顶点，</span>
  <span class="token comment">// 如果没有索引index复用顶点，就是说一个立方体至少36个顶点</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>geometry<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>position<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 缩放几何体</span>
  <span class="token comment">// geometry.scale(0.5,0.5,0.5);</span>
  <span class="token comment">// 几何体居中</span>
  <span class="token comment">// geometry.center();</span>
  <span class="token comment">// 平移立方体</span>
  <span class="token comment">// geometry.translate(-50,-50,-50);</span>
  <span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshLambertMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0x0000ff</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//材质对象Material</span>
  <span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//网格模型对象Mesh</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//网格模型添加到场景中</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="加载-obj模型文件"><a class="header-anchor" href="#加载-obj模型文件">#</a> 加载.obj模型文件</h3> <p>使用三维软件导出<code>.obj</code>模型文件的时候，会同时导出一个材质文件<code>.mtl</code>， <code>.obj</code>和<code>.stl</code>文件包含的信息一样都是几何体顶点相关数据，材质文件<code>.mtl</code>包含的是模型的材质信息，比如颜色、贴图路径等</p> <p>加载<code>.obj</code>三维模型的时候，可以只加载<code>.obj</code>文件，然后借助threejs引擎自定义材质<a href="https://threejs.org/docs/index.html?q=Material#api/zh/materials/Material" target="_blank" rel="noopener noreferrer">Material<OutboundLink></OutboundLink></a>，也可以同时加载<code>.obj</code>和<code>.mtl</code>文件</p> <p><strong>只加载obj文件</strong></p> <p>引入<code>OBJLoader.js</code>文件, 路径<code>three.js-master/examples/js/loaders/OBJLoader.js</code></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 引入obj模型加载库OBJLoader<span class="token punctuation">.</span>js <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;../three.js-master/examples/js/loaders/OBJLoader.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>文件加载</strong></p> <div class="language-javascript line-numbers-mode"><pre v-pre="" class="language-javascript"><code><span class="token comment">/**
 * OBJ文件加载  只加载obj文件中的几何信息，不加载材质文件.mtl
 */</span>
<span class="token keyword">const</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>OBJLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 没有材质文件，系统自动设置Phong网格材质</span>
loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./立方体/box.obj'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 控制台查看返回结构：包含一个网格模型Mesh的组Group</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 查看加载器生成的材质对象：MeshPhongMaterial</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>material<span class="token punctuation">)</span><span class="token punctuation">;</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>加载文件返回的对象插入场景中后, 可以做一些自定的设置，比如缩放、居中等操作</p> <div class="language-javascript line-numbers-mode"><pre v-pre="" class="language-javascript"><code><span class="token comment">// 加载后的一些编辑操作</span>
obj<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 网格模型缩放</span>
obj<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span><span class="token function">center</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 网格模型的几何体居中</span>
obj<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>material<span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0xff0000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 设置材质颜色</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>同时加载obj文件和mtl文件</strong></p> <p><code>.mtl</code>文件包含了模型的材质信息，比如模型颜色、透明度等信息，还有纹理贴图的路径，比如颜色贴图、法线贴图、高光贴图等等</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 引入obj模型加载库OBJLoader<span class="token punctuation">.</span>js <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./three.js-master/examples/js/loaders/OBJLoader.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 引入obj模型材质加载库MTLLoader<span class="token punctuation">.</span>js <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./three.js-master/examples/js/loaders/MTLLoader.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">/**
 * OBJ和材质文件mtl加载
 */</span>
<span class="token keyword">const</span> OBJLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>OBJLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//obj加载器</span>
<span class="token keyword">const</span> MTLLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MTLLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//材质文件加载器</span>
MTLLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./立方体/box.mtl'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">materials</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 返回一个包含材质的对象MaterialCreator</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>materials<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//obj的模型会和MaterialCreator包含的材质对应起来</span>
  OBJLoader<span class="token punctuation">.</span><span class="token function">setMaterials</span><span class="token punctuation">(</span>materials<span class="token punctuation">)</span><span class="token punctuation">;</span>
  OBJLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./立方体/box.obj'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    obj<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//放大obj组对象</span>
    scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//返回的组对象插入场景中</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>obj包含多个网格模型</strong></p> <p><code>.obj</code>文件可以包含多个网格模型对象，不一定就是一个，这些网格模型对象全部是并列关系，无法通过父子关系构建一个树结构层级模型</p> <div class="language-javascript line-numbers-mode"><pre v-pre="" class="language-javascript"><code><span class="token comment">// 没有材质文件，系统自动设置Phong网格材质</span>
OBJLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./多个模型/model.obj'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 控制台查看返回结构：包含一个网格模型Mesh的组Group</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 加载后的一些编辑操作</span>
  obj<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//网格模型缩放</span>
  <span class="token comment">// 设置其中一个网格模型的颜色</span>
  obj<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>material<span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0xff0000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>模型纹理贴图</strong></p> <p><code>obj</code>模型的<code>.mtl</code>文件可能包含纹理贴图，也可能不包含，这主要看3D美术是否设置</p> <p>一个包含纹理贴图路径的<code>.mtl</code>文件,如果路径有问题，可能会无法加载</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 一个包含纹理贴图路径的.mtl文件</span>
newmtl material_1
    Ns <span class="token number">32</span>
    d <span class="token number">1</span>
    Tr <span class="token number">0</span>
    Tf <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span>
    illum <span class="token number">2</span>
    Ka <span class="token number">0.5880</span> <span class="token number">0.5880</span> <span class="token number">0.5880</span>
    Kd <span class="token number">0.9880</span> <span class="token number">0.9880</span> <span class="token number">0.9880</span>
    Ks <span class="token number">0.1200</span> <span class="token number">0.1200</span> <span class="token number">0.1200</span>
    map_Kd <span class="token punctuation">.</span><span class="token operator">/</span>贴图<span class="token operator">/</span>Earth<span class="token punctuation">.</span>png
  map_ks <span class="token punctuation">.</span><span class="token operator">/</span>贴图<span class="token operator">/</span>EarthSpec<span class="token punctuation">.</span>png
    norm <span class="token punctuation">.</span><span class="token operator">/</span>贴图<span class="token operator">/</span>EarthNormal<span class="token punctuation">.</span>png
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>mtl和threejs贴图对应关系</strong></p> <table><thead><tr><th>mtl贴图</th> <th>Threejs贴图</th></tr></thead> <tbody><tr><td>map_kd</td> <td>map</td></tr> <tr><td>map_ks</td> <td>specularMap</td></tr> <tr><td>map_bump/bump</td> <td>bumpMap</td></tr></tbody></table> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">/**
 * OBJ和材质文件mtl加载
 */</span>
<span class="token keyword">const</span> OBJLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>OBJLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// obj加载器</span>
<span class="token keyword">const</span> MTLLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MTLLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 材质文件加载器</span>
MTLLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./贴图/material.mtl'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">materials</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 返回一个包含材质的对象MaterialCreator</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>materials<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// obj的模型会和MaterialCreator包含的材质对应起来</span>
  OBJLoader<span class="token punctuation">.</span><span class="token function">setMaterials</span><span class="token punctuation">(</span>materials<span class="token punctuation">)</span><span class="token punctuation">;</span>
  OBJLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./贴图/model.obj'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      
    <span class="token comment">// 颜色贴图中已经包含了光照信息，所以直接使用不受光照影响的基础网格材质MeshBasicMaterial</span>
    obj<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>material<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">map</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>TextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'texture1.png'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//设置颜色纹理贴图</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
      
    <span class="token comment">// 加载后操作</span>
    obj<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 缩放球体网格模型</span>
    <span class="token comment">// 通过调节参数, 地球表面的凹凸感更强</span>
    obj<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>material<span class="token punctuation">.</span>normalScale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回的组对象插入场景中</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><strong>导出<code>.obj</code>和<code>.mtl</code>的名称、路径问题</strong></p> <p><strong>3dmax</strong>导出的obj和mtl模型文件有时候需要修改一下个别位置字符，比如<code>.obj</code>中<code>.mtl</code>文件的名称可能是乱码<code>mtllib �����.mtl</code>，<code>.mtl</code>文件中贴图的路径要设置正确，比如导出的是绝对路径还是相对路径，可以打开文件看下</p> <p><strong><code>.obj</code>文件里不包含的信息</strong></p> <p><code>.obj</code>文件不包含场景的相机Camera、光源Light等信息，不能导出骨骼动画、变形动画，如果希望导出光照信息、相机信息、骨骼动画信息、变形动画信息，可以选择<code>.fbx</code>、<code>.gltf</code>等格式</p> <h3 id="加载fbx并解析骨骼动画"><a class="header-anchor" href="#加载fbx并解析骨骼动画">#</a> 加载FBX并解析骨骼动画</h3> <p><strong>加载器</strong><code>FBXLoader.js</code></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 引入fbx模型加载库FBXLoader <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./three.js-master/examples/js/loaders/FBXLoader.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 辅助文件 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./three.js-master/examples/js/libs/inflate.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>加载fbx模型文件</strong></p> <p>加载模型文件，加载完成后，如果模型显示位置不符合要求，可以让3D美术修改，也可以通过Threejs程序进行平移、缩放等操作</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>FBXLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建一个FBX加载器</span>
loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;SambaDancing.fbx&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log(obj);// 查看加载后返回的模型对象</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
  <span class="token comment">// 适当平移fbx模型位置</span>
  obj<span class="token punctuation">.</span><span class="token function">translateY</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>查看FBX模型帧动画数据</strong></p> <p><code>.stl</code> <code>.obj</code>文件都是静态模型, 不能包含动画, <code>.fbx</code>文件除了包含几何, 材质信息, 可以存储骨骼动画等数据</p> <p>解析之前可以先在浏览器控制台查看动画相关的数据是如何存储的。你可以看到<code>obj.animations</code>属性的数组包含两个剪辑对象<a href="https://threejs.org/docs/index.html?q=AnimationClip#api/zh/animation/AnimationClip" target="_blank" rel="noopener noreferrer">AnimationClip<OutboundLink></OutboundLink></a>，<code>obj.animations[0]</code>对应剪辑对象<code>AnimationClip</code>包含多组关键帧<a href="https://threejs.org/docs/index.html?q=KeyframeTrack#api/zh/animation/KeyframeTrack" target="_blank" rel="noopener noreferrer">KeyframeTrack<OutboundLink></OutboundLink></a>数据，<code>obj.animations[1]</code>对应的剪辑对象<code>AnimationClip</code>没有关键帧数据，也就是说没有关键帧动画。具体的开发中，可能美术提供的模型有很多包含关键帧动画的剪辑对象<code>AnimationClip</code>，你可以根据自己的需要解析某个剪辑对象<code>AnimationClip</code>对应的动画</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>FBXLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建一个FBX加载器</span>
loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;SambaDancing.fbx&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token comment">// 可以在控制台打印obj对象，找到animations属性</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
  <span class="token comment">// 查看动画数据</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>animations<span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>解析fbx模型骨骼动画</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">let</span> mixer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">// 声明一个混合器变量</span>
<span class="token keyword">const</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>FBXLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 创建一个FBX加载器</span>
loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;SambaDancing.fbx&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log(obj)</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
  obj<span class="token punctuation">.</span><span class="token function">translateY</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// obj作为参数创建一个混合器，解析播放obj及其子对象包含的动画数据</span>
  mixer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AnimationMixer</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 查看动画数据</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>animations<span class="token punctuation">)</span>
  <span class="token comment">// obj.animations[0]：获得剪辑对象clip</span>
  <span class="token keyword">const</span> AnimationAction<span class="token operator">=</span>mixer<span class="token punctuation">.</span><span class="token function">clipAction</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>animations<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// AnimationAction.timeScale = 1; // 默认1，可以调节播放速度</span>
  <span class="token comment">// AnimationAction.loop = THREE.LoopOnce; // 不循环播放</span>
  <span class="token comment">// AnimationAction.clampWhenFinished=true;// 暂停在最后一帧播放的状态</span>
  AnimationAction<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 播放动画</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 创建一个时钟对象Clock</span>
<span class="token keyword">const</span> clock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 渲染函数</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>mixer <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//clock.getDelta()方法获得两帧的时间间隔</span>
    <span class="token comment">// 更新混合器相关的时间</span>
    mixer<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>clock<span class="token punctuation">.</span><span class="token function">getDelta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="辅助对象"><a class="header-anchor" href="#辅助对象">#</a> 辅助对象</h2> <h3 id="三维坐标系-axeshelper"><a class="header-anchor" href="#三维坐标系-axeshelper">#</a> 三维坐标系（AxesHelper）</h3> <p><a href="https://threejs.org/docs/index.html?q=AxesHelper#api/zh/helpers/AxesHelper" target="_blank" rel="noopener noreferrer"><code>THREE.AxesHelper(size)</code><OutboundLink></OutboundLink></a></p> <p><strong>sise</strong>: 表示轴的线段长度. 默认为 <strong>1</strong></p> <p><strong>红色代表 X 轴, 绿色代表 Y 轴, 蓝色代表 Z 轴</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 生成三维坐标系</span>
<span class="token keyword">const</span> axes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AxesHelper</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 添加坐标系到场景中</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>axes<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="/note-sites/assets/img/axes.a5909486.png" alt="image-20211226124612078"></p> <h3 id="光的辅助对象"><a class="header-anchor" href="#光的辅助对象">#</a> 光的辅助对象</h3> <table><thead><tr><th>辅助对象</th> <th>构造函数名</th></tr></thead> <tbody><tr><td>聚光源辅助对象</td> <td><a href="https://threejs.org/docs/index.html?q=SpotLightHelper#api/zh/helpers/SpotLightHelper" target="_blank" rel="noopener noreferrer">SpotLightHelper<OutboundLink></OutboundLink></a></td></tr> <tr><td>点光源辅助对象</td> <td><a href="https://threejs.org/docs/index.html?q=PointLightHelper#api/zh/helpers/PointLightHelper" target="_blank" rel="noopener noreferrer">PointLightHelper<OutboundLink></OutboundLink></a></td></tr> <tr><td>平行光光源辅助对象</td> <td><a href="https://threejs.org/docs/index.html?q=DirectionalLightHelper#api/zh/helpers/DirectionalLightHelper" target="_blank" rel="noopener noreferrer">DirectionalLightHelper<OutboundLink></OutboundLink></a></td></tr></tbody></table> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> helper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>DirectionalLightHelper</span><span class="token punctuation">(</span>light<span class="token punctuation">)</span><span class="token punctuation">;</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>helper<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>当辅助对象所表示的不可见对象有所改变的时候, 必须调用辅助对象的 <code>update</code> 方法来更新辅助对象本身的状态</p> <p>常用到<strong>光照位置</strong>与<strong>目标点位置</strong>的控制</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">function</span> <span class="token function">updateLight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 光的辅助对象更新状态</span>
    light<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 光的更新状态</span>
    helper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 更新相机的状态</span>
    camera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="相机视锥-camerahelper"><a class="header-anchor" href="#相机视锥-camerahelper">#</a> 相机视锥（CameraHelper）</h3> <p><a href="https://threejs.org/docs/#api/zh/helpers/CameraHelper" target="_blank" rel="noopener noreferrer"><code>THREE.CameraHelper()</code><OutboundLink></OutboundLink></a></p> <p>用于模拟相机视锥体的辅助对象.
它使用 <a href="https://threejs.org/docs/#api/zh/objects/LineSegments" target="_blank" rel="noopener noreferrer">LineSegments<OutboundLink></OutboundLink></a> 来模拟相机视锥体.</p> <div class="language-JS line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token operator">...</span>
<span class="token keyword">const</span> helper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>CameraHelper</span><span class="token punctuation">(</span> camera <span class="token punctuation">)</span><span class="token punctuation">;</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> helper <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="轨道控制器-orbitcontrols"><a class="header-anchor" href="#轨道控制器-orbitcontrols">#</a> 轨道控制器（OrbitControls）</h3> <p>轨道控制器需要<a href="https://threejs.org/docs/index.html#manual/zh/introduction/Installation" target="_blank" rel="noopener noreferrer">单独引入<OutboundLink></OutboundLink></a>, 加上此控制器,就可以通过鼠标拖拽、滚动对整个画面进行拖拽, 缩放, 平移</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 引入 r136 版本的 OrbitControls</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> OrbitControls <span class="token punctuation">}</span> 
	<span class="token keyword">from</span> <span class="token string">'https://cdn.skypack.dev/three@0.136.0/examples/jsm/controls/OrbitControls.js'</span><span class="token punctuation">;</span>

<span class="token comment">// 设置轨道控制器 </span>
<span class="token keyword">const</span> controls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span>camera<span class="token punctuation">,</span> renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 改变控制器的焦点</span>
controls<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 更新更新观察点位置(必须)</span>
controls<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 启用控制器的阻尼(惯性)</span>
controls<span class="token punctuation">.</span>enableDamping <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">// 摄像机平移</span>
controls<span class="token punctuation">.</span>enablePan <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="数学函数"><a class="header-anchor" href="#数学函数">#</a> 数学函数</h3> <p><a href="https://threejs.org/docs/index.html#api/zh/math/MathUtils" target="_blank" rel="noopener noreferrer"><code>MathUtils</code><OutboundLink></OutboundLink></a></p> <h3 id="用户界面工具-lil-gui"><a class="header-anchor" href="#用户界面工具-lil-gui">#</a> 用户界面工具（lil-gui）</h3> <p><a href="https://github.com/georgealways/lil-gui" target="_blank" rel="noopener noreferrer">lil-gui<OutboundLink></OutboundLink></a> 是一个轻量级的图形用户界面库（<strong>GUI</strong> 组件）,使用这个库可以很容易地创建出能够改变代码变量的界面组件</p> <blockquote><p>官方教程, <a href="https://lil-gui.georgealways.com/#Examples" target="_blank" rel="noopener noreferrer">Examples<OutboundLink></OutboundLink></a></p></blockquote> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 引入 lil-gui 库</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">GUI</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://threejs.org/examples/jsm/libs/lil-gui.module.min.js'</span><span class="token punctuation">;</span>
<span class="token comment">// 实例化 lil-gui</span>
<span class="token keyword">const</span> gui <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>gui</strong>的一些方法</p> <table><thead><tr><th>方法</th> <th>描述</th></tr></thead> <tbody><tr><td>add</td> <td>添加一个表单组件, 参数依次是(对象, 属性, 最小值, 最大值, 步进)</td></tr> <tr><td>addColor</td> <td>添加一个颜色选择面板, 参数依次为(对象,属性）</td></tr> <tr><td>addFolder</td> <td>添加一个栏目,参数为栏目的名称,该函数返回一个对象,这个对象仍然可以使用**add()、addColor()、addFolder()**方法</td></tr></tbody></table> <p><strong>lil-gui</strong> 会根据它的值自动选择一个合适的控制器类型</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 属性对象</span>
cosnt obj <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">myBoolean</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token literal-property property">myString</span><span class="token operator">:</span> <span class="token string">'lil-gui'</span><span class="token punctuation">,</span>
	<span class="token literal-property property">myNumber</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token function-variable function">myFunction</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">'hi'</span> <span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 根据 obj['myxxx'] 生成一个合适的控制器类型</span>
gui<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> obj<span class="token punctuation">,</span> <span class="token string">'myBoolean'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 	<span class="token comment">// 生成复选框</span>
gui<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> obj<span class="token punctuation">,</span> <span class="token string">'myString'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 	<span class="token comment">// 文本字段</span>
gui<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> obj<span class="token punctuation">,</span> <span class="token string">'myNumber'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 	<span class="token comment">// 数字框</span>
gui<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> obj<span class="token punctuation">,</span> <span class="token string">'myFunction'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 	<span class="token comment">// 按钮(点击触发 obj.myFunction)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>具有最小值和最大值的<strong>数字框控制器</strong>自动转换为<strong>滑块</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">number1</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">number2</span><span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 初始值为1, 最小滑动值0, 最大滑动值1</span>
gui<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> obj<span class="token punctuation">,</span> <span class="token string">'number1'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 初始值为50, 最小滑动值0, 最大滑动值100, 步进为10</span>
gui<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> obj<span class="token punctuation">,</span> <span class="token string">'number2'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">10</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>可以通过<strong>数组</strong>为任何数据类型创建<strong>下拉列表</strong>, 如果传递的是一个对象, 它的<strong>键将被用作选项的标签</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token string">'Large'</span><span class="token punctuation">,</span> <span class="token literal-property property">speed</span><span class="token operator">:</span> <span class="token number">0.1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 文案为:size文案, 下拉项为:Small Medium Large(值也是), 默认值为:Large</span>
gui<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> obj<span class="token punctuation">,</span> <span class="token string">'size文案'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token string">'Small'</span><span class="token punctuation">,</span> <span class="token string">'Medium'</span><span class="token punctuation">,</span> <span class="token string">'Large'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 文案为:speed文案, 下拉项为:Slow Normal Fast(值对应 0.1 1 5), 默认值为:Slow(0.1)</span>
gui<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> obj<span class="token punctuation">,</span> <span class="token string">'speed文案'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">Slow</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token literal-property property">Normal</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">Fast</span><span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>lil-gui</strong>可以识别多种格式的颜色: CSS字符串、RGB对象或十六进制整数值等等</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">color1</span><span class="token operator">:</span> <span class="token string">'#AA00FF'</span><span class="token punctuation">,</span>
	<span class="token literal-property property">color2</span><span class="token operator">:</span> <span class="token string">'#a0f'</span><span class="token punctuation">,</span>
	<span class="token literal-property property">color3</span><span class="token operator">:</span> <span class="token string">'rgb(170, 0, 255)'</span><span class="token punctuation">,</span>
	<span class="token literal-property property">color4</span><span class="token operator">:</span> <span class="token number">0xaa00ff</span>
<span class="token punctuation">}</span>

<span class="token comment">// 都是颜色选择框</span>
gui<span class="token punctuation">.</span><span class="token function">addColor</span><span class="token punctuation">(</span> obj<span class="token punctuation">,</span> <span class="token string">'color1'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
gui<span class="token punctuation">.</span><span class="token function">addColor</span><span class="token punctuation">(</span> obj<span class="token punctuation">,</span> <span class="token string">'color2'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
gui<span class="token punctuation">.</span><span class="token function">addColor</span><span class="token punctuation">(</span> obj<span class="token punctuation">,</span> <span class="token string">'color3'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
gui<span class="token punctuation">.</span><span class="token function">addColor</span><span class="token punctuation">(</span> obj<span class="token punctuation">,</span> <span class="token string">'color4'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>控制器分组</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 顶级控制器</span>
gui<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> obj<span class="token punctuation">,</span> <span class="token string">'scale'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 嵌套的控制器, 嵌套的标题为: Position文案</span>
<span class="token keyword">const</span> folder <span class="token operator">=</span> gui<span class="token punctuation">.</span><span class="token function">addFolder</span><span class="token punctuation">(</span> <span class="token string">'Position文案'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
folder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> obj<span class="token punctuation">,</span> <span class="token string">'x'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
folder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> obj<span class="token punctuation">,</span> <span class="token string">'y'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
folder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> obj<span class="token punctuation">,</span> <span class="token string">'z'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>事件相关</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 指定属性改变事件</span>
gui<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> params<span class="token punctuation">,</span> <span class="token string">'foo'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> value <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 全局事件</span>
<span class="token comment">// gui 的任何子对象发生更改后触发</span>
gui<span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	event<span class="token punctuation">.</span>object     <span class="token comment">// 被修改的对象</span>
	event<span class="token punctuation">.</span>property   <span class="token comment">// 字符串,属性名</span>
	event<span class="token punctuation">.</span>value      <span class="token comment">// 控制器新值</span>
	event<span class="token punctuation">.</span>controller <span class="token comment">// 被修改的控制器</span>
<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>指定标题文本</strong></p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code>gui<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> position<span class="token punctuation">,</span> <span class="token string">'x'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span> <span class="token string">'位置x'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
gui<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> rotation<span class="token punctuation">,</span> <span class="token string">'x'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span> <span class="token string">'旋转x'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>指定 <strong>GUI</strong> 组件的位置</p> <p>默认情况下, <strong>GUI</strong>被添加到文档窗口右上方的固定定位, 向构造函数传递容器参数, 可以将 <strong>GUI</strong> 添加到不同的元素</p> <div class="language-js line-numbers-mode"><pre v-pre="" class="language-js"><code><span class="token comment">// 设置指定容器DOM</span>
<span class="token keyword">const</span> gui <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GUI</span><span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token literal-property property">container</span><span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#gui'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置 GUI 宽度</span>
<span class="token keyword">const</span> gui <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GUI</span><span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">400</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 打开 gui 控制器</span>
gui<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 折叠 gui 控制器</span>
gui<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span> <span class="token boolean">false</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 切换 gui 控制器</span>
gui<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span> gui<span class="token punctuation">.</span>_closed <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></div></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2023/2/27 19:41:45</span></div></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-bac73764 data-v-c0d124fa><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#程序结构" class="sidebar-link reco-side-程序结构" data-v-bac73764>程序结构</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#前置工作" class="sidebar-link reco-side-前置工作" data-v-bac73764>前置工作</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#场景-scene" class="sidebar-link reco-side-场景-scene" data-v-bac73764>场景（scene）</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#相机-camera" class="sidebar-link reco-side-相机-camera" data-v-bac73764>相机（camera）</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#透视相机" class="sidebar-link reco-side-透视相机" data-v-bac73764>透视相机</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#正交相机" class="sidebar-link reco-side-正交相机" data-v-bac73764>正交相机</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#窗口变化自适应渲染" class="sidebar-link reco-side-窗口变化自适应渲染" data-v-bac73764>窗口变化自适应渲染</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#渲染器-renderer" class="sidebar-link reco-side-渲染器-renderer" data-v-bac73764>渲染器（renderer）</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#threejs全屏-局部渲染" class="sidebar-link reco-side-threejs全屏-局部渲染" data-v-bac73764>Threejs全屏/局部渲染</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#css2drenderer" class="sidebar-link reco-side-css2drenderer" data-v-bac73764>CSS2DRenderer</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#几何体-geometry" class="sidebar-link reco-side-几何体-geometry" data-v-bac73764>几何体（geometry）</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#圆弧线" class="sidebar-link reco-side-圆弧线" data-v-bac73764>圆弧线</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#样条曲线和贝塞尔曲线" class="sidebar-link reco-side-样条曲线和贝塞尔曲线" data-v-bac73764>样条曲线和贝塞尔曲线</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#buffergeometry" class="sidebar-link reco-side-buffergeometry" data-v-bac73764>BufferGeometry</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#向量-vector" class="sidebar-link reco-side-向量-vector" data-v-bac73764>向量（Vector）</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#矩阵" class="sidebar-link reco-side-矩阵" data-v-bac73764>矩阵</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#矩阵对象的平移-缩放-旋转" class="sidebar-link reco-side-矩阵对象的平移-缩放-旋转" data-v-bac73764>矩阵对象的平移, 缩放, 旋转</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#三维对象-object3d" class="sidebar-link reco-side-三维对象-object3d" data-v-bac73764>三维对象（Object3D）</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#对象克隆和复制" class="sidebar-link reco-side-对象克隆和复制" data-v-bac73764>对象克隆和复制</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#组-group" class="sidebar-link reco-side-组-group" data-v-bac73764>组（Group）</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#对象节点命名-查找-遍历" class="sidebar-link reco-side-对象节点命名-查找-遍历" data-v-bac73764>对象节点命名, 查找, 遍历</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#本地坐标系和世界坐标系" class="sidebar-link reco-side-本地坐标系和世界坐标系" data-v-bac73764>本地坐标系和世界坐标系</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#材质-material" class="sidebar-link reco-side-材质-material" data-v-bac73764>材质（material）</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#网格-mesh" class="sidebar-link reco-side-网格-mesh" data-v-bac73764>网格（Mesh）</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#渲染场景" class="sidebar-link reco-side-渲染场景" data-v-bac73764>渲染场景</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#灯光-light" class="sidebar-link reco-side-灯光-light" data-v-bac73764>灯光（Light）</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#纹理-texture" class="sidebar-link reco-side-纹理-texture" data-v-bac73764>纹理（texture）</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#纹理对象-texture" class="sidebar-link reco-side-纹理对象-texture" data-v-bac73764>纹理对象 Texture</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#数组材质、材质索引" class="sidebar-link reco-side-数组材质、材质索引" data-v-bac73764>数组材质、材质索引</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#纹理对象texture阵列、偏移、旋转" class="sidebar-link reco-side-纹理对象texture阵列、偏移、旋转" data-v-bac73764>纹理对象Texture阵列、偏移、旋转</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#canvas画布、视频作为纹理贴图" class="sidebar-link reco-side-canvas画布、视频作为纹理贴图" data-v-bac73764>canvas画布、视频作为纹理贴图</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#凹凸贴图和法线贴图" class="sidebar-link reco-side-凹凸贴图和法线贴图" data-v-bac73764>凹凸贴图和法线贴图</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#光照贴图添加阴影" class="sidebar-link reco-side-光照贴图添加阴影" data-v-bac73764>光照贴图添加阴影</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#高光贴图" class="sidebar-link reco-side-高光贴图" data-v-bac73764>高光贴图</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#环境贴图" class="sidebar-link reco-side-环境贴图" data-v-bac73764>环境贴图</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#数据纹理对象" class="sidebar-link reco-side-数据纹理对象" data-v-bac73764>数据纹理对象</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#雾" class="sidebar-link reco-side-雾" data-v-bac73764>雾</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#加载器" class="sidebar-link reco-side-加载器" data-v-bac73764>加载器</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#fileloader" class="sidebar-link reco-side-fileloader" data-v-bac73764>FileLoader</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#精灵模型和粒子系统" class="sidebar-link reco-side-精灵模型和粒子系统" data-v-bac73764>精灵模型和粒子系统</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#精灵模型sprite" class="sidebar-link reco-side-精灵模型sprite" data-v-bac73764>精灵模型Sprite</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#帧动画模块" class="sidebar-link reco-side-帧动画模块" data-v-bac73764>帧动画模块</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#解析外部模型的帧动画" class="sidebar-link reco-side-解析外部模型的帧动画" data-v-bac73764>解析外部模型的帧动画</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#播放设置" class="sidebar-link reco-side-播放设置" data-v-bac73764>播放设置</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#骨骼动画和变形动画" class="sidebar-link reco-side-骨骼动画和变形动画" data-v-bac73764>骨骼动画和变形动画</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#骨骼动画" class="sidebar-link reco-side-骨骼动画" data-v-bac73764>骨骼动画</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#变形动画" class="sidebar-link reco-side-变形动画" data-v-bac73764>变形动画</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#语音模块" class="sidebar-link reco-side-语音模块" data-v-bac73764>语音模块</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#非位置音频" class="sidebar-link reco-side-非位置音频" data-v-bac73764>非位置音频</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#位置音频" class="sidebar-link reco-side-位置音频" data-v-bac73764>位置音频</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#音乐可视化" class="sidebar-link reco-side-音乐可视化" data-v-bac73764>音乐可视化</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#加载外部模型文件" class="sidebar-link reco-side-加载外部模型文件" data-v-bac73764>加载外部模型文件</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#数据结构、导入导出" class="sidebar-link reco-side-数据结构、导入导出" data-v-bac73764>数据结构、导入导出</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#stl格式模型加载" class="sidebar-link reco-side-stl格式模型加载" data-v-bac73764>.stl格式模型加载</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#加载-obj模型文件" class="sidebar-link reco-side-加载-obj模型文件" data-v-bac73764>加载.obj模型文件</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#加载fbx并解析骨骼动画" class="sidebar-link reco-side-加载fbx并解析骨骼动画" data-v-bac73764>加载FBX并解析骨骼动画</a></li><li class="level-2" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#辅助对象" class="sidebar-link reco-side-辅助对象" data-v-bac73764>辅助对象</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#三维坐标系-axeshelper" class="sidebar-link reco-side-三维坐标系-axeshelper" data-v-bac73764>三维坐标系（AxesHelper）</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#光的辅助对象" class="sidebar-link reco-side-光的辅助对象" data-v-bac73764>光的辅助对象</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#相机视锥-camerahelper" class="sidebar-link reco-side-相机视锥-camerahelper" data-v-bac73764>相机视锥（CameraHelper）</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#轨道控制器-orbitcontrols" class="sidebar-link reco-side-轨道控制器-orbitcontrols" data-v-bac73764>轨道控制器（OrbitControls）</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#数学函数" class="sidebar-link reco-side-数学函数" data-v-bac73764>数学函数</a></li><li class="level-3" data-v-bac73764><a href="/note-sites/guide/Three/Three.html#用户界面工具-lil-gui" class="sidebar-link reco-side-用户界面工具-lil-gui" data-v-bac73764>用户界面工具（lil-gui）</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-2a01419c data-v-2a01419c><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-2a01419c><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-2a01419c></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-2a01419c></path></svg></div></div></div>
    <script src="/note-sites/assets/js/app.68ee92f0.js" defer></script><script src="/note-sites/assets/js/5.2f78da70.js" defer></script><script src="/note-sites/assets/js/1.9e97c91a.js" defer></script><script src="/note-sites/assets/js/3.ef78bef5.js" defer></script>
  </body>
</html>
